
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Wind energy production prediction using Machine Learning &#8212; Wind Energy Prediction</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Wind_Energy_Prediction_ML';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Wind Energy Prediction" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.jpg" class="logo__image only-light" alt="Wind Energy Prediction - Home"/>
    <script>document.write(`<img src="_static/logo.jpg" class="logo__image only-dark" alt="Wind Energy Prediction - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Wind Energy Prediction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><strong>Wind energy production prediction using Machine Learning</strong></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Wind_Energy_Production_Prediction" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Wind_Energy_Production_Prediction/issues/new?title=Issue%20on%20page%20%2FWind_Energy_Prediction_ML.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Wind_Energy_Prediction_ML.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Wind energy production prediction using Machine Learning</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem"><strong>The problem</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptual-description-of-the-data"><strong>Conceptual description of the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data"><strong>Reading the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda"><strong>EDA</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variable-types"><strong>Variable types</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values-analysis"><strong>Missing values analysis</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-the-response"><strong>Analysis of the Response</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-summary"><strong>Descriptive summary</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram"><strong>Histogram</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#frequencies"><strong>Frequencies</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot"><strong>Boxplot</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ecdf-plot"><strong>ECDF-plot</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers"><strong>Outliers</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series-analysis"><strong>Time series analysis</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelation"><strong>Autocorrelation</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#statistics-by-year"><strong>Statistics by year</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-relationship-between-response-and-predictors"><strong>Analysis of relationship between Response and Predictors</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda-conclusions-and-things-to-take-care-of"><strong>EDA conclusions and things to take care of</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split"><strong>Train-Test Split</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pipeline-definition"><strong>Pipeline definition</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-the-pipeline"><strong>Testing the pipeline</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metric-and-inner-outer-evaluation-decision"><strong>Metric and Inner-Outer evaluation decision</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-outer-evaluation"><strong>Inner-Outer evaluation</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metric"><strong>Metric</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#type-of-problem"><strong>Type of problem</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#predicting-energy-production"><strong>Predicting energy production</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-search-model-hpo"><strong>Model search (Model HPO)</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-search-global-hpo"><strong>Global search (Global HPO)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#strategical-test-histogram-gradient-boosting"><strong>Strategical test: Histogram Gradient Boosting</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-test-histogram-gradient-boosting"><strong>Reduced test: Histogram Gradient Boosting</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-test-trees"><strong>Reduced test: Trees</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-test-knn"><strong>Reduced test: KNN</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-test-xgboost"><strong>Reduced test: XGboost</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-test-random-forest"><strong>Reduced test: Random Forest</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-future-performance-for-the-final-model"><strong>Estimation Future Performance for the Final Model</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-model-hpo"><strong>Final Model HPO</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-the-competition-model"><strong>Saving the competition model</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-prediction-for-compatition-data"><strong>Making prediction for compatition data</strong></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="wind-energy-production-prediction-using-machine-learning">
<h1><strong>Wind energy production prediction using Machine Learning</strong><a class="headerlink" href="#wind-energy-production-prediction-using-machine-learning" title="Link to this heading">#</a></h1>
<section id="the-problem">
<h2><strong>The problem</strong><a class="headerlink" href="#the-problem" title="Link to this heading">#</a></h2>
<p>The project addresses the integration of non-operable renewable energy sources, like wind energy, into advanced electricity networks. These energy sources, unlike traditional ones such as gas or oil, cannot be controlled directly by operators as they depend on weather conditions. Therefore, accurate forecasting of energy production is crucial. Traditional weather prediction models like the Global Forecast System (GFS, USA) and the European Centre for Medium-Range Weather Forecasts (ECMWF) provide detailed meteorological forecasts, but translating these into exact energy production figures is complex.</p>
<p>To bridge this gap, the project employs machine learning models using meteorological data from ECMWF to predict energy output at the Sotavento experimental wind farm in Spain. The model will process 22 different meteorological variables, including both direct indicators of wind energy potential and other less apparent factors. The project will use a 5x5 grid around Sotavento, analyzing each variable at 25 different locations to create a comprehensive dataset of 550 input attributes.</p>
<p>The lack of specific expertise in wind energy generation and the importance of each meteorological variable led to the inclusion of all 22 variables in the model. Machine learning and attribute selection techniques will help in identifying the most significant variables influencing energy production. The final aim is to develop a machine learning model capable of accurately forecasting electricity generation at Sotavento, aiding in effective and efficient energy planning for the electricity grid.</p>
<p>More concretely, we intend to train a machine learning model <span class="math notranslate nohighlight">\(f\)</span>, so that:</p>
<ul class="simple">
<li><p>Given the 00:00am ECMWF forecast for variables A6:00, B6:00, C6:00, … at 6:00 am (i.e. six hours in advance)</p></li>
<li><p><span class="math notranslate nohighlight">\(f\)</span>(A6:00, B6:00, C6:00, …) = energy = electricity generated at Sotavento at 6:00</p></li>
</ul>
<p><img alt="image.png" src="_images/project_schema.jpg" /></p>
<ul class="simple">
<li><p>22 variables will be used.  It is common practice to use the value of those variables, not just at the location of interest (Sotavento in this case), but at points in a grid around Sotavento. A 5x5 grid will be used in this case.</p></li>
</ul>
<ul class="simple">
<li><p>Therefore, each meteorological variable has been instantiated at 25 different locations (location 13 is actually Sotavento). That is why, for instance, attribute iews appears 25 times in the dataset (iews.1, iews.2, …, iews.13, …, iews.25). Therefore, the dataset contains 22*25 = 550 input attributes.</p></li>
</ul>
<p><img alt="image.png" src="_images/sotavento.png" /></p>
</section>
<section id="requirements">
<h2><strong>Requirements</strong><a class="headerlink" href="#requirements" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_halving_search_cv</span>  
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">HalvingGridSearchCV</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">RandomizedSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">PredefinedSplit</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">ChainMap</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">IterativeImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span><span class="p">,</span> <span class="n">HistGradientBoostingRegressor</span>
<span class="kn">from</span>  <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="c1">#from skopt import BayesSearchCV</span>
<span class="kn">import</span> <span class="nn">optuna</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">joblib</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">EDA</span> <span class="kn">import</span> <span class="n">dtypes_df</span><span class="p">,</span> <span class="n">corr_matrix</span><span class="p">,</span> <span class="n">prop_cols_nulls</span><span class="p">,</span> <span class="n">prop_row_nulls</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="n">histogram</span><span class="p">,</span> <span class="n">freq_table</span><span class="p">,</span> <span class="n">quant_to_cat</span><span class="p">,</span> <span class="n">boxplot</span><span class="p">,</span> <span class="n">ecdfplot</span><span class="p">,</span> <span class="n">outliers_table</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="conceptual-description-of-the-data">
<h2><strong>Conceptual description of the data</strong><a class="headerlink" href="#conceptual-description-of-the-data" title="Link to this heading">#</a></h2>
<p>Given a location point (see above map) the following predictor variables has been predicted by ECMWF at specific location point (see above map) and at specific time.</p>
<p>The response variable <code class="docutils literal notranslate"><span class="pre">energy</span></code> is the real wind energy production.</p>
<p>So, the <span class="math notranslate nohighlight">\(i\)</span>-th observation contains the specific time at which the weather variables (predictors) were forecast 6 hours in advanced by the ECMWF, and the real wind energy production that was 6 hours after that specific time.</p>
<p>The idea is to create the best possible ML model that takes into account the ECMWF variables in a specific time and predict the wind energy production six hours in advanced.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">t2m.j</span></code></p></td>
<td><p>denotes the 2-meter temperature, which is the temperature at 2 meters above the Earth’s surface at the location <code class="docutils literal notranslate"><span class="pre">j</span></code>. Is measured in Kelvins (K)</p></td>
<td><p>Quantitative  (Predictor)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">u10.j</span></code></p></td>
<td><p>refers to the 10-meter U-wind component, which is the horizontal speed of air moving towards the east at a height of 10 meters above the location point <code class="docutils literal notranslate"><span class="pre">j</span></code> surface. This speed is measured in meters per second (m/s).</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">u100.j</span></code></p></td>
<td><p>is the 100-meter U-wind component, indicating the horizontal speed of air moving towards the east at a height of 100 meters above the surface at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>. The speed is also measured in meters per second (m/s).</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">v10.j</span></code></p></td>
<td><p>10-meter V-wind component, which is the horizontal speed of air moving towards the north at a height of 10 meters above the surface at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>. The speed is also measured in meters per second (m/s).</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">v100.j</span></code></p></td>
<td><p>100-meter V-wind component, similar to <code class="docutils literal notranslate"><span class="pre">v10</span></code> but measured at 100 meters above the surface at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>. The speed is also measured in meters per second (m/s).</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cape.j</span></code></p></td>
<td><p>Convectively Available Potential Energy at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>, an indicator of atmospheric instability or stability, useful for assessing the potential for convection which can lead to severe weather events like heavy rain and thunderstorms. It’s measured in Joules per kilogram (J/kg).</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">fsr.j</span></code></p></td>
<td><p>is a measure of surface roughness at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>. In meteorology, it represents the roughness of the Earth’s surface and affects wind speed near the surface. Higher roughness values typically result in slower near-surface wind speeds. Measured in metres (m)</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">flsr.j</span></code></p></td>
<td><p>refers to the natural logarithm of the roughness length for heat at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>, which is a parameter used in models to represent the resistance of the surface to heat transfer. The roughness length for heat affects the efficiency of heat transfer from the air to the surface, with higher values indicating a surface that is less efficient at transferring heat.</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iews.j</span></code></p></td>
<td><p>Instantaneous eastward turbulent surface stress at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>, which is the force per unit area on the Earth’s surface from the eastward direction, due to turbulent interaction between the atmosphere and the surface, and turbulent orographic form drag. It is measured in Newtons per square meter (N/m²).</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">inss.j</span></code></p></td>
<td><p>Instantaneous northward turbulent surface stress at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>, similar to <code class="docutils literal notranslate"><span class="pre">iews</span></code> but for the northward direction.</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">lai_hv.j</span></code></p></td>
<td><p>Leaf area index for high vegetation at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>, representing the one-sided surface area of leaves per unit area of land for vegetation classified as ‘high.’ It is dimensionless and given as m²/m².</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">lai_lv.j</span></code></p></td>
<td><p>Leaf Area Index for low vegetation at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>, which is similar to lai_hv but for vegetation classified as ‘low’.</p></td>
<td><p>Quantitative  (Predictor)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">u10n.j</span></code></p></td>
<td><p>Neutral wind at 10 meters eastward component, measured in meters per second (m/s). It represents the wind calculated under the assumption of neutral stability in the atmosphere at 10 meters above the ground at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>.</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">v10n.j</span></code></p></td>
<td><p>Neutral wind at 10 meters northward component, also in m/s. This is similar to u10n but for the northward direction.</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">stl1.j</span></code></p></td>
<td><p>These denote soil temperature at various levels below the surface, specifically at 0-7 cm,  at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>.. Soil temperatures are key in studying soil processes and energy balance at the surface.</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">stl2.j</span></code></p></td>
<td><p>These denote soil temperature at various levels below the surface, specifically at 7-28 cm,  at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>.</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">stl3.j</span></code></p></td>
<td><p>These denote soil temperature at various levels below the surface, specifically at  28-100 cm,  at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>.</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">stl4,j</span></code></p></td>
<td><p>These denote soil temperature at various levels below the surface, specifically at  100-289 cm, at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>.</p></td>
<td><p>Quantitative  (Predictor)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sp</span></code></p></td>
<td><p>Surface Pressure at location point <code class="docutils literal notranslate"><span class="pre">j</span></code>, which is the force per unit area exerted by the atmosphere on the Earth’s surface at a specific location. It is measured in Pascals (Pa).</p></td>
<td><p>Quantitative  (Predictor)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">p54.162.j</span></code></p></td>
<td><p>is the mass-weighted vertical integral of temperature for a column of air extending from the surface of the Earth at location <code class="docutils literal notranslate"><span class="pre">j</span></code> to the top of the atmosphere. It is measured in K*kg/m2</p></td>
<td><p>Quantitative  (Predictor)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">p59.162.j</span></code></p></td>
<td><p>vertical integral of divergence of kinetic energy at location <code class="docutils literal notranslate"><span class="pre">j</span></code> measured in W/m2</p></td>
<td><p>Quantitative  (Predictor)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">p55.162.j</span></code></p></td>
<td><p>vertical integral of water vapour at location <code class="docutils literal notranslate"><span class="pre">j</span></code> measured in  kg/m2</p></td>
<td><p>Quantitative (Predictor)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">year</span></code></p></td>
<td><p>year in which the predictor variables were forecasted by ECMWF six hours in advanced</p></td>
<td><p>Date</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">month</span></code></p></td>
<td><p>year in which the predictor variables were forecasted by ECMWF six hours in advanced</p></td>
<td><p>Date</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">day</span></code></p></td>
<td><p>year in which the predictor variables were forecasted by ECMWF six hours in advanced</p></td>
<td><p>Date</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hour</span></code></p></td>
<td><p>year in which the predictor variables were forecasted by ECMWF six hours in advanced</p></td>
<td><p>Date</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">energy</span></code></p></td>
<td><p>wind energy production 6 hours after the time specified by date variables</p></td>
<td><p>Quantitative (Response)</p></td>
</tr>
</tbody>
</table>
<p>After exploring the ECMWF web page, we have spotted some interesting facts:</p>
<ul class="simple">
<li><p>From the horizontal and vertical measures of wind we can get wind speed and direction (in 360º).</p></li>
<li><p><strong>Cape</strong> are usually transformed into numerical categories to reflect if they are low, moderate or high. But this is typically used for extreme meteorological events.</p></li>
<li><p><strong>flsr</strong> and <strong>fsr</strong> mesure the same thing but in a different scale (log scale vs normal).</p></li>
<li><p><strong>iews</strong> and <strong>inss</strong> have direct impact on the flow of the air so it can affect the potential energy produced for a given amount of wind speed and direction.</p></li>
<li><p>The variables representing high and low vegetation, <strong>lai_hv</strong> and <strong>lai_lv</strong>, may be redundant.</p></li>
<li><p>The variables with wind anomalies may also be redundant as they seem to be very similar to the original variables but cenetered.</p></li>
<li><p>I doubt that temperatues of soil at 4 different levels with such a small distance between each measured point are all relevant.</p></li>
</ul>
<p>All these details will be explored in the future. First, we will train several models with the current variables to see how well they perform and at the end we will do some feature engineering to see if there is some potential improvements.</p>
</section>
<section id="reading-the-data">
<h2><strong>Reading the data</strong><a class="headerlink" href="#reading-the-data" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/wind_available.csv.gzip&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">wind_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    
<span class="n">wind_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">wind_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 555)</small><table border="1" class="dataframe"><thead><tr><th>energy</th><th>year</th><th>month</th><th>day</th><th>hour</th><th>p54.162.1</th><th>p54.162.2</th><th>p54.162.3</th><th>p54.162.4</th><th>p54.162.5</th><th>p54.162.6</th><th>p54.162.7</th><th>p54.162.8</th><th>p54.162.9</th><th>p54.162.10</th><th>p54.162.11</th><th>p54.162.12</th><th>p54.162.13</th><th>p54.162.14</th><th>p54.162.15</th><th>p54.162.16</th><th>p54.162.17</th><th>p54.162.18</th><th>p54.162.19</th><th>p54.162.20</th><th>p54.162.21</th><th>p54.162.22</th><th>p54.162.23</th><th>p54.162.24</th><th>p54.162.25</th><th>p55.162.1</th><th>p55.162.2</th><th>p55.162.3</th><th>p55.162.4</th><th>p55.162.5</th><th>p55.162.6</th><th>p55.162.7</th><th>&hellip;</th><th>u100.14</th><th>u100.15</th><th>u100.16</th><th>u100.17</th><th>u100.18</th><th>u100.19</th><th>u100.20</th><th>u100.21</th><th>u100.22</th><th>u100.23</th><th>u100.24</th><th>u100.25</th><th>v100.1</th><th>v100.2</th><th>v100.3</th><th>v100.4</th><th>v100.5</th><th>v100.6</th><th>v100.7</th><th>v100.8</th><th>v100.9</th><th>v100.10</th><th>v100.11</th><th>v100.12</th><th>v100.13</th><th>v100.14</th><th>v100.15</th><th>v100.16</th><th>v100.17</th><th>v100.18</th><th>v100.19</th><th>v100.20</th><th>v100.21</th><th>v100.22</th><th>v100.23</th><th>v100.24</th><th>v100.25</th></tr><tr><td>f64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>&hellip;</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>402.71</td><td>2005</td><td>1</td><td>2</td><td>18</td><td>2.5350e6</td><td>2.5269e6</td><td>2.5188e6</td><td>2.5106e6</td><td>2.5025e6</td><td>2.5311e6</td><td>2.5227e6</td><td>2.5143e6</td><td>2.5059e6</td><td>2.4975e6</td><td>2.5281e6</td><td>2.5194e6</td><td>2.5108e6</td><td>2.5022e6</td><td>2.4936e6</td><td>2.5256e6</td><td>2.5168e6</td><td>2.5080e6</td><td>null</td><td>2.4904e6</td><td>2.5223e6</td><td>2.5133e6</td><td>2.5043e6</td><td>2.4952e6</td><td>2.4862e6</td><td>9.441719</td><td>null</td><td>9.366515</td><td>9.328574</td><td>9.290633</td><td>9.347544</td><td>9.306893</td><td>&hellip;</td><td>-1.629377</td><td>-1.47767</td><td>-2.104379</td><td>-1.952148</td><td>null</td><td>-1.64821</td><td>-1.495979</td><td>-2.141521</td><td>-1.993476</td><td>-1.844907</td><td>-1.696861</td><td>-1.548292</td><td>-4.801839</td><td>-4.673119</td><td>-4.544897</td><td>-4.416176</td><td>-4.287456</td><td>-4.752946</td><td>null</td><td>-4.488519</td><td>-4.355807</td><td>-4.223594</td><td>-4.715028</td><td>null</td><td>-4.443617</td><td>-4.307911</td><td>-4.172206</td><td>-4.683596</td><td>null</td><td>-4.407196</td><td>null</td><td>-4.131295</td><td>-4.669626</td><td>-4.528932</td><td>-4.388736</td><td>-4.24854</td><td>-4.107846</td></tr><tr><td>696.8</td><td>2005</td><td>1</td><td>3</td><td>0</td><td>null</td><td>null</td><td>2.5212e6</td><td>2.5131e6</td><td>null</td><td>2.5335e6</td><td>2.5251e6</td><td>2.5167e6</td><td>2.5083e6</td><td>2.5000e6</td><td>2.5304e6</td><td>2.5218e6</td><td>2.5132e6</td><td>2.5046e6</td><td>2.4960e6</td><td>2.5279e6</td><td>2.5191e6</td><td>2.5103e6</td><td>2.5015e6</td><td>2.4927e6</td><td>2.5246e6</td><td>2.5155e6</td><td>2.5065e6</td><td>2.4975e6</td><td>null</td><td>null</td><td>9.08128</td><td>9.038596</td><td>8.995235</td><td>8.951874</td><td>9.027078</td><td>8.979652</td><td>&hellip;</td><td>-3.583266</td><td>-3.423712</td><td>-4.065591</td><td>null</td><td>-3.742297</td><td>-3.580127</td><td>-3.41848</td><td>-4.06873</td><td>-3.908653</td><td>-3.748575</td><td>-3.588497</td><td>-3.42842</td><td>null</td><td>null</td><td>-3.166389</td><td>-3.034675</td><td>-2.902961</td><td>-3.416845</td><td>-3.28114</td><td>-3.145933</td><td>-3.010228</td><td>null</td><td>-3.406368</td><td>-3.268168</td><td>-3.129469</td><td>-2.991269</td><td>-2.85257</td><td>-3.397886</td><td>-3.257192</td><td>-3.115998</td><td>-2.975304</td><td>-2.834609</td><td>-3.39639</td><td>-3.254198</td><td>-3.112506</td><td>-2.970314</td><td>null</td></tr><tr><td>1591.15</td><td>2005</td><td>1</td><td>3</td><td>6</td><td>2.5337e6</td><td>2.5257e6</td><td>2.5177e6</td><td>2.5097e6</td><td>null</td><td>2.5298e6</td><td>2.5215e6</td><td>2.5132e6</td><td>2.5049e6</td><td>2.4966e6</td><td>2.5267e6</td><td>2.5182e6</td><td>2.5096e6</td><td>2.5011e6</td><td>2.4926e6</td><td>2.5242e6</td><td>2.5155e6</td><td>2.5067e6</td><td>null</td><td>2.4893e6</td><td>2.5208e6</td><td>2.5119e6</td><td>2.5029e6</td><td>2.4940e6</td><td>2.4850e6</td><td>8.200507</td><td>8.161211</td><td>8.121237</td><td>8.081941</td><td>null</td><td>8.097524</td><td>8.054841</td><td>&hellip;</td><td>-4.924047</td><td>-4.750891</td><td>-5.395387</td><td>-5.220661</td><td>null</td><td>-4.871211</td><td>null</td><td>-5.333134</td><td>-5.162594</td><td>-4.992054</td><td>-4.821514</td><td>null</td><td>-1.512977</td><td>-1.362803</td><td>-1.212629</td><td>-1.062455</td><td>-0.912281</td><td>-1.489029</td><td>-1.335363</td><td>-1.182195</td><td>-1.029028</td><td>null</td><td>-1.469571</td><td>-1.313909</td><td>null</td><td>-1.002086</td><td>null</td><td>-1.454105</td><td>null</td><td>-1.13829</td><td>null</td><td>-0.822476</td><td>-1.459094</td><td>-1.302933</td><td>-1.147271</td><td>-0.99111</td><td>-0.834949</td></tr><tr><td>1338.62</td><td>2005</td><td>1</td><td>3</td><td>12</td><td>null</td><td>2.5265e6</td><td>2.5186e6</td><td>2.5107e6</td><td>2.5027e6</td><td>2.5306e6</td><td>null</td><td>2.5141e6</td><td>2.5059e6</td><td>2.4977e6</td><td>2.5275e6</td><td>2.5190e6</td><td>2.5106e6</td><td>2.5021e6</td><td>2.4937e6</td><td>2.5249e6</td><td>2.5163e6</td><td>2.5077e6</td><td>2.4991e6</td><td>2.4904e6</td><td>null</td><td>2.5128e6</td><td>2.5039e6</td><td>null</td><td>2.4862e6</td><td>7.144935</td><td>7.119189</td><td>null</td><td>7.06702</td><td>7.041275</td><td>7.052792</td><td>7.025014</td><td>&hellip;</td><td>-4.404056</td><td>-4.307277</td><td>-4.611739</td><td>-4.511821</td><td>-4.412426</td><td>-4.312509</td><td>-4.213114</td><td>-4.539547</td><td>-4.442245</td><td>-4.344419</td><td>-4.247117</td><td>-4.149292</td><td>1.319376</td><td>1.435124</td><td>1.550374</td><td>1.666123</td><td>null</td><td>1.292933</td><td>1.408682</td><td>1.523932</td><td>1.639182</td><td>1.754431</td><td>null</td><td>1.387228</td><td>1.502478</td><td>1.617728</td><td>1.733477</td><td>1.255015</td><td>1.370265</td><td>1.485515</td><td>1.600765</td><td>1.716015</td><td>1.210612</td><td>1.319376</td><td>1.42814</td><td>1.536405</td><td>1.645169</td></tr><tr><td>562.5</td><td>2005</td><td>1</td><td>3</td><td>18</td><td>2.5295e6</td><td>null</td><td>2.5137e6</td><td>2.5058e6</td><td>2.4979e6</td><td>2.5256e6</td><td>2.5174e6</td><td>2.5092e6</td><td>2.5010e6</td><td>2.4928e6</td><td>null</td><td>2.5141e6</td><td>2.5057e6</td><td>2.4972e6</td><td>2.4888e6</td><td>null</td><td>2.5114e6</td><td>2.5028e6</td><td>null</td><td>2.4856e6</td><td>2.5167e6</td><td>2.5078e6</td><td>2.4990e6</td><td>2.4902e6</td><td>2.4813e6</td><td>6.861055</td><td>6.820404</td><td>6.779075</td><td>6.738424</td><td>6.697096</td><td>6.792626</td><td>6.748587</td><td>&hellip;</td><td>-3.332687</td><td>-3.272527</td><td>-3.431035</td><td>-3.369306</td><td>-3.307054</td><td>-3.245324</td><td>null</td><td>null</td><td>-3.320132</td><td>-3.262065</td><td>-3.203474</td><td>-3.145407</td><td>2.018858</td><td>2.106168</td><td>2.193977</td><td>2.281288</td><td>2.368599</td><td>1.986428</td><td>2.072741</td><td>2.159053</td><td>2.245366</td><td>2.331679</td><td>1.960484</td><td>null</td><td>2.131114</td><td>2.216928</td><td>2.302243</td><td>1.939031</td><td>null</td><td>null</td><td>2.193977</td><td>2.278793</td><td>1.873673</td><td>1.953</td><td>2.031829</td><td>2.111157</td><td>2.189986</td></tr><tr><td>232.3</td><td>2005</td><td>1</td><td>4</td><td>0</td><td>2.5297e6</td><td>2.5217e6</td><td>2.5137e6</td><td>2.5058e6</td><td>2.4978e6</td><td>2.5258e6</td><td>2.5175e6</td><td>2.5093e6</td><td>2.5010e6</td><td>2.4928e6</td><td>2.5227e6</td><td>2.5142e6</td><td>2.5058e6</td><td>2.4973e6</td><td>2.4888e6</td><td>2.5202e6</td><td>2.5116e6</td><td>2.5029e6</td><td>2.4943e6</td><td>2.4856e6</td><td>2.5169e6</td><td>2.5081e6</td><td>2.4992e6</td><td>2.4903e6</td><td>2.4814e6</td><td>6.454544</td><td>6.369855</td><td>6.284488</td><td>6.199798</td><td>6.115108</td><td>null</td><td>6.282455</td><td>&hellip;</td><td>0.01168</td><td>-0.167231</td><td>null</td><td>0.397226</td><td>null</td><td>0.042021</td><td>-0.135843</td><td>0.496621</td><td>0.323465</td><td>0.150309</td><td>-0.022847</td><td>null</td><td>5.333663</td><td>5.352123</td><td>5.370084</td><td>5.388544</td><td>null</td><td>5.33067</td><td>5.34464</td><td>5.358609</td><td>5.373078</td><td>5.387048</td><td>5.327676</td><td>5.338653</td><td>5.349629</td><td>5.360605</td><td>5.371581</td><td>5.325681</td><td>5.334162</td><td>5.342145</td><td>null</td><td>5.358609</td><td>5.231884</td><td>5.236375</td><td>5.240865</td><td>5.245854</td><td>5.250344</td></tr><tr><td>329.95</td><td>2005</td><td>1</td><td>4</td><td>6</td><td>2.5273e6</td><td>2.5193e6</td><td>2.5114e6</td><td>2.5034e6</td><td>2.4954e6</td><td>2.5235e6</td><td>2.5152e6</td><td>2.5070e6</td><td>2.4987e6</td><td>2.4904e6</td><td>2.5204e6</td><td>2.5120e6</td><td>null</td><td>2.4950e6</td><td>2.4865e6</td><td>2.5180e6</td><td>null</td><td>2.5006e6</td><td>2.4920e6</td><td>null</td><td>2.5147e6</td><td>null</td><td>2.4969e6</td><td>2.4880e6</td><td>2.4791e6</td><td>7.505374</td><td>7.346835</td><td>7.188973</td><td>7.031112</td><td>6.872573</td><td>7.42746</td><td>7.26621</td><td>&hellip;</td><td>4.028791</td><td>3.952414</td><td>4.159573</td><td>null</td><td>4.00525</td><td>null</td><td>null</td><td>null</td><td>3.862959</td><td>3.792336</td><td>3.722237</td><td>3.651615</td><td>null</td><td>null</td><td>4.619713</td><td>4.617218</td><td>4.614724</td><td>4.627197</td><td>4.62121</td><td>4.615223</td><td>4.609236</td><td>4.603249</td><td>4.629691</td><td>4.620711</td><td>4.612229</td><td>4.603249</td><td>4.594268</td><td>4.631687</td><td>4.620711</td><td>4.609236</td><td>4.598259</td><td>null</td><td>4.554355</td><td>4.542381</td><td>4.530407</td><td>4.518433</td><td>4.506459</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 555)</small><table border="1" class="dataframe"><thead><tr><th>energy</th><th>year</th><th>month</th><th>day</th><th>hour</th><th>p54.162.1</th><th>p54.162.2</th><th>p54.162.3</th><th>p54.162.4</th><th>p54.162.5</th><th>p54.162.6</th><th>p54.162.7</th><th>p54.162.8</th><th>p54.162.9</th><th>p54.162.10</th><th>p54.162.11</th><th>p54.162.12</th><th>p54.162.13</th><th>p54.162.14</th><th>p54.162.15</th><th>p54.162.16</th><th>p54.162.17</th><th>p54.162.18</th><th>p54.162.19</th><th>p54.162.20</th><th>p54.162.21</th><th>p54.162.22</th><th>p54.162.23</th><th>p54.162.24</th><th>p54.162.25</th><th>p55.162.1</th><th>p55.162.2</th><th>p55.162.3</th><th>p55.162.4</th><th>p55.162.5</th><th>p55.162.6</th><th>p55.162.7</th><th>&hellip;</th><th>u100.14</th><th>u100.15</th><th>u100.16</th><th>u100.17</th><th>u100.18</th><th>u100.19</th><th>u100.20</th><th>u100.21</th><th>u100.22</th><th>u100.23</th><th>u100.24</th><th>u100.25</th><th>v100.1</th><th>v100.2</th><th>v100.3</th><th>v100.4</th><th>v100.5</th><th>v100.6</th><th>v100.7</th><th>v100.8</th><th>v100.9</th><th>v100.10</th><th>v100.11</th><th>v100.12</th><th>v100.13</th><th>v100.14</th><th>v100.15</th><th>v100.16</th><th>v100.17</th><th>v100.18</th><th>v100.19</th><th>v100.20</th><th>v100.21</th><th>v100.22</th><th>v100.23</th><th>v100.24</th><th>v100.25</th></tr><tr><td>f64</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>&hellip;</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>1192.65</td><td>2009</td><td>12</td><td>29</td><td>18</td><td>null</td><td>2.4278e6</td><td>2.4209e6</td><td>2.4139e6</td><td>2.4070e6</td><td>2.4313e6</td><td>2.4241e6</td><td>2.4169e6</td><td>2.4097e6</td><td>2.4025e6</td><td>2.4286e6</td><td>2.4211e6</td><td>2.4137e6</td><td>2.4063e6</td><td>2.3989e6</td><td>2.4264e6</td><td>2.4188e6</td><td>2.4112e6</td><td>2.4035e6</td><td>2.3959e6</td><td>2.4236e6</td><td>2.4158e6</td><td>2.4079e6</td><td>2.4001e6</td><td>2.3923e6</td><td>16.454025</td><td>16.424892</td><td>16.395758</td><td>16.367303</td><td>16.338169</td><td>16.506871</td><td>16.47435</td><td>&hellip;</td><td>5.450134</td><td>null</td><td>5.606026</td><td>5.491461</td><td>null</td><td>5.262853</td><td>5.148811</td><td>5.427116</td><td>5.318828</td><td>5.210017</td><td>5.101729</td><td>4.992919</td><td>6.359437</td><td>6.266639</td><td>6.174339</td><td>6.08154</td><td>null</td><td>null</td><td>6.214751</td><td>null</td><td>6.013688</td><td>5.912906</td><td>6.281107</td><td>6.17384</td><td>6.066573</td><td>5.959804</td><td>5.852537</td><td>6.252669</td><td>6.140412</td><td>6.028156</td><td>5.9159</td><td>5.803643</td><td>6.22922</td><td>6.11397</td><td>5.999219</td><td>5.883969</td><td>null</td></tr><tr><td>968.28</td><td>2009</td><td>12</td><td>30</td><td>0</td><td>2.4198e6</td><td>2.4130e6</td><td>2.4061e6</td><td>2.3992e6</td><td>2.3924e6</td><td>2.4162e6</td><td>2.4091e6</td><td>2.4020e6</td><td>2.3948e6</td><td>2.3877e6</td><td>2.4134e6</td><td>2.4060e6</td><td>2.3987e6</td><td>2.3913e6</td><td>2.3840e6</td><td>2.4110e6</td><td>2.4035e6</td><td>2.3960e6</td><td>2.3885e6</td><td>2.3810e6</td><td>2.4082e6</td><td>2.4005e6</td><td>2.3927e6</td><td>2.3850e6</td><td>2.3773e6</td><td>19.033334</td><td>18.895798</td><td>18.758939</td><td>18.621403</td><td>18.484545</td><td>19.046884</td><td>18.902573</td><td>&hellip;</td><td>0.982608</td><td>null</td><td>0.956452</td><td>0.94285</td><td>0.928726</td><td>0.914601</td><td>null</td><td>1.179828</td><td>1.163611</td><td>1.147394</td><td>1.130654</td><td>1.114437</td><td>7.340807</td><td>7.180156</td><td>7.019505</td><td>6.858853</td><td>6.698202</td><td>7.370243</td><td>7.204603</td><td>7.038962</td><td>6.873322</td><td>null</td><td>7.393692</td><td>7.224061</td><td>7.054429</td><td>6.884797</td><td>6.715664</td><td>7.412651</td><td>7.240026</td><td>7.066902</td><td>6.894276</td><td>6.721651</td><td>null</td><td>7.437098</td><td>null</td><td>7.081869</td><td>6.904255</td></tr><tr><td>1280.13</td><td>2009</td><td>12</td><td>30</td><td>6</td><td>null</td><td>2.4001e6</td><td>2.3930e6</td><td>2.3859e6</td><td>2.3788e6</td><td>2.4037e6</td><td>2.3963e6</td><td>2.3890e6</td><td>2.3816e6</td><td>2.3743e6</td><td>2.4009e6</td><td>2.3933e6</td><td>2.3858e6</td><td>2.3782e6</td><td>2.3706e6</td><td>2.3987e6</td><td>2.3909e6</td><td>2.3832e6</td><td>2.3754e6</td><td>2.3677e6</td><td>2.3959e6</td><td>2.3880e6</td><td>2.3800e6</td><td>null</td><td>2.3640e6</td><td>14.99533</td><td>14.839501</td><td>14.682994</td><td>14.526488</td><td>14.370659</td><td>14.855084</td><td>14.693834</td><td>&hellip;</td><td>6.874092</td><td>6.824918</td><td>6.992843</td><td>6.939483</td><td>6.886124</td><td>6.832765</td><td>6.779406</td><td>6.970348</td><td>6.916989</td><td>6.86363</td><td>6.81027</td><td>null</td><td>9.382376</td><td>9.301552</td><td>9.221226</td><td>null</td><td>null</td><td>9.380381</td><td>9.289079</td><td>9.197777</td><td>null</td><td>9.015672</td><td>9.378884</td><td>9.279101</td><td>9.179816</td><td>9.080033</td><td>8.980249</td><td>9.377886</td><td>9.271118</td><td>9.164849</td><td>9.05808</td><td>8.951312</td><td>9.402832</td><td>9.291075</td><td>null</td><td>9.068059</td><td>8.9568</td></tr><tr><td>855.0</td><td>2009</td><td>12</td><td>30</td><td>12</td><td>2.4072e6</td><td>2.4001e6</td><td>2.3930e6</td><td>2.3859e6</td><td>2.3788e6</td><td>null</td><td>2.3963e6</td><td>2.3889e6</td><td>2.3816e6</td><td>2.3742e6</td><td>2.4009e6</td><td>2.3933e6</td><td>2.3857e6</td><td>2.3781e6</td><td>2.3705e6</td><td>null</td><td>2.3909e6</td><td>2.3831e6</td><td>2.3753e6</td><td>2.3676e6</td><td>2.3958e6</td><td>2.3878e6</td><td>null</td><td>2.3718e6</td><td>null</td><td>13.241914</td><td>13.198553</td><td>13.155192</td><td>13.112509</td><td>13.069148</td><td>13.059662</td><td>13.008848</td><td>&hellip;</td><td>7.371588</td><td>7.307766</td><td>7.424424</td><td>7.353279</td><td>7.28161</td><td>7.210464</td><td>7.139319</td><td>7.361126</td><td>null</td><td>7.201048</td><td>7.120486</td><td>null</td><td>6.839395</td><td>7.023995</td><td>7.208594</td><td>7.393194</td><td>7.577793</td><td>7.047444</td><td>7.21957</td><td>7.392196</td><td>null</td><td>null</td><td>7.212087</td><td>7.374734</td><td>7.537381</td><td>7.700028</td><td>7.862675</td><td>7.345796</td><td>null</td><td>7.655624</td><td>null</td><td>7.964953</td><td>7.457055</td><td>7.604734</td><td>7.751915</td><td>7.899595</td><td>8.047274</td></tr><tr><td>117.06</td><td>2009</td><td>12</td><td>30</td><td>18</td><td>2.4010e6</td><td>2.3937e6</td><td>2.3863e6</td><td>2.3790e6</td><td>2.3716e6</td><td>2.3975e6</td><td>2.3899e6</td><td>2.3823e6</td><td>2.3746e6</td><td>2.3670e6</td><td>2.3947e6</td><td>2.3869e6</td><td>2.3790e6</td><td>2.3712e6</td><td>2.3634e6</td><td>2.3924e6</td><td>2.3844e6</td><td>2.3764e6</td><td>null</td><td>2.3604e6</td><td>2.3897e6</td><td>null</td><td>2.3732e6</td><td>2.3650e6</td><td>2.3567e6</td><td>11.266951</td><td>11.208007</td><td>11.149063</td><td>11.090119</td><td>11.031175</td><td>11.143643</td><td>11.081311</td><td>&hellip;</td><td>3.018628</td><td>3.002934</td><td>2.870059</td><td>2.851226</td><td>2.832394</td><td>2.813561</td><td>2.794728</td><td>2.690626</td><td>2.675455</td><td>2.660284</td><td>2.64459</td><td>null</td><td>3.419318</td><td>3.471206</td><td>3.523093</td><td>null</td><td>3.627367</td><td>null</td><td>3.497648</td><td>3.549037</td><td>null</td><td>3.651315</td><td>3.468212</td><td>3.518603</td><td>3.568993</td><td>3.619384</td><td>3.669775</td><td>3.485674</td><td>3.535566</td><td>3.585458</td><td>3.635349</td><td>3.685241</td><td>3.505132</td><td>3.55203</td><td>3.598429</td><td>3.645328</td><td>3.691727</td></tr><tr><td>516.96</td><td>2009</td><td>12</td><td>31</td><td>12</td><td>2.3939e6</td><td>2.3865e6</td><td>2.3791e6</td><td>2.3718e6</td><td>2.3644e6</td><td>null</td><td>2.3826e6</td><td>2.3750e6</td><td>2.3673e6</td><td>2.3597e6</td><td>2.3874e6</td><td>2.3796e6</td><td>2.3717e6</td><td>2.3638e6</td><td>2.3560e6</td><td>2.3851e6</td><td>2.3771e6</td><td>2.3690e6</td><td>2.3610e6</td><td>2.3530e6</td><td>2.3822e6</td><td>2.3740e6</td><td>2.3657e6</td><td>2.3574e6</td><td>2.3492e6</td><td>13.24869</td><td>13.254787</td><td>13.260207</td><td>13.265628</td><td>13.271048</td><td>13.140287</td><td>13.140964</td><td>&hellip;</td><td>7.961678</td><td>7.548406</td><td>9.251192</td><td>8.82955</td><td>8.408431</td><td>7.986789</td><td>7.565146</td><td>9.297751</td><td>8.880294</td><td>null</td><td>8.044856</td><td>7.627399</td><td>1.769399</td><td>1.939031</td><td>2.108663</td><td>2.278295</td><td>null</td><td>1.859703</td><td>2.014866</td><td>2.170528</td><td>2.325692</td><td>2.481354</td><td>null</td><td>null</td><td>2.219422</td><td>2.363609</td><td>null</td><td>1.988424</td><td>null</td><td>null</td><td>null</td><td>2.529749</td><td>1.960983</td><td>2.094194</td><td>2.226906</td><td>2.360117</td><td>2.492829</td></tr><tr><td>867.07</td><td>2009</td><td>12</td><td>31</td><td>18</td><td>2.3923e6</td><td>2.3847e6</td><td>2.3770e6</td><td>2.3694e6</td><td>2.3618e6</td><td>2.3887e6</td><td>2.3808e6</td><td>2.3729e6</td><td>2.3650e6</td><td>2.3570e6</td><td>2.3858e6</td><td>2.3777e6</td><td>2.3695e6</td><td>2.3614e6</td><td>2.3533e6</td><td>2.3834e6</td><td>2.3752e6</td><td>2.3669e6</td><td>2.3586e6</td><td>2.3503e6</td><td>2.3805e6</td><td>null</td><td>2.3635e6</td><td>2.3550e6</td><td>2.3464e6</td><td>null</td><td>9.394293</td><td>9.4031</td><td>9.412586</td><td>null</td><td>9.27776</td><td>null</td><td>&hellip;</td><td>7.058757</td><td>7.013768</td><td>7.135657</td><td>7.079159</td><td>7.022661</td><td>6.966163</td><td>6.909665</td><td>7.119963</td><td>7.053526</td><td>null</td><td>6.920651</td><td>6.854213</td><td>null</td><td>1.642674</td><td>1.607251</td><td>1.572327</td><td>1.537402</td><td>1.831764</td><td>1.79634</td><td>1.761416</td><td>null</td><td>null</td><td>1.953998</td><td>1.918575</td><td>1.883651</td><td>1.848228</td><td>1.813304</td><td>2.052784</td><td>2.01786</td><td>1.982437</td><td>1.947512</td><td>1.912089</td><td>2.064259</td><td>2.031829</td><td>1.998901</td><td>1.966471</td><td>1.934042</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4748, 555)
</pre></div>
</div>
</div>
</div>
</section>
<section id="eda">
<h2><strong>EDA</strong><a class="headerlink" href="#eda" title="Link to this heading">#</a></h2>
<section id="variable-types">
<h3><strong>Variable types</strong><a class="headerlink" href="#variable-types" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dtypes</span><span class="o">=</span> <span class="n">dtypes_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">wind_df</span><span class="p">)</span>
<span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (555, 2)</small><table border="1" class="dataframe"><thead><tr><th>Columns</th><th>Python_type</th></tr><tr><td>str</td><td>object</td></tr></thead><tbody><tr><td>&quot;energy&quot;</td><td>Float64</td></tr><tr><td>&quot;year&quot;</td><td>Int64</td></tr><tr><td>&quot;month&quot;</td><td>Int64</td></tr><tr><td>&quot;day&quot;</td><td>Int64</td></tr><tr><td>&quot;hour&quot;</td><td>Int64</td></tr><tr><td>&quot;p54.162.1&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.2&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.3&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.4&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.5&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.6&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.7&quot;</td><td>Float64</td></tr><tr><td>&hellip;</td><td>&hellip;</td></tr><tr><td>&quot;v100.14&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.15&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.16&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.17&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.18&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.19&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.20&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.21&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.22&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.23&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.24&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.25&quot;</td><td>Float64</td></tr></tbody></table></div></div></div>
</div>
<p>Since there are many variables we cannot see their python types at glance. Therefore we are going to count how many variables are of each type and determine who are them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dtypes_arr</span> <span class="o">=</span> <span class="n">dtypes</span><span class="p">[</span><span class="s1">&#39;Python_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Number of integer (<code class="docutils literal notranslate"><span class="pre">Int64</span></code>) variables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_int64</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dtypes_arr</span> <span class="o">==</span> <span class="n">pl</span><span class="o">.</span><span class="n">Int64</span><span class="p">)</span>
<span class="n">num_int64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
</div>
</div>
<p>Determining who are these integer variables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">int64_col_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dtypes_arr</span> <span class="o">==</span> <span class="n">pl</span><span class="o">.</span><span class="n">Int64</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dtypes</span><span class="p">[</span><span class="n">int64_col_index</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 2)</small><table border="1" class="dataframe"><thead><tr><th>Columns</th><th>Python_type</th></tr><tr><td>str</td><td>object</td></tr></thead><tbody><tr><td>&quot;year&quot;</td><td>Int64</td></tr><tr><td>&quot;month&quot;</td><td>Int64</td></tr><tr><td>&quot;day&quot;</td><td>Int64</td></tr><tr><td>&quot;hour&quot;</td><td>Int64</td></tr></tbody></table></div></div></div>
</div>
<p>Number of float (<code class="docutils literal notranslate"><span class="pre">Float64</span></code>) variables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_float64</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dtypes_arr</span> <span class="o">==</span> <span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">)</span>
<span class="n">num_float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>551
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">float64_col_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dtypes_arr</span> <span class="o">==</span> <span class="n">pl</span><span class="o">.</span><span class="n">Float64</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dtypes</span><span class="p">[</span><span class="n">float64_col_index</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (551, 2)</small><table border="1" class="dataframe"><thead><tr><th>Columns</th><th>Python_type</th></tr><tr><td>str</td><td>object</td></tr></thead><tbody><tr><td>&quot;energy&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.1&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.2&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.3&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.4&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.5&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.6&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.7&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.8&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.9&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.10&quot;</td><td>Float64</td></tr><tr><td>&quot;p54.162.11&quot;</td><td>Float64</td></tr><tr><td>&hellip;</td><td>&hellip;</td></tr><tr><td>&quot;v100.14&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.15&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.16&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.17&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.18&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.19&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.20&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.21&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.22&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.23&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.24&quot;</td><td>Float64</td></tr><tr><td>&quot;v100.25&quot;</td><td>Float64</td></tr></tbody></table></div></div></div>
</div>
<p>There are no more variable types since the sum of those types is equal to the total number of variables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">wind_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">==</span> <span class="n">num_int64</span> <span class="o">+</span> <span class="n">num_float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="missing-values-analysis">
<h3><strong>Missing values analysis</strong><a class="headerlink" href="#missing-values-analysis" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prop_cols_nulls</span><span class="p">(</span><span class="n">wind_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 555)</small><table border="1" class="dataframe"><thead><tr><th>energy</th><th>year</th><th>month</th><th>day</th><th>hour</th><th>p54.162.1</th><th>p54.162.2</th><th>p54.162.3</th><th>p54.162.4</th><th>p54.162.5</th><th>p54.162.6</th><th>p54.162.7</th><th>p54.162.8</th><th>p54.162.9</th><th>p54.162.10</th><th>p54.162.11</th><th>p54.162.12</th><th>p54.162.13</th><th>p54.162.14</th><th>p54.162.15</th><th>p54.162.16</th><th>p54.162.17</th><th>p54.162.18</th><th>p54.162.19</th><th>p54.162.20</th><th>p54.162.21</th><th>p54.162.22</th><th>p54.162.23</th><th>p54.162.24</th><th>p54.162.25</th><th>p55.162.1</th><th>p55.162.2</th><th>p55.162.3</th><th>p55.162.4</th><th>p55.162.5</th><th>p55.162.6</th><th>p55.162.7</th><th>&hellip;</th><th>u100.14</th><th>u100.15</th><th>u100.16</th><th>u100.17</th><th>u100.18</th><th>u100.19</th><th>u100.20</th><th>u100.21</th><th>u100.22</th><th>u100.23</th><th>u100.24</th><th>u100.25</th><th>v100.1</th><th>v100.2</th><th>v100.3</th><th>v100.4</th><th>v100.5</th><th>v100.6</th><th>v100.7</th><th>v100.8</th><th>v100.9</th><th>v100.10</th><th>v100.11</th><th>v100.12</th><th>v100.13</th><th>v100.14</th><th>v100.15</th><th>v100.16</th><th>v100.17</th><th>v100.18</th><th>v100.19</th><th>v100.20</th><th>v100.21</th><th>v100.22</th><th>v100.23</th><th>v100.24</th><th>v100.25</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>&hellip;</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.078349</td><td>0.097094</td><td>0.055392</td><td>0.066133</td><td>0.102991</td><td>0.17797</td><td>0.182393</td><td>0.119629</td><td>0.095198</td><td>0.057287</td><td>0.171441</td><td>0.090775</td><td>0.183024</td><td>0.055602</td><td>0.080666</td><td>0.049495</td><td>0.182814</td><td>0.163648</td><td>0.186394</td><td>0.100463</td><td>0.179655</td><td>0.165965</td><td>0.116049</td><td>0.146799</td><td>0.125948</td><td>0.067818</td><td>0.066344</td><td>0.155223</td><td>0.073926</td><td>0.098989</td><td>0.062763</td><td>0.098147</td><td>&hellip;</td><td>0.085299</td><td>0.060236</td><td>0.135636</td><td>0.148062</td><td>0.120051</td><td>0.110994</td><td>0.131213</td><td>0.138374</td><td>0.096251</td><td>0.170598</td><td>0.081087</td><td>0.125316</td><td>0.127001</td><td>0.179865</td><td>0.117313</td><td>0.10615</td><td>0.15754</td><td>0.084035</td><td>0.195872</td><td>0.072662</td><td>0.181129</td><td>0.194398</td><td>0.096462</td><td>0.161331</td><td>0.102359</td><td>0.092039</td><td>0.081719</td><td>0.128054</td><td>0.119419</td><td>0.153749</td><td>0.196293</td><td>0.056445</td><td>0.054971</td><td>0.081508</td><td>0.11984</td><td>0.121946</td><td>0.091828</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prop_row_nulls</span><span class="p">(</span><span class="n">wind_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.11711712, 0.12792793, 0.12072072, ..., 0.11531532, 0.11891892,
       0.11891892])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prop_row_nulls</span><span class="p">(</span><span class="n">wind_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4748
</pre></div>
</div>
</div>
</div>
<p>From the previous results whe know that there are 4748 observations of  555.</p>
<p>All variables except for energy, <code class="docutils literal notranslate"><span class="pre">year</span></code>, <code class="docutils literal notranslate"><span class="pre">day</span></code>, <code class="docutils literal notranslate"><span class="pre">month</span></code> and <code class="docutils literal notranslate"><span class="pre">hour</span></code> have missing values.</p>
<p>Some variables have more than 20% of missing values.  Also, we know that every row has missing values.</p>
<p>Data imputation is going to be very important because we have high dimensionality and also a significant amount of missing variables per observation.</p>
</section>
<section id="analysis-of-the-response">
<h3><strong>Analysis of the Response</strong><a class="headerlink" href="#analysis-of-the-response" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;energy&#39;</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wind_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<section id="descriptive-summary">
<h4><strong>Descriptive summary</strong><a class="headerlink" href="#descriptive-summary" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_summary</span><span class="p">,</span> <span class="n">cat_summary</span> <span class="o">=</span> <span class="n">summary</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">wind_df</span><span class="p">,</span> <span class="n">auto_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">quant_col_names</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span>
                                     <span class="n">cat_col_names</span><span class="o">=</span><span class="p">[])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>energy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>n_unique</th>
      <td>4543</td>
    </tr>
    <tr>
      <th>prop_nan</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>693.126247</td>
    </tr>
    <tr>
      <th>std</th>
      <td>665.531609</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.01</td>
    </tr>
    <tr>
      <th>Q10</th>
      <td>21.46</td>
    </tr>
    <tr>
      <th>Q25</th>
      <td>144.17</td>
    </tr>
    <tr>
      <th>median</th>
      <td>465.305</td>
    </tr>
    <tr>
      <th>Q75</th>
      <td>1089.35</td>
    </tr>
    <tr>
      <th>Q90</th>
      <td>1775.66</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2792.55</td>
    </tr>
    <tr>
      <th>kurtosis</th>
      <td>2.919896</td>
    </tr>
    <tr>
      <th>skew</th>
      <td>0.967298</td>
    </tr>
    <tr>
      <th>n_outliers</th>
      <td>22</td>
    </tr>
    <tr>
      <th>n_not_outliers</th>
      <td>4726</td>
    </tr>
    <tr>
      <th>prop_outliers</th>
      <td>0.004634</td>
    </tr>
    <tr>
      <th>prop_not_outliers</th>
      <td>0.995366</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="histogram">
<h4><strong>Histogram</strong><a class="headerlink" href="#histogram" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">wind_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">x_rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8cdb71ef130e30adbe7141837592d18b4462368e267aa7d1d0de4a1f80cd1e20.png" src="_images/8cdb71ef130e30adbe7141837592d18b4462368e267aa7d1d0de4a1f80cd1e20.png" />
</div>
</div>
</section>
<section id="frequencies">
<h4><strong>Frequencies</strong><a class="headerlink" href="#frequencies" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response_cat</span> <span class="o">=</span> <span class="n">quant_to_cat</span><span class="p">(</span><span class="n">wind_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">rule</span><span class="o">=</span><span class="s1">&#39;quartiles&#39;</span><span class="p">,</span> <span class="n">n_intervals</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">freq_table</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">response_cat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 5)</small><table border="1" class="dataframe"><thead><tr><th>energy: unique values</th><th>abs_freq</th><th>rel_freq</th><th>cum_abs_freq</th><th>cum_rel_freq</th></tr><tr><td>object</td><td>i64</td><td>f64</td><td>i64</td><td>f64</td></tr></thead><tbody><tr><td>(-inf, 0.01]</td><td>19</td><td>0.004</td><td>19</td><td>0.004002</td></tr><tr><td>(0.01, 144.17]</td><td>1170</td><td>0.2464</td><td>1189</td><td>0.250421</td></tr><tr><td>(144.17, 466.34]</td><td>1186</td><td>0.2498</td><td>2375</td><td>0.500211</td></tr><tr><td>(466.34, 1089.35]</td><td>1186</td><td>0.2498</td><td>3561</td><td>0.75</td></tr><tr><td>(1089.35, 2792.55]</td><td>1187</td><td>0.25</td><td>4748</td><td>1.0</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="boxplot">
<h4><strong>Boxplot</strong><a class="headerlink" href="#boxplot" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxplot</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">wind_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">n_xticks</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">x_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">statistics</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/03fd4c3baff0fdc2313fcf1317c70e08099d5a70cf42d0b5d4fa66e041d47e82.png" src="_images/03fd4c3baff0fdc2313fcf1317c70e08099d5a70cf42d0b5d4fa66e041d47e82.png" />
</div>
</div>
</section>
<section id="ecdf-plot">
<h4><strong>ECDF-plot</strong><a class="headerlink" href="#ecdf-plot" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ecdfplot</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">wind_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/36c15ac8350daf57a77c23cdf0a99614f2cf979c30e53e3158237bee36807bb5.png" src="_images/36c15ac8350daf57a77c23cdf0a99614f2cf979c30e53e3158237bee36807bb5.png" />
</div>
</div>
</section>
<section id="outliers">
<h4><strong>Outliers</strong><a class="headerlink" href="#outliers" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outliers_table</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">wind_df</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">col_names</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 7)</small><table border="1" class="dataframe"><thead><tr><th>quant_variables</th><th>lower_bound</th><th>upper_bound</th><th>n_outliers</th><th>n_not_outliers</th><th>prop_outliers</th><th>prop_not_outliers</th></tr><tr><td>str</td><td>f64</td><td>f64</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;energy&quot;</td><td>-1273.6</td><td>2507.12</td><td>22</td><td>4726</td><td>0.004634</td><td>0.995366</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">cv_energy = np.std(wind_data.energy.to_numpy()) / np.mean(wind_data.energy.to_numpy())</span>
<span class="sd">print(f&#39;Coefficient of variance energy produced: {100*cv_energy:.4f}%&#39;)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Coefficient of variance energy produced: 96.01%</p>
<p>The response has a very high coefficient of variance (&gt; 96%). Around 50% of the observations have an energy production of 500 or less, and the other half take values up to 2800. With a high coefficient of variance, if we apply RMSE  our models will be very influenced by these extreme values.</p>
</section>
<section id="time-series-analysis">
<h4><strong>Time series analysis</strong><a class="headerlink" href="#time-series-analysis" title="Link to this heading">#</a></h4>
<section id="autocorrelation">
<h5><strong>Autocorrelation</strong><a class="headerlink" href="#autocorrelation" title="Link to this heading">#</a></h5>
<p>Next, we know that our response has been measured everyday at 4 different moments every 6 hours. We are going to analyze if there is correlation between the response and it’s lag. We expect some because the response depends on several meteorological events, and during a day it can vary a lot, but, usually, if there are high winds at a given hour, most probably there will be at t + 6 hours.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">def correct_hour_day_month(x):</span>
<span class="sd">    return f&#39;0{x}&#39; if len(x) == 1 else f&#39;{x}&#39;</span>

<span class="sd">wind_data.hour = wind_data.hour.astype(str)</span>
<span class="sd">wind_data.day = wind_data.day.astype(str)</span>
<span class="sd">wind_data.month = wind_data.month.astype(str)</span>
<span class="sd">wind_data.year = wind_data.year.astype(str)</span>

<span class="sd">wind_data[&#39;hour_corrected&#39;] = wind_data.hour.apply(correct_hour_day_month)</span>
<span class="sd">wind_data[&#39;day_corrected&#39;] = wind_data.day.apply(correct_hour_day_month)</span>
<span class="sd">wind_data[&#39;month_corrected&#39;] = wind_data.month.apply(correct_hour_day_month)</span>

<span class="sd">wind_data[&#39;fecha&#39;] = wind_data.apply(lambda row: pd.to_datetime(f&#39;{row.day_corrected}-{row.month_corrected}-{row.year} {row.hour_corrected}:00&#39;, format=&#39;%d-%m-%Y %H:%M&#39;), axis=1)</span>
<span class="sd">wind_data = wind_data.drop([&#39;month&#39;, &#39;day&#39;, &#39;hour&#39;], axis=1)</span>

<span class="sd">wind_data = wind_data.sort_values(by=&#39;fecha&#39;)</span>
<span class="sd">wind_data[&#39;energy_lag&#39;] = wind_data[&#39;energy&#39;].shift()</span>

<span class="sd"># Create a scatter plot</span>
<span class="sd">plt.scatter(wind_data[&#39;energy&#39;].iloc[1:], wind_data[&#39;energy_lag&#39;].iloc[1:])</span>
<span class="sd">plt.xlabel(&#39;Energy&#39;)</span>
<span class="sd">plt.ylabel(&#39;Energy Lag&#39;)</span>
<span class="sd">plt.title(&#39;Energy production vs its preceding observation&#39;)</span>
<span class="sd">plt.show()</span>

<span class="sd">print(&#39;Linear correlation Energy vs lag: {:.4f}&#39;.format(wind_data[&quot;energy&quot;].iloc[1:].corr(wind_data[&quot;energy_lag&quot;].iloc[1:])))</span>
<span class="sd">wind_data = wind_data.drop(&#39;energy_lag&#39;, axis=1)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<img src="plots/time_series_autocorr.png" width="500" height="auto">
<p>The linear correlation is obvious. This will affect the way we do the inner and outer evaluation of the models as we can’t use random sampling because our model would return overconfident test performance metrics and the selection of hyperparameters would be done with a bias.</p>
</section>
</section>
<section id="statistics-by-year">
<h4><strong>Statistics by year</strong><a class="headerlink" href="#statistics-by-year" title="Link to this heading">#</a></h4>
<p>Next, in order to decide how to do the inner and outer evaluation, we are going to analyze the timeserie of the response. First we want to look at the years. The idea is to check if all follow a similar distribution and count the number of observations. Second, we want to look at the months to see if the amount of energy produced is independent of the month or not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># Statistics for each year</span>
<span class="sd">energy_stats_by_year = wind_data.groupby(&#39;year&#39;)[&#39;energy&#39;].describe()</span>
<span class="sd">print(energy_stats_by_year)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># OUTPUT</span>
<span class="sd">       count        mean         std   min       25%      50%        75%  \</span>
<span class="sd">year                                                                       </span>
<span class="sd">2005  1256.0  718.697078  669.357880  0.01  173.1775  515.745  1098.3100   </span>
<span class="sd">2006  1272.0  635.094505  656.110591  0.01   97.8425  393.630   999.6725   </span>
<span class="sd">2007  1121.0  707.736753  653.687550  0.01  160.1400  476.100  1131.9600   </span>
<span class="sd">2008   178.0  829.901685  738.224964  0.02  155.2150  613.125  1443.2225   </span>
<span class="sd">2009   921.0  694.184886  667.122141  0.01  156.9100  467.030  1060.9700   </span>

<span class="sd">          max  </span>
<span class="sd">year           </span>
<span class="sd">2005  2774.89  </span>
<span class="sd">2006  2552.41  </span>
<span class="sd">2007  2547.09  </span>
<span class="sd">2008  2363.49  </span>
<span class="sd">2009  2792.55</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># ANOVA for &#39;05, &#39;06 an d&#39;07</span>
<span class="sd">f_statistic, p_value = stats.f_oneway(energy_stats_by_year[energy_stats_by_year.index.isin([&#39;2005&#39;, &#39;2006&#39;, &#39;2007&#39;])][&#39;mean&#39;], energy_stats_by_year[energy_stats_by_year.index.isin([&#39;2005&#39;, &#39;2006&#39;, &#39;2007&#39;])][&#39;std&#39;], energy_stats_by_year[energy_stats_by_year.index.isin([&#39;2005&#39;, &#39;2006&#39;, &#39;2007&#39;])][&#39;count&#39;])</span>

<span class="sd">alpha = 0.01</span>
<span class="sd">if p_value &lt; alpha:</span>
<span class="sd">    print(f&quot;Reject the null hypothesis. There is a significant difference in means for 2005, 2006 and 2007.&quot;)</span>
<span class="sd">else:</span>
<span class="sd">    print(&quot;Fail to reject the null hypothesis. There is no significant difference in means for 2005, 2006 and 2007.&quot;)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Reject the null hypothesis. There is a significant difference in means for 2005, 2006 and 2007.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># Plot the timeserie of each year</span>

<span class="sd">years = range(2005, 2010)</span>
<span class="sd">wind_data_years = [wind_data[(wind_data[&#39;fecha&#39;] &gt;= pd.to_datetime(f&#39;{year}-01-01&#39;)) &amp; (wind_data[&#39;fecha&#39;] &lt; pd.to_datetime(f&#39;{year + 1}-01-01&#39;))] for year in years]</span>
<span class="sd">max_energy = max(data[&#39;energy&#39;].max() for data in wind_data_years) + 200 # Get the max to fix the y_lim range in all plots</span>

<span class="sd">fig, axes = plt.subplots(2, 3, figsize=(16, 8))</span>
<span class="sd">for ax, data, year in zip(axes.flatten(), wind_data_years, years):</span>
<span class="sd">    ax.scatter(data[&#39;fecha&#39;], data[&#39;energy&#39;])</span>
<span class="sd">    ax.set_title(f&#39;Year {year}&#39;)</span>
<span class="sd">    ax.set_ylim(0, max_energy)</span>

<span class="sd">axes[1, 2].axis(&#39;off&#39;) # Hide empty subplot</span>
<span class="sd">plt.tight_layout()</span>
<span class="sd">plt.show()</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="image.png" src="_images/time_series_1.png" /></p>
<p>The plots and statistics reveal several things:</p>
<ul class="simple">
<li><p>We have a smaller sample for 2008 and 2009, especially 2008 (178 observations)</p></li>
<li><p>Altough the ANOVA test for ‘05, ‘06 and ‘07 has revealed evidence that the means are different, the distributions are similar if we look at the quantiles</p></li>
<li><p>Some years have a smaller sample of data in certain months</p></li>
<li><p>2008 has data only until February</p></li>
<li><p>2009 has no data before March and the last two months of the year have very high mean and median</p></li>
</ul>
<p>With this, we know that we have to be careful when partitioning the years for training, testing and validation because we could end up validating and/or testing on years with no data for a given month, thus, introducing a bias.</p>
<p>Next, we look at the months.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># Distribution of Energy for each month in 2009</span>
<span class="sd">wind_data[(wind_data[&#39;fecha&#39;] &gt;= pd.to_datetime(f&#39;2009-01-01&#39;)) &amp; (wind_data[&#39;fecha&#39;] &lt; pd.to_datetime(f&#39;2010-01-01&#39;))].groupby(&#39;month_corrected&#39;)[&#39;energy&#39;].describe()</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="image.png" src="_images/time_series_3.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># Statistics per month</span>
<span class="sd">energy_stats_by_month = wind_data.groupby(&#39;month_corrected&#39;)[&#39;energy&#39;].describe()</span>
<span class="sd">print(energy_stats_by_month)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># OUTPUT</span>
<span class="sd">                 count        mean         std   min       25%      50%  \</span>
<span class="sd">month_corrected                                                           </span>
<span class="sd">01               414.0  769.640459  706.303381  0.01  150.8850  537.290   </span>
<span class="sd">02               373.0  786.625228  681.911100  0.02  164.8400  592.520   </span>
<span class="sd">03               306.0  919.219150  748.412370  0.02  213.8775  774.600   </span>
<span class="sd">04               413.0  599.231671  583.613640  0.01  147.0100  409.530   </span>
<span class="sd">05               426.0  641.243310  626.290574  0.02  131.8125  415.400   </span>
<span class="sd">06               357.0  544.173754  572.353719  0.01  103.2300  321.130   </span>
<span class="sd">07               384.0  423.834323  486.443940  0.01   63.9275  206.095   </span>
<span class="sd">08               440.0  506.656523  510.917812  0.01   98.7075  359.645   </span>
<span class="sd">09               368.0  548.853288  556.973683  0.02  117.0850  351.715   </span>
<span class="sd">10               412.0  669.815024  628.326946  0.01  145.1450  494.800   </span>
<span class="sd">11               432.0  981.925069  767.750402  0.01  286.9400  792.305   </span>
<span class="sd">12               423.0  933.576738  766.851606  0.01  262.0750  754.500   </span>

<span class="sd">                       75%      max  </span>
<span class="sd">month_corrected                      </span>
<span class="sd">01               1305.3700  2492.47  </span>
<span class="sd">02               1309.7100  2508.97  </span>
<span class="sd">03               1584.8550  2574.03  </span>
<span class="sd">04                909.3300  2610.74  </span>
<span class="sd">05               1066.1825  2536.88  </span>
<span class="sd">06                845.1900  2586.51  </span>
<span class="sd">07                671.9600  2415.42  </span>
<span class="sd">08                734.7050  2214.61  </span>
<span class="sd">09                839.7450  2344.45  </span>
<span class="sd">10               1023.1700  2495.43  </span>
<span class="sd">11               1571.6550  2745.86  </span>
<span class="sd">12               1533.1950  2792.55</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">plt.figure(figsize=(10, 6))</span>
<span class="sd">plt.plot(energy_stats_by_month.reset_index()[&#39;month_corrected&#39;], energy_stats_by_month[&#39;mean&#39;], marker=&#39;o&#39;, linestyle=&#39;-&#39;, color=&#39;b&#39;)</span>

<span class="sd">plt.xlabel(&#39;Month&#39;)</span>
<span class="sd">plt.ylabel(&#39;Mean Energy Produced&#39;)</span>
<span class="sd">plt.title(&#39;Mean Energy Produced Each Month&#39;)</span>
<span class="sd">plt.grid(True)</span>
<span class="sd">plt.show()</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="image.png" src="_images/time_series_2.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd"># ANOVA by month</span>
<span class="sd">f_statistic, p_value = stats.f_oneway(energy_stats_by_month[&#39;mean&#39;], energy_stats_by_month[&#39;std&#39;], energy_stats_by_month[&#39;count&#39;])</span>

<span class="sd">alpha = 0.01  </span>
<span class="sd">if p_value &lt; alpha:</span>
<span class="sd">    print(f&quot;Reject the null hypothesis. There is a significant difference in the means of each month.&quot;)</span>
<span class="sd">else:</span>
<span class="sd">    print(&quot;Fail to reject the null hypothesis. There is no significant difference in the means of each month.&quot;)</span>

<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Reject the null hypothesis. There is a significant difference in the means of each month.</p>
<p>The energy produced is not independent of the month. March, November and December seem to be the ones when the most energy is produced. This is very important because it is telling us that when training and testing, we should do it with full years, or at least, having data from all months. Also, we have to account for the autocorrelation of the response so that no random sampling is allowed.</p>
<p>Having years with no data in some months, and other years with a much smaller sample of data suggests that k-fold crossvalidation has to be taken with ease, specially when <span class="math notranslate nohighlight">\(k\)</span> big because we could end up training with no data for some months, or testing with missing months and other scenarios that can be biased and non-robust estimations of future performance and best hyperparameters.</p>
<p>Last, we look at the distribution of energy produced by the 4 different hours that we have.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">fig, axes = plt.subplots(2, 2, figsize=(10, 8))</span>
<span class="sd">hour_values = wind_data.hour_corrected.unique().tolist()</span>

<span class="sd">for hour, ax in zip(hour_values, axes.flatten()):</span>
<span class="sd">    subset = wind_data[wind_data[&#39;hour_corrected&#39;] == hour]</span>
<span class="sd">    ax.hist(subset[&#39;energy&#39;], bins=20, edgecolor=&#39;black&#39;, density=True)</span>
<span class="sd">    ax.set_title(f&#39;Hour - {hour}&#39;)</span>
<span class="sd">    ax.set_xlabel(&#39;Energy&#39;)</span>
<span class="sd">    ax.set_ylabel(&#39;Density&#39;)</span>
<span class="sd">    ax.set_ylim(0, 0.0022)</span>

<span class="sd">plt.tight_layout()</span>
<span class="sd">plt.show()</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="image.png" src="_images/time_series_4.png" /></p>
<p>The energy production seems to be independent of the hour of the day.</p>
</section>
</section>
<section id="analysis-of-relationship-between-response-and-predictors">
<h3><strong>Analysis of relationship between Response and Predictors</strong><a class="headerlink" href="#analysis-of-relationship-between-response-and-predictors" title="Link to this heading">#</a></h3>
<p>In this section we are going to analyze the correlation between the response an the predictors, as well as between the predictors itself. All of the are quantitative, therefore we will use the Pearson linear correlation coefficient to measure this.</p>
<p>Since we have a set of predictors per location, we will be focus in one of them, for example Sotavento location (13).</p>
<p>After that we will explore if there are significative differences in these correlation depending on the location.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_locations</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">predictors_location</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_locations</span><span class="p">):</span>
    <span class="n">predictors_location</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wind_df</span><span class="p">[</span><span class="n">predictors</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;\.</span><span class="si">{</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">(?![0-9])&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)]</span>

<span class="n">predictors_not_loc</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_matrix_loc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_locations</span><span class="p">):</span>
    <span class="n">corr_matrix_loc</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">wind_df</span><span class="p">[[</span><span class="n">response</span><span class="p">]</span> <span class="o">+</span> <span class="n">predictors_location</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span> <span class="n">auto_col</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">corr_matrix_loc</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">response</span><span class="p">]</span> <span class="o">+</span> <span class="n">predictors_not_loc</span>
    <span class="n">corr_matrix_loc</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">response</span><span class="p">]</span> <span class="o">+</span> <span class="n">predictors_not_loc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix_loc</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Correlation Heatmap - Location 13 (Sotavento)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c1">#plt.savefig(&#39;Correlation_Heatmap_Location_13&#39; + &#39;.jpg&#39;, format=&#39;jpg&#39;, dpi=400)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ed48b5931c0bb4dcf6d974522911acba776615caab35f5189c668faa52b32b3d.png" src="_images/ed48b5931c0bb4dcf6d974522911acba776615caab35f5189c668faa52b32b3d.png" />
</div>
</div>
<p>Let’s take a look to the correlation between response a predictors with more detail:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_loc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_locations</span><span class="p">):</span>
    <span class="n">corr_loc</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">wind_df</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="n">predictors</span><span class="o">=</span><span class="n">predictors_location</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_loc</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation Heatmap - Location 13 (Sotavento)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="c1">#plt.savefig(&#39;Correlation_Heatmap_Location_13_response&#39; + &#39;.jpg&#39;, format=&#39;jpg&#39;, dpi=400)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/917dbe8b2d12422d642a6c74d9361a6c3049020f2b6b8e37aa8b4a244f59f8e6.png" src="_images/917dbe8b2d12422d642a6c74d9361a6c3049020f2b6b8e37aa8b4a244f59f8e6.png" />
</div>
</div>
<p>Now we are going to analyze if there are differences in the correlation <em>between response and predictors</em> explained by the location.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_cols</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_locations</span><span class="o">/</span><span class="n">n_cols</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> 
<span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;tab10&quot;</span><span class="p">,</span> <span class="n">num_locations</span><span class="p">)</span>

<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_locations</span><span class="p">),</span> <span class="n">colors</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> 
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">corr_loc</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">predictors_not_loc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Location </span><span class="si">{</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Corr(Energy, Predictors)&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_locations</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="n">n_cols</span><span class="p">):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Corr(Energy, Predictors) by locations&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.92</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span> 

<span class="c1">#fig.savefig(&#39;Corr(Energy, Predictors)_Locations&#39; + &#39;.jpg&#39;, format=&#39;jpg&#39;, dpi=400)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a895aef7604058b35e9b34268f21baec3f320dffa740585b3f8f627a44d507a2.png" src="_images/a895aef7604058b35e9b34268f21baec3f320dffa740585b3f8f627a44d507a2.png" />
</div>
</div>
<ul class="simple">
<li><p>The plot is pretty clear, there are no significant differences in the correlation between the response (<code class="docutils literal notranslate"><span class="pre">energy</span></code>) and the rest of predictors depending on the location.</p></li>
</ul>
<p>Now we are going to do a similar analysis but to explore if there are differences in the correlation <em>between predictors</em> explained by the location.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_cols</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_locations</span><span class="o">/</span><span class="n">n_cols</span><span class="p">))</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;tab10&quot;</span><span class="p">,</span> <span class="n">num_locations</span><span class="p">)</span>

<span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictors_not_loc</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>

    <span class="n">subset_predictors</span> <span class="o">=</span> <span class="n">predictors_not_loc</span><span class="p">[</span><span class="n">limits</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">limits</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> 
   
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_locations</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> 
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">subset_predictors</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">corr_matrix_loc</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">col</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">predictors_not_loc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Location </span><span class="si">{</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Corr(Predictor[</span><span class="si">{</span><span class="n">limits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">limits</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">], Predictors)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>  <span class="c1"># Remove individual subplot legends</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_locations</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="n">n_cols</span><span class="p">):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Corr(Predictor[</span><span class="si">{</span><span class="n">limits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">limits</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">], Predictors) by locations&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.92</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span> 

    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span> 
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">subset_predictors</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">subset_predictors</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1">#fig.savefig(f&#39;Corr(Predictor[{limits[i]}-{limits[i+1]}], Predictors)_Locations&#39; + &#39;.jpg&#39;, format=&#39;jpg&#39;, dpi=400)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a3203018cc149e8362a304003484f1b1b43b1fe5acf6e842707429ec05c92c83.png" src="_images/a3203018cc149e8362a304003484f1b1b43b1fe5acf6e842707429ec05c92c83.png" />
<img alt="_images/bac61f47444c177f836759d067f991592814f4a85ba2cdaf6d164f8b3a0c4d48.png" src="_images/bac61f47444c177f836759d067f991592814f4a85ba2cdaf6d164f8b3a0c4d48.png" />
<img alt="_images/592d52e258288d9cb58bd9746239f4aa290fabb70d0aaa508a9af000a6c51021.png" src="_images/592d52e258288d9cb58bd9746239f4aa290fabb70d0aaa508a9af000a6c51021.png" />
<img alt="_images/fcac3e2b9d37dcd4358d14a26284b6239593987fa5fa95f772c33413487880b4.png" src="_images/fcac3e2b9d37dcd4358d14a26284b6239593987fa5fa95f772c33413487880b4.png" />
<img alt="_images/a22b5275cbfb7d93c5661fcceb973f1108d4912249ddaca97fe06208f209519e.png" src="_images/a22b5275cbfb7d93c5661fcceb973f1108d4912249ddaca97fe06208f209519e.png" />
</div>
</div>
<ul class="simple">
<li><p>As before, plots are very informative an illustrate that there are not significative difference in the correlation between response and predictors due to location.</p></li>
</ul>
</section>
<section id="eda-conclusions-and-things-to-take-care-of">
<h3><strong>EDA conclusions and things to take care of</strong><a class="headerlink" href="#eda-conclusions-and-things-to-take-care-of" title="Link to this heading">#</a></h3>
<p>Some conclusions from all the previous results:</p>
<ul class="simple">
<li><p>We have a small dataset (4748 observations) and there is high dimensionality with a lot of missing cells. We can not afford to loose observations so data imputation is going to be crucial.</p></li>
<li><p>The variable we want to predict, energy, has a very high right-skeewed distribution, but, tree-based models are robust to skeewed distributions. This may affect the metric we use (RMSE for instance).</p></li>
<li><p>The response has autocorrelation and the energy produced depends on the month. This affects the type of validation and testing implentation. No random sampling allowed and we need to ensure having data from all months in trainning, validation and testing.</p></li>
<li><p>There are years with missing data for certain months and 2008 has only 178 observations.</p></li>
<li><p>The information obtained from the ECMWF web page suggests that we could create new variables and remove others.</p></li>
<li><p>All variables are numeric.</p></li>
<li><p>Lots of features with normal-ish distribution. But the ranges of the features vary a lot. For KNN it will be necessary to standarize.</p></li>
<li><p>About the relations between the features and the response, there are some non-linear relations, but most of the graphs are distorted by the different scales, nothing clear in this point.</p></li>
<li><p>As for the correlation between features, most of them seem to have very week positive or negative linear correlations meaning that they could have other type of relation or not at all.
There are some packs of variables with very high positive correlation (&gt;=0.9) suggesting that we could reduce the feature space in some way.</p></li>
</ul>
<p>All of this will constraint how we design the validation and testing of our models. Also, gives us some ideas on how we could improve the performance of our models with scaling and some feature engineering and reduce dimensionality.</p>
</section>
</section>
<section id="train-test-split">
<h2><strong>Train-Test Split</strong><a class="headerlink" href="#train-test-split" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">2006</span><span class="p">,</span> <span class="mi">2007</span><span class="p">]</span>
<span class="n">test_years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">2009</span><span class="p">]</span>

<span class="n">wind_df_train</span> <span class="o">=</span> <span class="n">wind_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">is_in</span><span class="p">(</span><span class="n">train_years</span><span class="p">))</span>
<span class="n">wind_df_test</span> <span class="o">=</span> <span class="n">wind_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">is_in</span><span class="p">(</span><span class="n">test_years</span><span class="p">))</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">wind_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">wind_df</span><span class="p">[</span><span class="n">response</span><span class="p">]</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">wind_df_train</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
<span class="n">Y_train</span> <span class="o">=</span> <span class="n">wind_df_train</span><span class="p">[</span><span class="n">response</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">wind_df_test</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
<span class="n">Y_test</span> <span class="o">=</span> <span class="n">wind_df_test</span><span class="p">[</span><span class="n">response</span><span class="p">]</span>

<span class="n">X_years</span> <span class="o">=</span> <span class="n">wind_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">X_train_years</span> <span class="o">=</span> <span class="n">wind_df_train</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="pipeline-definition">
<h2><strong>Pipeline definition</strong><a class="headerlink" href="#pipeline-definition" title="Link to this heading">#</a></h2>
<p>Initial functions from which we have been inspired to create the final pipeline.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">def only_wind(X, type) :</span>
<span class="sd">    </span>
<span class="sd">    if type == True : </span>
<span class="sd">        wind_predictors = [x for x in X.columns if any(x.startswith(y) for y in [&#39;u&#39;, &#39;v&#39;, &#39;wind&#39;, &#39;air&#39;])]</span>
<span class="sd">        return X[wind_predictors]</span>
<span class="sd">    else :</span>
<span class="sd">        return X</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">def only_sotavento(X, type):</span>
<span class="sd">    </span>
<span class="sd">    predictors_location_13 = [x for x in X.columns if re.search(rf&#39;\.{13}(?![0-9])&#39;, x)]</span>
<span class="sd">    if type == True :</span>
<span class="sd">        return X[predictors_location_13]</span>
<span class="sd">    else:</span>
<span class="sd">        return X </span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">def feature_engineering(X, type):</span>
<span class="sd">    </span>
<span class="sd">    if type == True :</span>
<span class="sd">        X = X.with_columns(np.sqrt(X[&#39;u10.13&#39;]**2 +X[&#39;v10.13&#39;]**2).alias(&#39;wind_speed.13&#39;))</span>
<span class="sd">        X = X.with_columns(np.degrees(np.arctan2(X[&#39;v10.13&#39;], X[&#39;u10.13&#39;])).alias(&#39;wind_direction.13&#39;))</span>
<span class="sd">        X = X.with_columns(((X[&#39;wind_direction.13&#39;] + 360) % 360).alias(&#39;wind_direction.13&#39;))</span>
<span class="sd">        X = X.with_columns((X[&#39;sp.13&#39;] / (287 * X[&#39;t2m.13&#39;])).alias(&#39;air_density.13&#39;))</span>
<span class="sd">        return X</span>
<span class="sd">    elif type == False:</span>
<span class="sd">        return X</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Now we are going to define several transformers to include in our pipeline.</p>
<p>The following transformer performs imputation through different imputation methods, when it is activate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">imputation</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;no_imputation&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
               
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;no_imputation&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span> <span class="o">=</span> <span class="kc">None</span>        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;simple_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;simple_median&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;knn&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;iterative_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;iterative_median&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">(</span><span class="n">initial_strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n_nearest_features</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid method for imputation&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X_column_names</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">X_column_names</span>
        <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
</div>
</div>
<p>The following transformer select the wind predictors from the given data-set when it is activate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">only_wind</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Initialize with the parameter that decides whether to select wind features or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">=</span> <span class="n">apply</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># This transformer does not need to learn anything from the data, so the fit method just returns self</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">wind_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;wind&#39;</span><span class="p">,</span> <span class="s1">&#39;air&#39;</span><span class="p">])]</span>
            <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="n">wind_predictors</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
</div>
</div>
<p>The following transformer select the Sotavento predictors from the given data-set when it is activate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">only_sotavento</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Initialize with the parameter that decides whether to select wind features or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">=</span> <span class="n">apply</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># This transformer does not need to learn anything from the data, so the fit method just returns self</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">predictors_location_13</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;\.</span><span class="si">{</span><span class="mi">13</span><span class="si">}</span><span class="s1">(?![0-9])&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="n">predictors_location_13</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">X</span> 
</pre></div>
</div>
</div>
</div>
<p>The following transformer applies feature engineering to the given data-set when it is activate.</p>
<p>After doing some research we came up with a way to obtain wind speed and direction from our variables. Using the horizontal and vertical measurements of the wind we can obtain these new variables.</p>
<p>Now, the question is if we need to create these new variables for the 3 types of wind measurements (al 10 meters, 100 meters and te anomalies with respect to the mean) or not. We looked at the dimensions of wind turbines in late 1990s and found that for wind turbines of 750 kw the typical height was 50m for the base and including the blades up to 70-75 meters. This suggests that it would be better to use the measurements at 100m rather than those at 10 meters. Also, a very important factor, the measurements of wind at 100 meters have less missing values. This is very important because this means less cells to impute and less potential noise added due to the imputation.</p>
<p>For these reasons we will perform the feature engineering with the wind measurements at 100m only.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">feature_engineering</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Initialize with the parameter that decides whether to select wind features or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">=</span> <span class="n">apply</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># This transformer does not need to learn anything from the data, so the fit method just returns self</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
   
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">==</span> <span class="kc">True</span> <span class="p">:</span>
            <span class="n">wind_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;u10.&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="s2">&quot;v10.&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="s2">&quot;u10n&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="s2">&quot;v10n&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
            <span class="n">fsr_laihv_cape_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;fsr&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="s2">&quot;lai_lv&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="s2">&quot;cape&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
            <span class="n">stl_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;stl&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
            <span class="n">p_vars_only_sotavento</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;p&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s2">&quot;162&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;13&quot;</span><span class="p">)]</span>
            <span class="n">cols_to_drop</span> <span class="o">=</span> <span class="n">wind_to_drop</span> <span class="o">+</span> <span class="n">fsr_laihv_cape_to_drop</span> <span class="o">+</span> <span class="n">stl_to_drop</span> <span class="o">+</span> <span class="n">p_vars_only_sotavento</span>
            <span class="n">cols_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cols_to_drop</span><span class="p">]</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">cols_to_keep</span><span class="p">]</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;u100.13&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;v100.13&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;wind_speed.13&#39;</span><span class="p">))</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;v100.13&#39;</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;u100.13&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;wind_direction.13&#39;</span><span class="p">))</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(((</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;wind_direction.13&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;wind_direction.13&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">X</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
</div>
</div>
<p>Below, we create these new variables without imputation just to have some visual representation on how they aid in discriminating higher and lower values of the response. First we will plot both together and then with the variable <em>iews</em> that we know has direct impact in the flow of wind.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">wind_data[&#39;windSpeed&#39;] = wind_data.apply(lambda row: sqrt((row[&#39;u100.13&#39;]**2)+(row[&#39;v100.13&#39;]**2)), axis=1)</span>
<span class="sd">wind_data[&#39;wind_direction&#39;] = np.degrees(np.arctan2(wind_data[&#39;v100.13&#39;], wind_data[&#39;u100.13&#39;]))</span>
<span class="sd">wind_data[&#39;wind_direction&#39;] = (wind_data[&#39;wind_direction&#39;] + 360) % 360 # Convert to 360º scale</span>

<span class="sd">plt.scatter(wind_data[&#39;wind_direction&#39;].iloc[1:], wind_data[&#39;windSpeed&#39;].iloc[1:], c=wind_data[&#39;energy&#39;].iloc[1:], cmap=&#39;viridis&#39;)</span>
<span class="sd">plt.xlabel(&#39;Wind direction (360º) sotavento&#39;)</span>
<span class="sd">plt.ylabel(&#39;Wind speed sotavento&#39;)</span>
<span class="sd">plt.title(&#39;Energy production vs features&#39;)</span>

<span class="sd"># Add colorbar for reference</span>
<span class="sd">cbar = plt.colorbar()</span>
<span class="sd">cbar.set_label(&#39;Energy&#39;)</span>

<span class="sd">plt.show()</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="image.png" src="_images/feature_en_1.png" /></p>
<p>The plot above suggets that higher wind speed tend to generate more energy, but this energy production is dependent on the wind direction.</p>
<p>Looking at the wind’s direction, when it blows from 100º-150º (North-West) very little energy is produced in general and the same happens when it blows in direction 250º-320º (South, South-East). Most of the high energy production observations appear with wind directions between 0º-90º (East, Nort-East, North), the first quadrant, and wind speeds of 8m/s or higher.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">plt.scatter(wind_data[&#39;windSpeed&#39;].iloc[1:], wind_data[&#39;iews.13&#39;].iloc[1:], c=wind_data[&#39;energy&#39;].iloc[1:], cmap=&#39;viridis&#39;)</span>
<span class="sd">plt.xlabel(&#39;Wind speed (m/s) sotavento&#39;)</span>
<span class="sd">plt.ylabel(&#39;IEWS sotavento&#39;)</span>
<span class="sd">plt.title(&#39;Energy production vs features&#39;)</span>

<span class="sd"># Add colorbar for reference</span>
<span class="sd">cbar = plt.colorbar()</span>
<span class="sd">cbar.set_label(&#39;Energy&#39;)</span>

<span class="sd">plt.show()</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="image.png" src="_images/feature_en_2.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">plt.scatter(wind_data[&#39;wind_direction&#39;].iloc[1:], wind_data[&#39;iews.13&#39;].iloc[1:], c=wind_data[&#39;energy&#39;].iloc[1:], cmap=&#39;viridis&#39;)</span>
<span class="sd">plt.xlabel(&#39;Wind direction (360º) sotavento&#39;)</span>
<span class="sd">plt.ylabel(&#39;IEWS sotavento&#39;)</span>
<span class="sd">plt.title(&#39;Energy production vs features&#39;)</span>

<span class="sd"># Add colorbar for reference</span>
<span class="sd">cbar = plt.colorbar()</span>
<span class="sd">cbar.set_label(&#39;Energy&#39;)</span>

<span class="sd">plt.show()</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="image.png" src="_images/feature_en_3.png" /></p>
<p>Both plots above suggest that there is a non-linear relation between the turbulence factor on wind and the speed and direction of the wind. Seems like the new variables work well together and also with other variables in the dataset. Nevertheless, the relations are not cristal clear and there is some obvious noise in the data so we will include more variables in our future analysis.</p>
<p>We are going to remove these new variables because the idea is to add them after imputing the existing variables in a pipeline step.</p>
<section id="testing-the-pipeline">
<h3><strong>Testing the pipeline</strong><a class="headerlink" href="#testing-the-pipeline" title="Link to this heading">#</a></h3>
<p>In this section we are going to define several pipelines using the above transformers and we will test them, in order to make sure them work well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;imputation&#39;</span><span class="p">,</span> <span class="n">imputation</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;feature_engineering&#39;</span><span class="p">,</span> <span class="n">feature_engineering</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;only_wind&#39;</span><span class="p">,</span> <span class="n">only_wind</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;only_sotavento&#39;</span><span class="p">,</span> <span class="n">only_sotavento</span><span class="p">())</span>
    <span class="p">])</span>

<span class="n">pipeline</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">imputation__method</span><span class="o">=</span><span class="s1">&#39;simple_mean&#39;</span><span class="p">,</span> <span class="n">feature_engineering__apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">only_wind__apply</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_sotavento__apply</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3_649, 207)</small><table border="1" class="dataframe"><thead><tr><th>month</th><th>hour</th><th>p54.162.13</th><th>p55.162.13</th><th>p59.162.13</th><th>lai_hv.1</th><th>lai_hv.2</th><th>lai_hv.3</th><th>lai_hv.4</th><th>lai_hv.5</th><th>lai_hv.6</th><th>lai_hv.7</th><th>lai_hv.8</th><th>lai_hv.9</th><th>lai_hv.10</th><th>lai_hv.11</th><th>lai_hv.12</th><th>lai_hv.13</th><th>lai_hv.14</th><th>lai_hv.15</th><th>lai_hv.16</th><th>lai_hv.17</th><th>lai_hv.18</th><th>lai_hv.19</th><th>lai_hv.20</th><th>lai_hv.21</th><th>lai_hv.22</th><th>lai_hv.23</th><th>lai_hv.24</th><th>lai_hv.25</th><th>sp.1</th><th>sp.2</th><th>sp.3</th><th>sp.4</th><th>sp.5</th><th>sp.6</th><th>sp.7</th><th>&hellip;</th><th>u100.16</th><th>u100.17</th><th>u100.18</th><th>u100.19</th><th>u100.20</th><th>u100.21</th><th>u100.22</th><th>u100.23</th><th>u100.24</th><th>u100.25</th><th>v100.1</th><th>v100.2</th><th>v100.3</th><th>v100.4</th><th>v100.5</th><th>v100.6</th><th>v100.7</th><th>v100.8</th><th>v100.9</th><th>v100.10</th><th>v100.11</th><th>v100.12</th><th>v100.13</th><th>v100.14</th><th>v100.15</th><th>v100.16</th><th>v100.17</th><th>v100.18</th><th>v100.19</th><th>v100.20</th><th>v100.21</th><th>v100.22</th><th>v100.23</th><th>v100.24</th><th>v100.25</th><th>wind_speed.13</th><th>wind_direction.13</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>&hellip;</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>1.0</td><td>18.0</td><td>2.5108e6</td><td>9.186295</td><td>1.6275e6</td><td>2.336301</td><td>2.242958</td><td>2.239505</td><td>2.236064</td><td>2.232612</td><td>2.354674</td><td>2.351065</td><td>2.347445</td><td>2.343836</td><td>2.340227</td><td>2.440469</td><td>2.436726</td><td>2.432983</td><td>2.597243</td><td>2.425486</td><td>2.510131</td><td>2.506276</td><td>2.502422</td><td>2.498567</td><td>2.494724</td><td>2.537515</td><td>2.531817</td><td>2.526119</td><td>2.520421</td><td>2.706869</td><td>100691.101045</td><td>100414.200563</td><td>100137.300081</td><td>97860.970883</td><td>99583.499117</td><td>100548.40153</td><td>100261.734059</td><td>&hellip;</td><td>-2.104379</td><td>-1.952148</td><td>0.186532</td><td>-1.64821</td><td>-1.495979</td><td>-2.141521</td><td>-1.993476</td><td>-1.844907</td><td>-1.696861</td><td>-1.548292</td><td>-4.801839</td><td>-4.673119</td><td>-4.544897</td><td>-4.416176</td><td>-4.287456</td><td>-4.752946</td><td>0.093998</td><td>-4.488519</td><td>-4.355807</td><td>-4.223594</td><td>-4.715028</td><td>0.109453</td><td>-4.443617</td><td>-4.307911</td><td>-4.172206</td><td>-4.683596</td><td>0.094171</td><td>-4.407196</td><td>0.263704</td><td>-4.131295</td><td>-4.669626</td><td>-4.528932</td><td>-4.388736</td><td>-4.24854</td><td>-4.107846</td><td>4.78708</td><td>248.163973</td></tr><tr><td>1.0</td><td>0.0</td><td>2.5132e6</td><td>8.849569</td><td>1.1535e6</td><td>2.246332</td><td>2.242857</td><td>2.239371</td><td>2.235908</td><td>2.232422</td><td>2.354607</td><td>2.350953</td><td>2.347311</td><td>2.343669</td><td>2.340026</td><td>2.440391</td><td>2.436615</td><td>2.576445</td><td>2.429062</td><td>2.425285</td><td>2.510053</td><td>2.630269</td><td>2.502277</td><td>2.498389</td><td>2.494512</td><td>2.537448</td><td>2.654287</td><td>2.525985</td><td>2.690554</td><td>2.514522</td><td>100761.118941</td><td>100485.867431</td><td>100210.615921</td><td>99935.364411</td><td>99660.112902</td><td>98519.961799</td><td>98251.997369</td><td>&hellip;</td><td>-4.065591</td><td>0.216299</td><td>-3.742297</td><td>-3.580127</td><td>-3.41848</td><td>-4.06873</td><td>-3.908653</td><td>-3.748575</td><td>-3.588497</td><td>-3.42842</td><td>0.100978</td><td>0.058969</td><td>-3.166389</td><td>-3.034675</td><td>-2.902961</td><td>-3.416845</td><td>-3.28114</td><td>-3.145933</td><td>-3.010228</td><td>0.223252</td><td>-3.406368</td><td>-3.268168</td><td>-3.129469</td><td>-2.991269</td><td>-2.85257</td><td>-3.397886</td><td>-3.257192</td><td>-3.115998</td><td>-2.975304</td><td>-2.834609</td><td>-3.39639</td><td>-3.254198</td><td>-3.112506</td><td>-2.970314</td><td>0.235086</td><td>4.87916</td><td>219.895927</td></tr><tr><td>1.0</td><td>6.0</td><td>2.5096e6</td><td>15.910571</td><td>1.0988e6</td><td>2.246265</td><td>2.242756</td><td>2.239248</td><td>2.235751</td><td>2.232243</td><td>2.449854</td><td>2.467887</td><td>2.347177</td><td>2.343501</td><td>2.339825</td><td>2.440313</td><td>2.436503</td><td>2.432704</td><td>2.428883</td><td>2.425073</td><td>2.509963</td><td>2.506053</td><td>2.502131</td><td>2.49821</td><td>2.494299</td><td>2.53737</td><td>2.531605</td><td>2.52584</td><td>2.520075</td><td>2.706869</td><td>100599.392823</td><td>100328.834542</td><td>98131.777725</td><td>99787.717979</td><td>99517.159698</td><td>100455.044335</td><td>100174.719065</td><td>&hellip;</td><td>-5.395387</td><td>-5.220661</td><td>0.186532</td><td>-4.871211</td><td>0.241297</td><td>-5.333134</td><td>-5.162594</td><td>-4.992054</td><td>-4.821514</td><td>0.229127</td><td>-1.512977</td><td>-1.362803</td><td>-1.212629</td><td>-1.062455</td><td>-0.912281</td><td>-1.489029</td><td>-1.335363</td><td>-1.182195</td><td>-1.029028</td><td>0.223252</td><td>-1.469571</td><td>-1.313909</td><td>0.125493</td><td>-1.002086</td><td>0.233869</td><td>-1.454105</td><td>0.094171</td><td>-1.13829</td><td>0.263704</td><td>-0.822476</td><td>-1.459094</td><td>-1.302933</td><td>-1.147271</td><td>-0.99111</td><td>-0.834949</td><td>5.098747</td><td>178.589668</td></tr><tr><td>1.0</td><td>12.0</td><td>2.5106e6</td><td>6.922709</td><td>1.0760e6</td><td>2.246164</td><td>2.242622</td><td>2.239081</td><td>2.235539</td><td>2.231986</td><td>2.354428</td><td>2.350707</td><td>2.346998</td><td>2.343278</td><td>2.339568</td><td>2.539475</td><td>2.436358</td><td>2.432514</td><td>2.597243</td><td>2.424805</td><td>2.509863</td><td>2.505897</td><td>2.650852</td><td>2.669143</td><td>2.49402</td><td>2.537258</td><td>2.53146</td><td>2.525661</td><td>2.519851</td><td>2.514053</td><td>100498.424988</td><td>100231.291495</td><td>99964.158002</td><td>99697.02451</td><td>99429.891017</td><td>100355.218097</td><td>100078.317615</td><td>&hellip;</td><td>-4.611739</td><td>-4.511821</td><td>-4.412426</td><td>-4.312509</td><td>-4.213114</td><td>-4.539547</td><td>-4.442245</td><td>-4.344419</td><td>-4.247117</td><td>-4.149292</td><td>1.319376</td><td>1.435124</td><td>1.550374</td><td>1.666123</td><td>0.269064</td><td>1.292933</td><td>1.408682</td><td>1.523932</td><td>1.639182</td><td>1.754431</td><td>0.039669</td><td>1.387228</td><td>1.502478</td><td>1.617728</td><td>1.733477</td><td>1.255015</td><td>1.370265</td><td>1.485515</td><td>1.600765</td><td>1.716015</td><td>1.210612</td><td>1.319376</td><td>1.42814</td><td>1.536405</td><td>1.645169</td><td>4.744993</td><td>161.539851</td></tr><tr><td>1.0</td><td>18.0</td><td>2.5057e6</td><td>6.646282</td><td>1.0708e6</td><td>2.246097</td><td>2.242522</td><td>2.238947</td><td>2.235371</td><td>2.231807</td><td>2.35435</td><td>2.467887</td><td>2.346864</td><td>2.34311</td><td>2.339367</td><td>2.440134</td><td>2.436257</td><td>2.432369</td><td>2.597243</td><td>2.424604</td><td>2.509774</td><td>2.505785</td><td>2.501796</td><td>2.497796</td><td>2.493808</td><td>2.53718</td><td>2.531359</td><td>2.525516</td><td>2.519684</td><td>2.51384</td><td>100193.365135</td><td>99927.246394</td><td>99661.127654</td><td>97860.970883</td><td>99129.017016</td><td>100051.93406</td><td>99776.04833</td><td>&hellip;</td><td>-3.431035</td><td>-3.369306</td><td>-3.307054</td><td>-3.245324</td><td>0.241297</td><td>0.232298</td><td>-3.320132</td><td>-3.262065</td><td>-3.203474</td><td>-3.145407</td><td>2.018858</td><td>2.106168</td><td>2.193977</td><td>2.281288</td><td>2.368599</td><td>1.986428</td><td>2.072741</td><td>2.159053</td><td>2.245366</td><td>2.331679</td><td>1.960484</td><td>0.109453</td><td>2.131114</td><td>2.216928</td><td>2.302243</td><td>1.939031</td><td>0.094171</td><td>0.168391</td><td>2.193977</td><td>2.278793</td><td>1.873673</td><td>1.953</td><td>2.031829</td><td>2.111157</td><td>2.189986</td><td>4.006184</td><td>147.862282</td></tr><tr><td>1.0</td><td>0.0</td><td>2.5058e6</td><td>6.125948</td><td>1.0941e6</td><td>2.246019</td><td>2.242421</td><td>2.238813</td><td>2.235215</td><td>2.231617</td><td>2.354272</td><td>2.350495</td><td>2.34673</td><td>2.342954</td><td>2.339177</td><td>2.440056</td><td>2.436145</td><td>2.432235</td><td>2.428313</td><td>2.424403</td><td>2.509695</td><td>2.505673</td><td>2.501651</td><td>2.497629</td><td>2.493595</td><td>2.537113</td><td>2.531248</td><td>2.525382</td><td>2.519505</td><td>2.513639</td><td>100082.249779</td><td>99809.915682</td><td>99537.581584</td><td>99265.374331</td><td>98993.040234</td><td>99945.638776</td><td>99663.53769</td><td>&hellip;</td><td>0.188525</td><td>0.397226</td><td>0.186532</td><td>0.042021</td><td>-0.135843</td><td>0.496621</td><td>0.323465</td><td>0.150309</td><td>-0.022847</td><td>0.229127</td><td>5.333663</td><td>5.352123</td><td>5.370084</td><td>5.388544</td><td>0.269064</td><td>5.33067</td><td>5.34464</td><td>5.358609</td><td>5.373078</td><td>5.387048</td><td>5.327676</td><td>5.338653</td><td>5.349629</td><td>5.360605</td><td>5.371581</td><td>5.325681</td><td>5.334162</td><td>5.342145</td><td>0.263704</td><td>5.358609</td><td>5.231884</td><td>5.236375</td><td>5.240865</td><td>5.245854</td><td>5.250344</td><td>5.353023</td><td>87.9596</td></tr><tr><td>1.0</td><td>6.0</td><td>2.4904e6</td><td>15.910571</td><td>1.2645e6</td><td>2.245952</td><td>2.242321</td><td>2.23869</td><td>2.235058</td><td>2.231427</td><td>2.354204</td><td>2.350395</td><td>2.346585</td><td>2.342786</td><td>2.338976</td><td>2.439978</td><td>2.436034</td><td>2.43209</td><td>2.428146</td><td>2.424202</td><td>2.509617</td><td>2.505561</td><td>2.501506</td><td>2.49745</td><td>2.493394</td><td>2.537035</td><td>2.531136</td><td>2.525237</td><td>2.519337</td><td>2.513449</td><td>100097.978437</td><td>98390.530068</td><td>99551.280738</td><td>99278.058732</td><td>99004.709883</td><td>99964.919067</td><td>99681.676384</td><td>&hellip;</td><td>4.159573</td><td>0.216299</td><td>4.00525</td><td>0.206505</td><td>0.241297</td><td>0.232298</td><td>3.862959</td><td>3.792336</td><td>3.722237</td><td>3.651615</td><td>0.100978</td><td>0.058969</td><td>4.619713</td><td>4.617218</td><td>4.614724</td><td>4.627197</td><td>4.62121</td><td>4.615223</td><td>4.609236</td><td>4.603249</td><td>4.629691</td><td>4.620711</td><td>4.612229</td><td>4.603249</td><td>4.594268</td><td>4.631687</td><td>4.620711</td><td>4.609236</td><td>4.598259</td><td>0.21364</td><td>4.554355</td><td>4.542381</td><td>4.530407</td><td>4.518433</td><td>4.506459</td><td>6.174549</td><td>48.32895</td></tr><tr><td>1.0</td><td>12.0</td><td>2.5050e6</td><td>7.938308</td><td>1.2479e6</td><td>2.245874</td><td>2.24222</td><td>2.238556</td><td>2.234902</td><td>2.231237</td><td>2.354126</td><td>2.350294</td><td>2.346451</td><td>2.342618</td><td>2.338786</td><td>2.439899</td><td>2.435922</td><td>2.431944</td><td>2.427978</td><td>2.424001</td><td>2.509539</td><td>2.630269</td><td>2.50136</td><td>2.497271</td><td>2.687878</td><td>2.536946</td><td>2.531024</td><td>2.525091</td><td>2.51917</td><td>2.513248</td><td>100223.55401</td><td>99953.122573</td><td>99682.691136</td><td>99412.386543</td><td>99141.955106</td><td>100092.524144</td><td>99812.325718</td><td>&hellip;</td><td>3.31315</td><td>0.216299</td><td>3.260837</td><td>0.206505</td><td>3.208524</td><td>3.110176</td><td>3.08925</td><td>3.067802</td><td>3.046354</td><td>3.024905</td><td>4.27097</td><td>4.126284</td><td>3.981598</td><td>3.836912</td><td>3.691727</td><td>4.172184</td><td>4.028995</td><td>3.885806</td><td>3.742616</td><td>3.599427</td><td>4.093854</td><td>3.952162</td><td>0.125493</td><td>3.667779</td><td>3.526086</td><td>4.030492</td><td>3.889298</td><td>3.748603</td><td>3.60741</td><td>3.466216</td><td>3.909754</td><td>3.771554</td><td>3.633853</td><td>0.163518</td><td>3.357951</td><td>3.389758</td><td>2.12164</td></tr><tr><td>1.0</td><td>18.0</td><td>2.5037e6</td><td>8.447123</td><td>1.5255e6</td><td>2.245807</td><td>2.24212</td><td>2.238433</td><td>2.234734</td><td>2.231059</td><td>2.354048</td><td>2.350182</td><td>2.346317</td><td>2.342451</td><td>2.338596</td><td>2.439821</td><td>2.43581</td><td>2.576445</td><td>2.427799</td><td>2.423799</td><td>2.61204</td><td>2.630269</td><td>2.650852</td><td>2.497104</td><td>2.492981</td><td>2.536879</td><td>2.530924</td><td>2.524957</td><td>2.519002</td><td>2.513047</td><td>100182.45655</td><td>99913.293553</td><td>99644.130556</td><td>99375.094403</td><td>99105.931406</td><td>100051.172996</td><td>99772.24301</td><td>&hellip;</td><td>3.286993</td><td>3.212709</td><td>3.138425</td><td>3.06414</td><td>2.989856</td><td>3.119069</td><td>3.0474</td><td>2.976254</td><td>2.905109</td><td>2.83344</td><td>5.034812</td><td>4.886135</td><td>4.737956</td><td>4.589279</td><td>4.441101</td><td>4.932035</td><td>0.093998</td><td>4.63019</td><td>4.479517</td><td>4.328345</td><td>4.850712</td><td>4.698043</td><td>4.545374</td><td>4.392207</td><td>0.233869</td><td>0.022672</td><td>4.63019</td><td>4.476025</td><td>4.321859</td><td>4.167195</td><td>4.636676</td><td>4.485005</td><td>4.333334</td><td>4.181664</td><td>4.029993</td><td>4.549531</td><td>87.550526</td></tr><tr><td>1.0</td><td>0.0</td><td>2.5057e6</td><td>8.41799</td><td>1.6202e6</td><td>2.245728</td><td>2.242019</td><td>2.238299</td><td>2.234589</td><td>2.230869</td><td>2.353981</td><td>2.350082</td><td>2.346182</td><td>2.504048</td><td>2.338384</td><td>2.439743</td><td>2.435698</td><td>2.576445</td><td>2.427632</td><td>2.614764</td><td>2.61204</td><td>2.505226</td><td>2.50107</td><td>2.496925</td><td>2.492769</td><td>2.5368</td><td>2.530812</td><td>2.524823</td><td>2.518835</td><td>2.706869</td><td>100330.229826</td><td>100059.925233</td><td>99789.493796</td><td>97860.970883</td><td>99248.630921</td><td>100199.073116</td><td>99918.87469</td><td>&hellip;</td><td>3.09919</td><td>3.057863</td><td>0.186532</td><td>0.206505</td><td>2.934404</td><td>2.923941</td><td>2.884184</td><td>2.844426</td><td>0.253012</td><td>2.765433</td><td>4.849714</td><td>4.705527</td><td>4.56134</td><td>4.416654</td><td>4.272467</td><td>0.087607</td><td>4.572316</td><td>4.42763</td><td>0.233445</td><td>4.138757</td><td>4.61173</td><td>4.466545</td><td>4.321859</td><td>4.177173</td><td>4.032487</td><td>4.525916</td><td>4.38123</td><td>0.168391</td><td>4.09136</td><td>3.946674</td><td>4.318367</td><td>4.178171</td><td>4.037975</td><td>3.897281</td><td>3.757085</td><td>5.339948</td><td>54.031966</td></tr><tr><td>1.0</td><td>6.0</td><td>2.4904e6</td><td>8.874637</td><td>1.6275e6</td><td>2.245661</td><td>2.241919</td><td>2.238176</td><td>2.234433</td><td>2.230679</td><td>2.449854</td><td>2.467887</td><td>2.346048</td><td>2.342127</td><td>2.338194</td><td>2.439665</td><td>2.435587</td><td>2.576445</td><td>2.427464</td><td>2.423397</td><td>2.509304</td><td>2.505115</td><td>2.650852</td><td>2.669143</td><td>2.492556</td><td>2.536722</td><td>2.5307</td><td>2.524678</td><td>2.518656</td><td>2.512645</td><td>100228.247239</td><td>99957.815802</td><td>98131.777725</td><td>99416.826083</td><td>99146.394646</td><td>100097.851593</td><td>99817.526323</td><td>&hellip;</td><td>2.823501</td><td>2.79002</td><td>2.757063</td><td>0.206505</td><td>2.690626</td><td>2.609541</td><td>2.580245</td><td>2.55095</td><td>2.521655</td><td>2.49236</td><td>0.100978</td><td>5.979262</td><td>5.855531</td><td>0.188425</td><td>5.607569</td><td>6.002212</td><td>5.877982</td><td>5.754251</td><td>5.63002</td><td>5.50579</td><td>5.922386</td><td>0.109453</td><td>5.673426</td><td>5.549196</td><td>5.424466</td><td>5.857526</td><td>5.732797</td><td>0.168391</td><td>0.263704</td><td>5.359108</td><td>5.675921</td><td>5.555183</td><td>5.434445</td><td>5.313707</td><td>5.19247</td><td>6.366827</td><td>63.010745</td></tr><tr><td>1.0</td><td>12.0</td><td>2.4904e6</td><td>10.397019</td><td>1.9336e6</td><td>2.245594</td><td>2.241818</td><td>2.238042</td><td>2.234276</td><td>2.2305</td><td>2.353825</td><td>2.349869</td><td>2.345914</td><td>2.341959</td><td>2.338004</td><td>2.439586</td><td>2.435486</td><td>2.431386</td><td>2.427285</td><td>2.423185</td><td>2.509215</td><td>2.505003</td><td>2.50078</td><td>2.496567</td><td>2.687878</td><td>2.536644</td><td>2.654287</td><td>2.524544</td><td>2.518488</td><td>2.512444</td><td>100382.48956</td><td>98390.530068</td><td>98131.777725</td><td>99565.360423</td><td>99293.026326</td><td>100252.854978</td><td>99970.627047</td><td>&hellip;</td><td>3.156211</td><td>3.05577</td><td>2.955852</td><td>0.206505</td><td>2.755494</td><td>0.232298</td><td>2.807284</td><td>0.246294</td><td>2.61948</td><td>2.525317</td><td>5.710845</td><td>5.567656</td><td>0.129967</td><td>5.281277</td><td>5.137589</td><td>5.531734</td><td>5.385551</td><td>5.238869</td><td>5.092187</td><td>4.945506</td><td>5.390041</td><td>5.240865</td><td>5.091689</td><td>4.942013</td><td>4.792837</td><td>5.274791</td><td>5.123619</td><td>4.971948</td><td>4.820777</td><td>4.669106</td><td>5.075224</td><td>4.926048</td><td>4.777371</td><td>4.628194</td><td>4.479018</td><td>5.982319</td><td>58.334011</td></tr><tr><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td></tr><tr><td>12.0</td><td>0.0</td><td>2.4861e6</td><td>5.646944</td><td>1.0144e6</td><td>2.248388</td><td>2.354085</td><td>2.243092</td><td>2.389281</td><td>2.237773</td><td>2.449854</td><td>2.353981</td><td>2.351199</td><td>2.348417</td><td>2.345635</td><td>2.442625</td><td>2.439743</td><td>2.436871</td><td>2.433989</td><td>2.431095</td><td>2.512343</td><td>2.509383</td><td>2.506422</td><td>2.503461</td><td>2.500489</td><td>2.539661</td><td>2.654287</td><td>2.529985</td><td>2.690554</td><td>2.520298</td><td>99933.334907</td><td>99661.888718</td><td>99390.442528</td><td>99119.123183</td><td>97604.526953</td><td>98519.961799</td><td>99512.593314</td><td>&hellip;</td><td>-1.837583</td><td>-1.873679</td><td>0.186532</td><td>-1.946394</td><td>-1.98249</td><td>-1.924946</td><td>-1.959472</td><td>-1.993999</td><td>-2.028525</td><td>0.229127</td><td>0.435793</td><td>0.590458</td><td>0.745122</td><td>0.899786</td><td>1.053952</td><td>0.327528</td><td>0.485685</td><td>0.644341</td><td>0.802996</td><td>0.961153</td><td>0.241715</td><td>0.402865</td><td>0.564514</td><td>0.726163</td><td>0.233869</td><td>0.171866</td><td>0.33601</td><td>0.499655</td><td>0.663798</td><td>0.827942</td><td>0.06859</td><td>0.231237</td><td>0.393385</td><td>0.555533</td><td>0.71818</td><td>1.959377</td><td>163.255226</td></tr><tr><td>12.0</td><td>6.0</td><td>2.4862e6</td><td>4.942325</td><td>931571.62808</td><td>2.248321</td><td>2.245639</td><td>2.242958</td><td>2.240276</td><td>2.237595</td><td>2.356685</td><td>2.353869</td><td>2.351065</td><td>2.504048</td><td>2.345445</td><td>2.442547</td><td>2.439642</td><td>2.436726</td><td>2.43381</td><td>2.430894</td><td>2.512265</td><td>2.509271</td><td>2.506276</td><td>2.503282</td><td>2.500277</td><td>2.539594</td><td>2.534722</td><td>2.52984</td><td>2.52498</td><td>2.520097</td><td>99838.328741</td><td>99570.434184</td><td>98131.777725</td><td>99034.391382</td><td>98766.369981</td><td>99700.19561</td><td>99422.40722</td><td>&hellip;</td><td>-2.228361</td><td>-2.225222</td><td>-2.22156</td><td>-2.217898</td><td>-2.214236</td><td>-2.311538</td><td>-2.304738</td><td>-2.29846</td><td>0.253012</td><td>-2.285382</td><td>2.131613</td><td>2.238381</td><td>2.345149</td><td>0.188425</td><td>2.558686</td><td>2.067751</td><td>2.176016</td><td>2.28478</td><td>0.233445</td><td>2.501809</td><td>2.016862</td><td>2.126624</td><td>2.236385</td><td>2.346646</td><td>2.456408</td><td>1.975452</td><td>2.086211</td><td>2.19747</td><td>2.308728</td><td>2.419488</td><td>1.873673</td><td>1.982437</td><td>2.091201</td><td>2.199965</td><td>2.30823</td><td>3.140486</td><td>134.592781</td></tr><tr><td>12.0</td><td>12.0</td><td>2.4902e6</td><td>4.724842</td><td>1.6275e6</td><td>2.248242</td><td>2.245538</td><td>2.242835</td><td>2.240109</td><td>2.237405</td><td>2.356607</td><td>2.353769</td><td>2.48725</td><td>2.504048</td><td>2.345244</td><td>2.44248</td><td>2.439531</td><td>2.436581</td><td>2.433643</td><td>2.430693</td><td>2.512187</td><td>2.509159</td><td>2.506131</td><td>2.503103</td><td>2.500064</td><td>2.539515</td><td>2.534611</td><td>2.672521</td><td>2.690554</td><td>2.519896</td><td>99909.361389</td><td>99636.900447</td><td>99364.312662</td><td>99091.85172</td><td>98819.390779</td><td>99770.847726</td><td>99488.619795</td><td>&hellip;</td><td>-0.027555</td><td>-0.069929</td><td>-0.112302</td><td>-0.154675</td><td>-0.196526</td><td>-0.094516</td><td>-0.13375</td><td>-0.172985</td><td>0.253012</td><td>-0.251978</td><td>1.760917</td><td>1.878662</td><td>1.996905</td><td>2.11465</td><td>2.232893</td><td>1.702544</td><td>1.821785</td><td>1.941026</td><td>2.059769</td><td>2.17901</td><td>1.656145</td><td>1.776384</td><td>1.896623</td><td>0.159176</td><td>2.136602</td><td>1.618227</td><td>1.739464</td><td>1.860202</td><td>1.981439</td><td>2.102177</td><td>1.554366</td><td>1.67211</td><td>0.107177</td><td>1.908098</td><td>2.025842</td><td>1.900425</td><td>93.62478</td></tr><tr><td>12.0</td><td>0.0</td><td>2.4930e6</td><td>15.910571</td><td>718208.692524</td><td>2.248097</td><td>2.354085</td><td>2.242567</td><td>2.239796</td><td>2.237036</td><td>2.356461</td><td>2.353556</td><td>2.48725</td><td>2.347758</td><td>2.344853</td><td>2.442313</td><td>2.439307</td><td>2.436302</td><td>2.433296</td><td>2.430291</td><td>2.51203</td><td>2.508936</td><td>2.505841</td><td>2.502746</td><td>2.499662</td><td>2.539359</td><td>2.534398</td><td>2.529426</td><td>2.524466</td><td>2.519494</td><td>99790.381704</td><td>99520.457643</td><td>99250.406737</td><td>98980.482676</td><td>98710.558615</td><td>99655.927049</td><td>99376.109155</td><td>&hellip;</td><td>0.580321</td><td>0.505514</td><td>0.430706</td><td>0.355899</td><td>0.280568</td><td>0.440123</td><td>0.37107</td><td>0.302017</td><td>0.23244</td><td>0.163387</td><td>4.46904</td><td>4.481513</td><td>4.493986</td><td>4.506958</td><td>4.519431</td><td>4.438107</td><td>4.453075</td><td>4.468541</td><td>4.483508</td><td>0.223252</td><td>4.41366</td><td>0.109453</td><td>0.125493</td><td>4.465049</td><td>4.482012</td><td>4.394202</td><td>4.412662</td><td>4.431122</td><td>4.450081</td><td>4.468541</td><td>4.294918</td><td>4.312879</td><td>4.33084</td><td>4.348801</td><td>4.366762</td><td>0.522381</td><td>13.900241</td></tr><tr><td>12.0</td><td>6.0</td><td>2.4904e6</td><td>5.665914</td><td>626920.859358</td><td>2.24803</td><td>2.245237</td><td>2.242432</td><td>2.389281</td><td>2.405302</td><td>2.356383</td><td>2.353456</td><td>2.350517</td><td>2.34759</td><td>2.344652</td><td>2.442234</td><td>2.557467</td><td>2.436168</td><td>2.433129</td><td>2.430078</td><td>2.511941</td><td>2.508824</td><td>2.505696</td><td>2.502567</td><td>2.49945</td><td>2.539281</td><td>2.534287</td><td>2.529292</td><td>2.524287</td><td>2.519293</td><td>99746.239987</td><td>99476.823302</td><td>99207.533461</td><td>98938.24362</td><td>98668.826935</td><td>99613.941681</td><td>99334.758006</td><td>&hellip;</td><td>1.753178</td><td>1.735914</td><td>1.718651</td><td>1.701388</td><td>1.684125</td><td>1.583684</td><td>1.572698</td><td>1.562235</td><td>1.55125</td><td>1.540787</td><td>0.100978</td><td>5.319694</td><td>5.225897</td><td>5.132101</td><td>5.038304</td><td>5.351125</td><td>5.257828</td><td>0.132927</td><td>0.233445</td><td>0.223252</td><td>5.301733</td><td>5.209433</td><td>5.116634</td><td>5.024335</td><td>4.932035</td><td>5.26132</td><td>5.16952</td><td>5.077719</td><td>4.985918</td><td>4.894117</td><td>5.120626</td><td>5.030821</td><td>4.941016</td><td>4.850712</td><td>4.760906</td><td>5.427583</td><td>70.511676</td></tr><tr><td>12.0</td><td>12.0</td><td>2.4908e6</td><td>6.26484</td><td>581455.938526</td><td>2.247952</td><td>2.245136</td><td>2.24231</td><td>2.239483</td><td>2.236656</td><td>2.356305</td><td>2.353344</td><td>2.48725</td><td>2.347423</td><td>2.344462</td><td>2.442167</td><td>2.557467</td><td>2.576445</td><td>2.43295</td><td>2.429877</td><td>2.511863</td><td>2.508712</td><td>2.50555</td><td>2.5024</td><td>2.499238</td><td>2.539203</td><td>2.534175</td><td>2.529147</td><td>2.690554</td><td>2.519092</td><td>99734.189806</td><td>99465.280497</td><td>99196.498032</td><td>98927.588722</td><td>98658.679413</td><td>99603.921004</td><td>99325.117861</td><td>&hellip;</td><td>2.897262</td><td>2.769618</td><td>2.641975</td><td>2.514331</td><td>2.386688</td><td>2.709458</td><td>2.589662</td><td>2.469865</td><td>2.350068</td><td>2.230272</td><td>7.405666</td><td>7.187141</td><td>6.968615</td><td>6.750588</td><td>6.532062</td><td>7.235037</td><td>7.015014</td><td>6.795491</td><td>6.575967</td><td>6.356444</td><td>7.099331</td><td>6.87881</td><td>6.658289</td><td>6.437767</td><td>6.216747</td><td>6.98957</td><td>0.094171</td><td>6.546531</td><td>0.263704</td><td>6.103992</td><td>6.76356</td><td>6.543039</td><td>6.322517</td><td>6.101996</td><td>5.881474</td><td>7.212156</td><td>67.399026</td></tr><tr><td>12.0</td><td>18.0</td><td>2.4877e6</td><td>15.910571</td><td>701025.100398</td><td>2.247885</td><td>2.245036</td><td>2.242176</td><td>2.239326</td><td>2.236466</td><td>2.356227</td><td>2.353244</td><td>2.350249</td><td>2.504048</td><td>2.344272</td><td>2.442078</td><td>2.557467</td><td>2.435877</td><td>2.432782</td><td>2.429676</td><td>2.511785</td><td>2.5086</td><td>2.505405</td><td>2.669143</td><td>2.499025</td><td>2.539124</td><td>2.654287</td><td>2.672521</td><td>2.523952</td><td>2.518891</td><td>99632.334063</td><td>99365.073726</td><td>99097.813389</td><td>97860.970883</td><td>98563.165871</td><td>99505.616893</td><td>99228.462723</td><td>&hellip;</td><td>5.451703</td><td>5.252914</td><td>5.053602</td><td>4.854812</td><td>4.656023</td><td>0.232298</td><td>5.03163</td><td>4.839642</td><td>4.647653</td><td>0.229127</td><td>5.621539</td><td>5.500302</td><td>5.379065</td><td>0.188425</td><td>5.136591</td><td>5.46887</td><td>5.345138</td><td>5.221407</td><td>5.097676</td><td>0.223252</td><td>5.348132</td><td>5.222405</td><td>5.096678</td><td>0.159176</td><td>0.233869</td><td>5.249845</td><td>5.122621</td><td>4.995398</td><td>4.868174</td><td>4.74095</td><td>5.022838</td><td>4.894616</td><td>4.766893</td><td>4.638672</td><td>4.510949</td><td>7.29698</td><td>44.303896</td></tr><tr><td>12.0</td><td>0.0</td><td>2.4870e6</td><td>14.540038</td><td>789806.993046</td><td>2.247818</td><td>2.244935</td><td>2.242053</td><td>2.23917</td><td>2.236287</td><td>2.35616</td><td>2.467887</td><td>2.350115</td><td>2.347099</td><td>2.344071</td><td>2.442</td><td>2.438871</td><td>2.576445</td><td>2.432615</td><td>2.429475</td><td>2.511706</td><td>2.508489</td><td>2.505271</td><td>2.502042</td><td>2.498824</td><td>2.539046</td><td>2.533963</td><td>2.672521</td><td>2.523784</td><td>2.518689</td><td>99594.661391</td><td>99327.527898</td><td>99060.267561</td><td>98793.134068</td><td>98526.000575</td><td>99468.451597</td><td>99191.424271</td><td>&hellip;</td><td>0.188525</td><td>3.229449</td><td>3.145748</td><td>3.061525</td><td>2.977824</td><td>3.114884</td><td>3.036414</td><td>2.957422</td><td>2.878429</td><td>2.799437</td><td>7.118789</td><td>6.969114</td><td>6.81894</td><td>6.668766</td><td>6.518592</td><td>7.033474</td><td>6.873821</td><td>6.714666</td><td>6.555013</td><td>6.395858</td><td>6.965622</td><td>6.798983</td><td>6.631846</td><td>6.465208</td><td>6.298569</td><td>6.910242</td><td>6.737616</td><td>6.564991</td><td>0.263704</td><td>6.21974</td><td>6.681239</td><td>0.046625</td><td>6.324014</td><td>6.145901</td><td>5.967288</td><td>7.4169</td><td>63.399892</td></tr><tr><td>12.0</td><td>6.0</td><td>2.4838e6</td><td>17.954048</td><td>1.2366e6</td><td>2.247728</td><td>2.244801</td><td>2.241885</td><td>2.238958</td><td>2.236031</td><td>2.356048</td><td>2.352998</td><td>2.349936</td><td>2.346864</td><td>2.343803</td><td>2.441899</td><td>2.438726</td><td>2.435553</td><td>2.43238</td><td>2.429207</td><td>2.61204</td><td>2.508332</td><td>2.50507</td><td>2.501807</td><td>2.498545</td><td>2.538946</td><td>2.533806</td><td>2.528689</td><td>2.52355</td><td>2.518421</td><td>99575.507944</td><td>99308.247608</td><td>99040.987271</td><td>97860.970883</td><td>98506.466597</td><td>99447.902867</td><td>99170.875541</td><td>&hellip;</td><td>0.188525</td><td>4.192007</td><td>0.186532</td><td>3.894347</td><td>3.745778</td><td>4.156435</td><td>0.178319</td><td>3.864528</td><td>3.718575</td><td>3.572622</td><td>5.364596</td><td>5.333164</td><td>5.301234</td><td>0.188425</td><td>5.237871</td><td>5.444423</td><td>5.400019</td><td>5.355616</td><td>5.311212</td><td>5.266808</td><td>0.039669</td><td>5.452905</td><td>5.398523</td><td>5.344141</td><td>5.289759</td><td>5.558176</td><td>5.495811</td><td>5.433447</td><td>5.370583</td><td>5.308219</td><td>5.467872</td><td>5.39503</td><td>5.322188</td><td>5.249845</td><td>5.177003</td><td>6.841082</td><td>52.10455</td></tr><tr><td>12.0</td><td>12.0</td><td>2.4904e6</td><td>15.910571</td><td>1.5912e6</td><td>2.336301</td><td>2.244701</td><td>2.241751</td><td>2.238801</td><td>2.235852</td><td>2.355981</td><td>2.352886</td><td>2.349802</td><td>2.346708</td><td>2.343613</td><td>2.441821</td><td>2.438614</td><td>2.435408</td><td>2.432201</td><td>2.429006</td><td>2.511517</td><td>2.508221</td><td>2.504925</td><td>2.501629</td><td>2.498333</td><td>2.538867</td><td>2.533706</td><td>2.528544</td><td>2.523382</td><td>2.51822</td><td>99693.599721</td><td>99423.548816</td><td>99153.624755</td><td>98883.57385</td><td>98613.522945</td><td>99561.808791</td><td>99282.117741</td><td>&hellip;</td><td>3.477936</td><td>3.394758</td><td>3.312104</td><td>3.229449</td><td>3.146271</td><td>3.248805</td><td>3.168766</td><td>3.088727</td><td>3.008688</td><td>2.92865</td><td>3.73164</td><td>3.766066</td><td>3.800491</td><td>3.834916</td><td>3.869341</td><td>3.814959</td><td>3.850383</td><td>3.886305</td><td>3.921728</td><td>3.95765</td><td>3.880817</td><td>3.917237</td><td>3.954157</td><td>3.991077</td><td>4.027498</td><td>3.934201</td><td>3.971619</td><td>4.009537</td><td>4.046956</td><td>4.084375</td><td>3.893289</td><td>3.922726</td><td>3.952661</td><td>3.982596</td><td>0.235086</td><td>5.277478</td><td>48.525565</td></tr><tr><td>12.0</td><td>12.0</td><td>2.4887e6</td><td>9.857037</td><td>396195.335925</td><td>2.336301</td><td>2.243896</td><td>2.240712</td><td>2.237539</td><td>2.234355</td><td>2.355378</td><td>2.352048</td><td>2.348707</td><td>2.345378</td><td>2.52364</td><td>2.441207</td><td>2.437743</td><td>2.434291</td><td>2.430838</td><td>2.427375</td><td>2.510868</td><td>2.507327</td><td>2.503774</td><td>2.500221</td><td>2.496657</td><td>2.538253</td><td>2.532834</td><td>2.672521</td><td>2.522008</td><td>2.5166</td><td>98666.153861</td><td>98390.530068</td><td>98959.553414</td><td>98690.517261</td><td>98421.607952</td><td>99357.589929</td><td>99078.913631</td><td>&hellip;</td><td>0.188525</td><td>-2.568395</td><td>0.186532</td><td>-2.465338</td><td>-2.414072</td><td>-2.567872</td><td>-2.516082</td><td>0.246294</td><td>-2.412502</td><td>-2.360712</td><td>-0.599959</td><td>-0.577009</td><td>-0.554557</td><td>0.188425</td><td>-0.508657</td><td>-0.639872</td><td>0.093998</td><td>-0.592974</td><td>-0.569525</td><td>-0.546076</td><td>-0.671803</td><td>-0.647855</td><td>-0.623907</td><td>-0.59946</td><td>-0.575512</td><td>-0.697747</td><td>-0.6733</td><td>0.168391</td><td>0.263704</td><td>-0.59946</td><td>-0.707226</td><td>-0.684276</td><td>-0.661825</td><td>-0.638874</td><td>-0.615924</td><td>2.654273</td><td>193.595015</td></tr><tr><td>12.0</td><td>18.0</td><td>2.4816e6</td><td>9.37329</td><td>477817.39852</td><td>2.247002</td><td>2.243796</td><td>2.240589</td><td>2.237382</td><td>2.234165</td><td>2.355311</td><td>2.351948</td><td>2.348573</td><td>2.34521</td><td>2.341847</td><td>2.441117</td><td>2.437631</td><td>2.576445</td><td>2.430659</td><td>2.427174</td><td>2.51079</td><td>2.507204</td><td>2.503617</td><td>2.500042</td><td>2.687878</td><td>2.538163</td><td>2.532734</td><td>2.527292</td><td>2.690554</td><td>2.516399</td><td>99170.748697</td><td>98390.530068</td><td>98634.959583</td><td>98367.19187</td><td>98099.297313</td><td>99031.347126</td><td>98753.68558</td><td>&hellip;</td><td>-2.322524</td><td>0.216299</td><td>-2.374837</td><td>-2.400993</td><td>-2.427673</td><td>-2.253994</td><td>-2.277535</td><td>-2.301599</td><td>-2.32514</td><td>-2.34868</td><td>1.383237</td><td>1.439615</td><td>0.129967</td><td>0.188425</td><td>0.269064</td><td>1.329853</td><td>1.384734</td><td>1.440114</td><td>0.233445</td><td>1.549875</td><td>1.287944</td><td>1.341827</td><td>1.39571</td><td>1.449593</td><td>1.503975</td><td>1.253519</td><td>0.094171</td><td>1.359788</td><td>1.413172</td><td>1.466057</td><td>1.236056</td><td>1.285449</td><td>1.335341</td><td>1.385233</td><td>1.434626</td><td>2.826631</td><td>150.41122</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;imputation&#39;</span><span class="p">,</span> <span class="n">imputation</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;feature_engineering&#39;</span><span class="p">,</span> <span class="n">feature_engineering</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;only_wind&#39;</span><span class="p">,</span> <span class="n">only_wind</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;only_sotavento&#39;</span><span class="p">,</span> <span class="n">only_sotavento</span><span class="p">()),</span> 
    <span class="p">(</span><span class="s1">&#39;KNN&#39;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">())</span> 
    <span class="p">])</span>

<span class="n">pipeline</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">imputation__method</span><span class="o">=</span><span class="s1">&#39;simple_mean&#39;</span><span class="p">,</span> <span class="n">feature_engineering__apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">only_wind__apply</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_sotavento__apply</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;imputation&#x27;, imputation(method=&#x27;simple_mean&#x27;)),
                (&#x27;feature_engineering&#x27;, feature_engineering(apply=True)),
                (&#x27;only_wind&#x27;, only_wind()),
                (&#x27;only_sotavento&#x27;, only_sotavento()),
                (&#x27;KNN&#x27;, KNeighborsRegressor())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;imputation&#x27;, imputation(method=&#x27;simple_mean&#x27;)),
                (&#x27;feature_engineering&#x27;, feature_engineering(apply=True)),
                (&#x27;only_wind&#x27;, only_wind()),
                (&#x27;only_sotavento&#x27;, only_sotavento()),
                (&#x27;KNN&#x27;, KNeighborsRegressor())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">imputation</label><div class="sk-toggleable__content"><pre>imputation(method=&#x27;simple_mean&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">feature_engineering</label><div class="sk-toggleable__content"><pre>feature_engineering(apply=True)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">only_wind</label><div class="sk-toggleable__content"><pre>only_wind()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">only_sotavento</label><div class="sk-toggleable__content"><pre>only_sotavento()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">KNeighborsRegressor</label><div class="sk-toggleable__content"><pre>KNeighborsRegressor()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([728.5  , 399.448, 762.706, ..., 576.422, 354.584, 531.466])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span> 
                            <span class="n">param_distributions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;KNN__n_neighbors&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                                                 <span class="s1">&#39;KNN__metric&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="s1">&#39;cityblock&#39;</span><span class="p">,</span> <span class="s1">&#39;manhattan&#39;</span><span class="p">]},</span>
                             <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">)</span>

<span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {color: black;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomizedSearchCV(cv=5,
                   estimator=Pipeline(steps=[(&#x27;imputation&#x27;,
                                              imputation(method=&#x27;simple_mean&#x27;)),
                                             (&#x27;feature_engineering&#x27;,
                                              feature_engineering(apply=True)),
                                             (&#x27;only_wind&#x27;, only_wind()),
                                             (&#x27;only_sotavento&#x27;,
                                              only_sotavento()),
                                             (&#x27;KNN&#x27;, KNeighborsRegressor())]),
                   param_distributions={&#x27;KNN__metric&#x27;: [&#x27;euclidean&#x27;, &#x27;cosine&#x27;,
                                                        &#x27;cityblock&#x27;,
                                                        &#x27;manhattan&#x27;],
                                        &#x27;KNN__n_neighbors&#x27;: array([200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320,
       330, 340, 350, 360, 370, 380, 390, 400, 410, 420, 430, 440, 450,
       460, 470, 480, 490])},
                   random_state=123, scoring=&#x27;neg_mean_absolute_error&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">RandomizedSearchCV</label><div class="sk-toggleable__content"><pre>RandomizedSearchCV(cv=5,
                   estimator=Pipeline(steps=[(&#x27;imputation&#x27;,
                                              imputation(method=&#x27;simple_mean&#x27;)),
                                             (&#x27;feature_engineering&#x27;,
                                              feature_engineering(apply=True)),
                                             (&#x27;only_wind&#x27;, only_wind()),
                                             (&#x27;only_sotavento&#x27;,
                                              only_sotavento()),
                                             (&#x27;KNN&#x27;, KNeighborsRegressor())]),
                   param_distributions={&#x27;KNN__metric&#x27;: [&#x27;euclidean&#x27;, &#x27;cosine&#x27;,
                                                        &#x27;cityblock&#x27;,
                                                        &#x27;manhattan&#x27;],
                                        &#x27;KNN__n_neighbors&#x27;: array([200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320,
       330, 340, 350, 360, 370, 380, 390, 400, 410, 420, 430, 440, 450,
       460, 470, 480, 490])},
                   random_state=123, scoring=&#x27;neg_mean_absolute_error&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;imputation&#x27;, imputation(method=&#x27;simple_mean&#x27;)),
                (&#x27;feature_engineering&#x27;, feature_engineering(apply=True)),
                (&#x27;only_wind&#x27;, only_wind()),
                (&#x27;only_sotavento&#x27;, only_sotavento()),
                (&#x27;KNN&#x27;, KNeighborsRegressor())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">imputation</label><div class="sk-toggleable__content"><pre>imputation(method=&#x27;simple_mean&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">feature_engineering</label><div class="sk-toggleable__content"><pre>feature_engineering(apply=True)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">only_wind</label><div class="sk-toggleable__content"><pre>only_wind()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">only_sotavento</label><div class="sk-toggleable__content"><pre>only_sotavento()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">KNeighborsRegressor</label><div class="sk-toggleable__content"><pre>KNeighborsRegressor()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;KNN__n_neighbors&#39;: 220, &#39;KNN__metric&#39;: &#39;cityblock&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search</span><span class="o">.</span><span class="n">best_score_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-484.6443784846776
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="metric-and-inner-outer-evaluation-decision">
<h2><strong>Metric and Inner-Outer evaluation decision</strong><a class="headerlink" href="#metric-and-inner-outer-evaluation-decision" title="Link to this heading">#</a></h2>
<p>From the previous analysis we know that our response has autocorrelation, that te energy produced depends on the months, that some years are missing data on specific months, and that 2008 has only 178 observations and 2009 has no data before March. All this means that:</p>
<ul class="simple">
<li><p>We can not use random sampling for neither inner or outer evaluation.</p></li>
<li><p>We have to make sure that we train and test using full years, or, at least, data from every month.</p></li>
<li><p>Cross validation can introduce bias and return estimations of future performance that are not robust specially when using <span class="math notranslate nohighlight">\(k\)</span> big.</p></li>
<li><p>There are a lot of cells to impute and this step is going to be very important.</p></li>
<li><p>Lots of variables means that the training will take longer if we use all of them. Probably we won’t need to use all but first, we have been asked to check if this is the case.</p></li>
</ul>
<p>Adding to the previous constraints, we’ve been asked to test a lot of things in this project, so a lot of computation is going to be required. In the next section we explain how we are going to tackle all these questions in a way that we can be confident of the results but we avoid excessive computation.</p>
<section id="inner-outer-evaluation">
<h3><strong>Inner-Outer evaluation</strong><a class="headerlink" href="#inner-outer-evaluation" title="Link to this heading">#</a></h3>
<p>So, we need to test a lot of things, take care of autocorrelation, and make sure that we have all 12 month in the inner and outer evaluation. For these reasons, we have decided to use simple train-test split both in inner and outer evaluation. This will allow us to iterate and respond to all questions a lot quicker at the spend of having some bias due to the simpler approach.</p>
<p>For testing, we will use 2008 + 2009. This way we have data for all months, in total we have 1099 observations (23.14%) and we avoid having years with lots of months missing in the training that can cause a lot of problems.</p>
<p>The inner will have also a simple train-test split with data from ‘05-‘07. As said, we need to have data from all months to evaluate, so, if we choose a % of the data, i.e. 70%, we would be missing data from the first months (70% of 3 years is 2 years and a portion of the next). Also, the ANOVA test showed that when comparing the means of these 3 years we have evidences to say that they are different altough the distributions are very similar. For this reason, we wont use ‘06 for validation as it has the biggest difference with respect to the others, and we can not use ‘07 because it has some months missing. For these reasons we have to choose ‘05 for the validation and ‘06 and ‘07 for training.</p>
</section>
<section id="metric">
<h3><strong>Metric</strong><a class="headerlink" href="#metric" title="Link to this heading">#</a></h3>
<p>Last, to measure the accuracy of our models, we choose MAE (mean absolute error). We have 2 reasons to do this:</p>
<ul class="simple">
<li><p>First, because of the high dispersion of the response. Using RMSE would lead to give more importance to extreme values and we have a lot.</p></li>
<li><p>Second, if we think about our task, we want to predict energy production so that the people in charge decide if it will be needed to produce more energy with other non-renewable sources. This means that we are more interested in measuring absolute error than squared error. I am convinced that there exists a threshold of energy production where it is not sufficient to satisfy the demand and other sources are needed. It would be very valuable to know this threshold because we could use a mixture of MAE and RMSE (or huber loss) in order to have RMSE for the values under the threshold and MAE for the ones above.</p></li>
</ul>
</section>
<section id="type-of-problem">
<h3><strong>Type of problem</strong><a class="headerlink" href="#type-of-problem" title="Link to this heading">#</a></h3>
<p>Obviously, this problem is a regression one. We want to predict a continuous variable.</p>
</section>
</section>
<section id="predicting-energy-production">
<h2><strong>Predicting energy production</strong><a class="headerlink" href="#predicting-energy-production" title="Link to this heading">#</a></h2>
<p>Now, the main part of the assignment. We’ve been asked to develop a model to predict the energy produced at the sotavento wind farm and answer some questions:</p>
<ul class="simple">
<li><p>Is it necessary to use all 550 variables or is it enough to use only the ones for sotavento (location 13)?</p></li>
<li><p>Can we use only the variables associated with the wind?</p></li>
<li><p>Does imputation improve performance? If so, which method?</p></li>
<li><p>Which type of model among KNN, trees and tree-based ensembles seems to work best?</p></li>
<li><p>Does hyperparameter optimization improve performance? Comment on the methods implemented.</p></li>
<li><p>After selecting the best model, which is the estimated future performance? Give an interpretation of the metrics used.</p></li>
<li><p>Fit the final model and give predictions for the observations in the dataset <em>wind_competition.csv</em>.</p></li>
</ul>
<p>There are several thing to test here. In order to answer the questions regarding imputation methods and feature importance, we are going to apply a global HPO on histogram gradient boosting, which can handle missing values.</p>
<p>The idea is to perform this global HPO as a first step in order to carry out reduced and more efficient global HPO after that, more focused on obtaining the best model.</p>
<p>After answering these questions we will proceed to compare the different models (KNN, trees, 2 tree-based ensembles) with their HPO.</p>
<section id="model-search-model-hpo">
<h3><strong>Model search (Model HPO)</strong><a class="headerlink" href="#model-search-model-hpo" title="Link to this heading">#</a></h3>
<p>Utils to perform model search (HPO on model hyperparameters).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OptunaSearchCV</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">cv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
 
       <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">))</span>
       <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="p">))</span>
       <span class="k">return</span> <span class="n">score</span> 
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">):</span>
       
       <span class="n">sampler</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">TPESampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
       <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;maximize&#39;</span> <span class="k">if</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span>  <span class="k">else</span> <span class="s1">&#39;minimize&#39;</span>
       <span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">)</span>
       <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">),</span> <span class="n">n_trials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span><span class="p">)</span> 
       <span class="bp">self</span><span class="o">.</span><span class="n">best_params_</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">best_score_</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_value</span>   
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">search</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">train_prop</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">n_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span> <span class="p">:</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_method</span> <span class="o">=</span> <span class="n">cv_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_prop</span> <span class="o">=</span> <span class="n">train_prop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_folds</span> <span class="o">=</span> <span class="n">n_folds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">search_method</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">X_years</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">years_training</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">years_testing</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_method</span> <span class="o">==</span> <span class="s1">&#39;years_based&#39;</span><span class="p">:</span>

            <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X_years</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">years_training</span><span class="p">:</span> <span class="c1"># train years</span>
                    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># -1 = train </span>
                <span class="k">elif</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">years_testing</span><span class="p">:</span> <span class="c1"># test years</span>
                    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># 0 = test</span>
            <span class="n">cv</span> <span class="o">=</span> <span class="n">PredefinedSplit</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;random_simple_validation&#39;</span><span class="p">,</span> <span class="s1">&#39;not_random_simple_validation&#39;</span><span class="p">]</span> <span class="p">:</span>
        
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">n_train</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_prop</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
            <span class="n">n_test</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">n_train</span>
            <span class="n">train_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_train</span><span class="p">)</span> <span class="c1"># -1 = Train </span>
            <span class="n">test_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_test</span><span class="p">)</span>  <span class="c1"># 0 = Test</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">train_indices</span><span class="p">,</span> <span class="n">test_indices</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_method</span> <span class="o">==</span> <span class="s1">&#39;random_simple_validation&#39;</span><span class="p">:</span>
               <span class="c1"># To perform random simple validation we have to shuffle the indices</span>
               <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
               <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
               <span class="n">cv</span> <span class="o">=</span> <span class="n">PredefinedSplit</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
               
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_method</span> <span class="o">==</span> <span class="s1">&#39;not_random_simple_validation&#39;</span> <span class="p">:</span>
                <span class="n">cv</span> <span class="o">=</span> <span class="n">PredefinedSplit</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
    
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_method</span> <span class="o">==</span> <span class="s1">&#39;kfolds&#39;</span> <span class="p">:</span>
            <span class="n">cv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_folds</span>

        <span class="k">if</span> <span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;grid_search&#39;</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span> <span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;random_search&#39;</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> 
                                                 <span class="n">n_iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;halving_search&#39;</span><span class="p">:</span>            
            <span class="n">search</span> <span class="o">=</span> <span class="n">HalvingGridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> 
                                         <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_resources</span><span class="o">=</span><span class="s1">&#39;exhaust&#39;</span><span class="p">,</span> <span class="n">max_resources</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
            
        <span class="c1"># BayesianSearchCV is not maintain anymore by sklearn team and doesn&#39;t work with the current version of Numpy due to np.int is depreciated.    </span>
        <span class="c1">#elif search_method == &#39;bayesian_search&#39;:</span>
            <span class="c1">#search = BayesSearchCV(estimator=estimator, search_spaces=self.param_grid, cv=cv, n_iter=n_iter, random_state=seed, scoring=self.score)</span>

        <span class="k">elif</span> <span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;optuna&#39;</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="n">OptunaSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> 
                                    <span class="n">score</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
          
        <span class="k">return</span> <span class="n">search</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="global-search-global-hpo">
<h3><strong>Global search (Global HPO)</strong><a class="headerlink" href="#global-search-global-hpo" title="Link to this heading">#</a></h3>
<p>Utils to perform global HPO (HPO on both preprocessing elements and model hyperparameters).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">global_search</span> <span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">preprocessing_grid</span><span class="p">,</span> <span class="n">model_param_grid_search</span><span class="p">,</span> <span class="n">model_param_random_search</span><span class="p">,</span> <span class="n">model_param_halving_search</span><span class="p">,</span> <span class="n">model_param_optuna</span><span class="p">,</span> <span class="n">search_methods_grid</span><span class="p">,</span> <span class="n">cv_method</span><span class="p">,</span> <span class="n">train_prop</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">n_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">X_years</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">years_training</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">years_testing</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing_grid</span> <span class="o">=</span> <span class="n">preprocessing_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_param_grid_search</span> <span class="o">=</span> <span class="n">model_param_grid_search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_param_random_search</span> <span class="o">=</span> <span class="n">model_param_random_search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_param_halving_search</span> <span class="o">=</span> <span class="n">model_param_halving_search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_param_optuna</span> <span class="o">=</span> <span class="n">model_param_optuna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_methods_grid</span> <span class="o">=</span> <span class="n">search_methods_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_method</span> <span class="o">=</span> <span class="n">cv_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_prop</span> <span class="o">=</span> <span class="n">train_prop</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">n_folds</span> <span class="o">=</span> <span class="n">n_folds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_years</span> <span class="o">=</span> <span class="n">X_years</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">years_training</span> <span class="o">=</span> <span class="n">years_training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">years_testing</span> <span class="o">=</span> <span class="n">years_testing</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span> <span class="p">:</span>
        
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">preprocessing_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing_grid</span>
        <span class="n">model_param_grid_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_param_grid_search</span>
        <span class="n">model_param_random_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_param_random_search</span>
        <span class="n">model_param_halving_search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_param_halving_search</span>
        <span class="n">model_param_optuna</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_param_optuna</span>
        <span class="n">search_methods_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_methods_grid</span>
        <span class="n">cv_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_method</span>
        <span class="n">train_prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_prop</span>
        <span class="n">n_folds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_folds</span>
        <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span>
        <span class="n">n_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
        <span class="n">X_years</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_years</span>
        <span class="n">years_training</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">years_training</span>
        <span class="n">years_testing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">years_testing</span>

        <span class="n">params</span><span class="p">,</span> <span class="n">score_values</span><span class="p">,</span> <span class="n">search_methods</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">preprocessing_search_space</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">preprocessing_grid</span><span class="p">[</span><span class="s1">&#39;imputation&#39;</span><span class="p">],</span> <span class="n">preprocessing_grid</span><span class="p">[</span><span class="s1">&#39;feature_engineering&#39;</span><span class="p">],</span> 
                                                  <span class="n">preprocessing_grid</span><span class="p">[</span><span class="s1">&#39;only_sotavento&#39;</span><span class="p">],</span> <span class="n">preprocessing_grid</span><span class="p">[</span><span class="s1">&#39;only_wind&#39;</span><span class="p">]))</span>
        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;grid_search&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_param_grid_search</span> 
        <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;random_search&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_param_random_search</span> 
        <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;halving_search&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_param_halving_search</span> 
        <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;optuna&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_param_optuna</span> 
        
        
        <span class="k">for</span> <span class="p">(</span><span class="n">imputation_</span><span class="p">,</span> <span class="n">feature_engineering_</span><span class="p">,</span> <span class="n">only_sotavento_</span><span class="p">,</span> <span class="n">only_wind_</span><span class="p">),</span> <span class="n">search_method</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">preprocessing_search_space</span><span class="p">,</span> <span class="n">search_methods_grid</span><span class="p">)</span> <span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;imputation:&#39;</span><span class="p">,</span> <span class="n">imputation_</span><span class="p">,</span> <span class="s1">&#39;, feature_engineering:&#39;</span><span class="p">,</span> <span class="n">feature_engineering_</span><span class="p">,</span> <span class="s1">&#39;, only_sotavento:&#39;</span><span class="p">,</span> <span class="n">only_sotavento_</span><span class="p">,</span> <span class="s1">&#39;, only_wind:&#39;</span><span class="p">,</span> <span class="n">only_wind_</span><span class="p">,</span> <span class="s1">&#39;, search_method:&#39;</span><span class="p">,</span> <span class="n">search_method</span><span class="p">)</span>

            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            
            <span class="c1"># Pipeline</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;imputation&#39;</span><span class="p">,</span> <span class="n">imputation</span><span class="p">()),</span>
                                 <span class="p">(</span><span class="s1">&#39;feature_engineering&#39;</span><span class="p">,</span> <span class="n">feature_engineering</span><span class="p">()),</span>
                                 <span class="p">(</span><span class="s1">&#39;only_wind&#39;</span><span class="p">,</span> <span class="n">only_wind</span><span class="p">()),</span>
                                 <span class="p">(</span><span class="s1">&#39;only_sotavento&#39;</span><span class="p">,</span> <span class="n">only_sotavento</span><span class="p">()),</span> 
                                 <span class="p">(</span><span class="s1">&#39;estimator&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> 
                                <span class="p">])</span>
            
            <span class="n">pipeline</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">imputation__method</span><span class="o">=</span><span class="n">imputation_</span><span class="p">,</span> <span class="n">feature_engineering__apply</span><span class="o">=</span><span class="n">feature_engineering_</span><span class="p">,</span>
                                 <span class="n">only_wind__apply</span><span class="o">=</span><span class="n">only_wind_</span><span class="p">,</span> <span class="n">only_sotavento__apply</span><span class="o">=</span><span class="n">only_sotavento_</span><span class="p">)</span>

            <span class="c1"># Search - HPO</span>
            <span class="n">search_</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">[</span><span class="n">search_method</span><span class="p">],</span>  
                             <span class="n">cv_method</span><span class="o">=</span><span class="n">cv_method</span><span class="p">,</span> <span class="n">train_prop</span><span class="o">=</span><span class="n">train_prop</span><span class="p">,</span> <span class="n">n_folds</span><span class="o">=</span><span class="n">n_folds</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">)</span>
            <span class="n">search_</span> <span class="o">=</span> <span class="n">search_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">search_method</span><span class="o">=</span><span class="n">search_method</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> 
                                  <span class="n">X_years</span><span class="o">=</span><span class="n">X_years</span><span class="p">,</span> <span class="n">years_training</span><span class="o">=</span><span class="n">years_training</span><span class="p">,</span> <span class="n">years_testing</span><span class="o">=</span><span class="n">years_testing</span><span class="p">)</span>
            
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">)</span>
          
            <span class="n">params_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;imputation&#39;</span><span class="p">:</span> <span class="n">imputation_</span><span class="p">,</span> <span class="s1">&#39;feature_engineering&#39;</span><span class="p">:</span> <span class="n">feature_engineering_</span><span class="p">,</span>
                           <span class="s1">&#39;only_sotavento&#39;</span><span class="p">:</span> <span class="n">only_sotavento_</span><span class="p">,</span> <span class="s1">&#39;only_wind&#39;</span><span class="p">:</span> <span class="n">only_wind_</span><span class="p">}</span>
            <span class="n">params_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">search_</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params_dict</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">:</span>
                <span class="n">score_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">search_</span><span class="o">.</span><span class="n">best_score_</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="n">score</span><span class="p">:</span>
                    <span class="n">score_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">search_</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">score_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search_</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
            <span class="n">search_methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search_method</span><span class="p">)</span>

        <span class="n">best_params_</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">score_values</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">best_score_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">score_values</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score_values</span><span class="p">,</span> 
                                                                 <span class="s1">&#39;search_method&#39;</span><span class="p">:</span><span class="n">search_methods</span><span class="p">,</span> 
                                                                 <span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">times</span><span class="p">})),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="n">score</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">=</span> <span class="n">results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_params_</span> <span class="o">=</span> <span class="n">best_params_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_score_</span> <span class="o">=</span> <span class="n">best_score_</span>
</pre></div>
</div>
</div>
</div>
<section id="strategical-test-histogram-gradient-boosting">
<h4><strong>Strategical test: Histogram Gradient Boosting</strong><a class="headerlink" href="#strategical-test-histogram-gradient-boosting" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;imputation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;no_imputation&#39;</span><span class="p">,</span> <span class="s1">&#39;simple_median&#39;</span><span class="p">,</span> <span class="s1">&#39;iterative_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;iterative_median&#39;</span><span class="p">],</span> 
                      <span class="s1">&#39;feature_engineering&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> 
                      <span class="s1">&#39;only_sotavento&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> 
                      <span class="s1">&#39;only_wind&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]}</span>

<span class="n">model_param_grid_search</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__l2_regularization&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__max_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">]}</span>

<span class="n">model_param_halving_search</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__l2_regularization&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__max_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">120</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">]}</span>

<span class="n">model_param_random_search</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__l2_regularization&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__max_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">140</span><span class="p">],</span>
                             <span class="s1">&#39;estimator__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">]}</span>


<span class="k">def</span> <span class="nf">model_param_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
            <span class="s1">&#39;estimator__l2_regularization&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__l2_regularization&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__learning_rate&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__learning_rate&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s1">&#39;estimator__max_iter&#39;</span><span class="p">:</span>  <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__max_iter&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span>
            <span class="s1">&#39;estimator__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__max_leaf_nodes&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">75</span><span class="p">)}</span>

<span class="n">search_methods_grid</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;grid_search&#39;</span><span class="p">,</span> <span class="s1">&#39;halving_search&#39;</span><span class="p">,</span> <span class="s1">&#39;random_search&#39;</span><span class="p">,</span> <span class="s1">&#39;optuna&#39;</span><span class="p">]</span>

<span class="n">hgb_global_search_</span> <span class="o">=</span> <span class="n">global_search</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">HistGradientBoostingRegressor</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;squared_error&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
                                   <span class="n">preprocessing_grid</span><span class="o">=</span><span class="n">preprocessing_grid</span><span class="p">,</span> 
                                   <span class="n">model_param_grid_search</span><span class="o">=</span><span class="n">model_param_grid_search</span><span class="p">,</span>
                                   <span class="n">model_param_random_search</span><span class="o">=</span><span class="n">model_param_random_search</span><span class="p">,</span>
                                   <span class="n">model_param_halving_search</span><span class="o">=</span><span class="n">model_param_halving_search</span><span class="p">,</span> 
                                   <span class="n">model_param_optuna</span> <span class="o">=</span> <span class="n">model_param_optuna</span><span class="p">,</span>
                                   <span class="n">search_methods_grid</span><span class="o">=</span><span class="n">search_methods_grid</span><span class="p">,</span>
                                   <span class="n">cv_method</span><span class="o">=</span><span class="s1">&#39;years_based&#39;</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span>
                                   <span class="n">n_iter</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">666</span><span class="p">,</span> 
                                   <span class="n">X_years</span><span class="o">=</span><span class="n">X_train_years</span><span class="p">,</span> <span class="n">years_training</span><span class="o">=</span><span class="p">[</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2007</span><span class="p">],</span> <span class="n">years_testing</span><span class="o">=</span><span class="p">[</span><span class="mi">2005</span><span class="p">])</span>

<span class="n">hgb_global_search_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="c1"># Time; 445 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hgb_global_search_</span><span class="o">.</span><span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (128, 12)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__l2_regularization</th><th>estimator__learning_rate</th><th>estimator__max_depth</th><th>estimator__max_iter</th><th>estimator__max_leaf_nodes</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>f64</td><td>f64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>0.0</td><td>0.1</td><td>4</td><td>120</td><td>50</td><td>280.82337</td><td>&quot;halving_search…</td><td>791.365196</td></tr><tr><td>&quot;iterative_medi…</td><td>false</td><td>false</td><td>false</td><td>0.0</td><td>0.1</td><td>6</td><td>100</td><td>30</td><td>281.708733</td><td>&quot;grid_search&quot;</td><td>342.778872</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>false</td><td>false</td><td>0.03</td><td>0.1</td><td>9</td><td>100</td><td>10</td><td>281.757864</td><td>&quot;grid_search&quot;</td><td>79.814491</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>false</td><td>false</td><td>0.03</td><td>0.1</td><td>9</td><td>75</td><td>10</td><td>282.522898</td><td>&quot;random_search&quot;</td><td>79.827537</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>false</td><td>false</td><td>5.0</td><td>0.100682</td><td>5</td><td>84</td><td>33</td><td>283.11109</td><td>&quot;optuna&quot;</td><td>130.685306</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>false</td><td>false</td><td>0.0</td><td>0.1</td><td>6</td><td>100</td><td>30</td><td>283.88077</td><td>&quot;grid_search&quot;</td><td>84.90985</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>false</td><td>false</td><td>0.5</td><td>0.1</td><td>4</td><td>75</td><td>50</td><td>284.401459</td><td>&quot;random_search&quot;</td><td>85.438423</td></tr><tr><td>&quot;iterative_mean…</td><td>false</td><td>false</td><td>false</td><td>5.0</td><td>0.100685</td><td>7</td><td>129</td><td>49</td><td>284.406409</td><td>&quot;optuna&quot;</td><td>526.531146</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>false</td><td>false</td><td>0.0</td><td>0.1</td><td>4</td><td>120</td><td>20</td><td>284.573717</td><td>&quot;halving_search…</td><td>96.650337</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>false</td><td>false</td><td>0.05</td><td>0.1</td><td>4</td><td>120</td><td>20</td><td>284.578539</td><td>&quot;halving_search…</td><td>93.48349</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>false</td><td>false</td><td>0.4</td><td>0.179038</td><td>8</td><td>79</td><td>10</td><td>284.582479</td><td>&quot;optuna&quot;</td><td>143.077008</td></tr><tr><td>&quot;iterative_mean…</td><td>false</td><td>false</td><td>false</td><td>0.2</td><td>0.1</td><td>6</td><td>100</td><td>10</td><td>285.230065</td><td>&quot;grid_search&quot;</td><td>333.882715</td></tr><tr><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td><td>&hellip;</td></tr><tr><td>&quot;iterative_mean…</td><td>true</td><td>true</td><td>true</td><td>0.0</td><td>0.1</td><td>4</td><td>120</td><td>50</td><td>320.13117</td><td>&quot;halving_search…</td><td>727.931041</td></tr><tr><td>&quot;iterative_mean…</td><td>true</td><td>true</td><td>true</td><td>0.03</td><td>0.1</td><td>9</td><td>75</td><td>10</td><td>323.37844</td><td>&quot;random_search&quot;</td><td>147.050513</td></tr><tr><td>&quot;iterative_mean…</td><td>true</td><td>true</td><td>true</td><td>0.5</td><td>0.180048</td><td>3</td><td>88</td><td>69</td><td>323.633489</td><td>&quot;optuna&quot;</td><td>145.814576</td></tr><tr><td>&quot;iterative_mean…</td><td>true</td><td>true</td><td>true</td><td>0.03</td><td>0.1</td><td>6</td><td>100</td><td>10</td><td>323.802314</td><td>&quot;grid_search&quot;</td><td>173.161132</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>true</td><td>true</td><td>2.5</td><td>0.13574</td><td>2</td><td>108</td><td>25</td><td>327.005615</td><td>&quot;optuna&quot;</td><td>14.351036</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>true</td><td>true</td><td>0.03</td><td>0.1</td><td>2</td><td>100</td><td>10</td><td>327.500668</td><td>&quot;grid_search&quot;</td><td>12.899861</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>true</td><td>true</td><td>0.0</td><td>0.1</td><td>2</td><td>100</td><td>10</td><td>328.40603</td><td>&quot;grid_search&quot;</td><td>5.843835</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>true</td><td>true</td><td>1.0</td><td>0.1</td><td>4</td><td>75</td><td>30</td><td>328.705352</td><td>&quot;random_search&quot;</td><td>11.51822</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>true</td><td>true</td><td>4.4</td><td>0.175537</td><td>1</td><td>230</td><td>18</td><td>328.7959</td><td>&quot;optuna&quot;</td><td>10.950737</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>true</td><td>true</td><td>0.03</td><td>0.1</td><td>9</td><td>75</td><td>10</td><td>329.578586</td><td>&quot;random_search&quot;</td><td>5.965826</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>true</td><td>true</td><td>0.0</td><td>0.1</td><td>4</td><td>120</td><td>50</td><td>331.456231</td><td>&quot;halving_search…</td><td>17.902335</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>true</td><td>true</td><td>0.0</td><td>0.1</td><td>6</td><td>120</td><td>20</td><td>334.243871</td><td>&quot;halving_search…</td><td>13.949281</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hgb_global_search_</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="s1">&#39;results_hgb_pipeline.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_hgb_pipeline</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;results/results_hgb_pipeline_.csv&#39;</span><span class="p">)</span>
<span class="n">results_hgb_pipeline</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (25, 12)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__l2_regularization</th><th>estimator__learning_rate</th><th>estimator__max_depth</th><th>estimator__max_iter</th><th>estimator__max_leaf_nodes</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>f64</td><td>f64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>0.0</td><td>0.1</td><td>4</td><td>120</td><td>50</td><td>280.82337</td><td>&quot;halving_search…</td><td>791.365196</td></tr><tr><td>&quot;iterative_medi…</td><td>false</td><td>false</td><td>false</td><td>0.0</td><td>0.1</td><td>6</td><td>100</td><td>30</td><td>281.708733</td><td>&quot;grid_search&quot;</td><td>342.778872</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>false</td><td>false</td><td>0.03</td><td>0.1</td><td>9</td><td>100</td><td>10</td><td>281.757864</td><td>&quot;grid_search&quot;</td><td>79.814491</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>false</td><td>false</td><td>0.03</td><td>0.1</td><td>9</td><td>75</td><td>10</td><td>282.522898</td><td>&quot;random_search&quot;</td><td>79.827537</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>false</td><td>false</td><td>5.0</td><td>0.100682</td><td>5</td><td>84</td><td>33</td><td>283.11109</td><td>&quot;optuna&quot;</td><td>130.685306</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>false</td><td>false</td><td>0.0</td><td>0.1</td><td>6</td><td>100</td><td>30</td><td>283.88077</td><td>&quot;grid_search&quot;</td><td>84.90985</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>false</td><td>false</td><td>0.5</td><td>0.1</td><td>4</td><td>75</td><td>50</td><td>284.401459</td><td>&quot;random_search&quot;</td><td>85.438423</td></tr><tr><td>&quot;iterative_mean…</td><td>false</td><td>false</td><td>false</td><td>5.0</td><td>0.100685</td><td>7</td><td>129</td><td>49</td><td>284.406409</td><td>&quot;optuna&quot;</td><td>526.531146</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>false</td><td>false</td><td>0.0</td><td>0.1</td><td>4</td><td>120</td><td>20</td><td>284.573717</td><td>&quot;halving_search…</td><td>96.650337</td></tr><tr><td>&quot;simple_median&quot;</td><td>true</td><td>false</td><td>false</td><td>0.05</td><td>0.1</td><td>4</td><td>120</td><td>20</td><td>284.578539</td><td>&quot;halving_search…</td><td>93.48349</td></tr><tr><td>&quot;no_imputation&quot;</td><td>true</td><td>false</td><td>false</td><td>0.4</td><td>0.179038</td><td>8</td><td>79</td><td>10</td><td>284.582479</td><td>&quot;optuna&quot;</td><td>143.077008</td></tr><tr><td>&quot;iterative_mean…</td><td>false</td><td>false</td><td>false</td><td>0.2</td><td>0.1</td><td>6</td><td>100</td><td>10</td><td>285.230065</td><td>&quot;grid_search&quot;</td><td>333.882715</td></tr><tr><td>&quot;iterative_medi…</td><td>true</td><td>true</td><td>false</td><td>4.0</td><td>0.165337</td><td>3</td><td>95</td><td>37</td><td>285.27612</td><td>&quot;optuna&quot;</td><td>157.316353</td></tr><tr><td>&quot;iterative_mean…</td><td>false</td><td>false</td><td>false</td><td>0.5</td><td>0.1</td><td>6</td><td>50</td><td>30</td><td>285.564312</td><td>&quot;random_search&quot;</td><td>312.395845</td></tr><tr><td>&quot;iterative_medi…</td><td>false</td><td>false</td><td>false</td><td>0.03</td><td>0.1</td><td>9</td><td>75</td><td>10</td><td>285.718136</td><td>&quot;random_search&quot;</td><td>312.437697</td></tr><tr><td>&quot;iterative_mean…</td><td>true</td><td>false</td><td>false</td><td>2.4</td><td>0.142454</td><td>2</td><td>216</td><td>22</td><td>285.971669</td><td>&quot;optuna&quot;</td><td>255.757538</td></tr><tr><td>&quot;iterative_medi…</td><td>false</td><td>false</td><td>false</td><td>1.2</td><td>0.100682</td><td>6</td><td>106</td><td>46</td><td>286.515798</td><td>&quot;optuna&quot;</td><td>541.473066</td></tr><tr><td>&quot;iterative_medi…</td><td>true</td><td>true</td><td>false</td><td>0.05</td><td>0.1</td><td>4</td><td>120</td><td>20</td><td>286.816902</td><td>&quot;halving_search…</td><td>726.958659</td></tr><tr><td>&quot;iterative_medi…</td><td>true</td><td>true</td><td>false</td><td>0.5</td><td>0.1</td><td>4</td><td>75</td><td>50</td><td>287.142383</td><td>&quot;random_search&quot;</td><td>153.716091</td></tr><tr><td>&quot;iterative_mean…</td><td>true</td><td>true</td><td>false</td><td>3.2</td><td>0.100338</td><td>3</td><td>183</td><td>50</td><td>287.163815</td><td>&quot;optuna&quot;</td><td>154.763247</td></tr><tr><td>&quot;simple_median&quot;</td><td>false</td><td>false</td><td>false</td><td>0.5</td><td>0.1</td><td>6</td><td>50</td><td>30</td><td>287.357097</td><td>&quot;random_search&quot;</td><td>189.166188</td></tr><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>0.3</td><td>0.118997</td><td>2</td><td>169</td><td>38</td><td>287.440589</td><td>&quot;optuna&quot;</td><td>259.735719</td></tr><tr><td>&quot;iterative_mean…</td><td>true</td><td>false</td><td>false</td><td>0.05</td><td>0.1</td><td>9</td><td>120</td><td>20</td><td>287.656923</td><td>&quot;halving_search…</td><td>815.847916</td></tr><tr><td>&quot;iterative_medi…</td><td>true</td><td>true</td><td>false</td><td>0.03</td><td>0.1</td><td>6</td><td>100</td><td>30</td><td>287.814183</td><td>&quot;grid_search&quot;</td><td>181.601993</td></tr><tr><td>&quot;simple_median&quot;</td><td>false</td><td>false</td><td>false</td><td>0.0</td><td>0.1</td><td>6</td><td>100</td><td>30</td><td>287.876354</td><td>&quot;grid_search&quot;</td><td>190.359517</td></tr></tbody></table></div></div></div>
</div>
<p>We can extract several conclusions for this global HPO:</p>
<ul class="simple">
<li><p>The amount of time to carry out a global HPO in this context is too much, in this case 445 mins (7.40 hours).</p></li>
<li><p>Iterative and simple imputer are the best imputation methods, and is pretty clear that imputation improve performance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">feature_engineering</span> <span class="pre">=</span> <span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">only_sotavento</span> <span class="pre">=</span> <span class="pre">False</span></code>, <code class="docutils literal notranslate"><span class="pre">only_wind</span> <span class="pre">=</span> <span class="pre">False</span></code> is the dominant combination. So, it is not necessary to use the 550 predictors, but is not enough with only the ones of Sotavento (location 13), neither only with wind predictors.</p></li>
<li><p>HPO on model hyperparameters is a crucial step, since the model with fixed parameter is not usually the best version of the model, and in this case too.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optuna</span></code> and random search are powerful tools to perform HPO, since are efficient in terms of time and finding good combination of hyperparamiters. In many cases these are the best options, since the computational time of the alternatives is too much for practical scenarios.</p></li>
</ul>
<p>Based on this results,, now we will reduced the next global HPO by setting <code class="docutils literal notranslate"><span class="pre">feature_engineering</span> <span class="pre">=</span> <span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">only_sotavento</span> <span class="pre">=</span> <span class="pre">False</span></code>, <code class="docutils literal notranslate"><span class="pre">only_wind</span> <span class="pre">=</span> <span class="pre">False</span></code>, using <code class="docutils literal notranslate"><span class="pre">iterative_median</span></code> as imputation method, and only using <code class="docutils literal notranslate"><span class="pre">optuna</span></code> to make everything much faster.</p>
<p>These following test we will be done with five models: histogram gradien boosting, random forest, XGBoost, decision trees and KNN.</p>
</section>
</section>
<section id="reduced-test-histogram-gradient-boosting">
<h3><strong>Reduced test: Histogram Gradient Boosting</strong><a class="headerlink" href="#reduced-test-histogram-gradient-boosting" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;imputation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;iterative_median&#39;</span><span class="p">],</span> 
                      <span class="s1">&#39;feature_engineering&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">],</span> 
                      <span class="s1">&#39;only_sotavento&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">],</span> 
                      <span class="s1">&#39;only_wind&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">model_param_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
            <span class="s1">&#39;estimator__l2_regularization&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__l2_regularization&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__max_iter&#39;</span><span class="p">:</span>  <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__max_iter&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">170</span><span class="p">),</span>
            <span class="s1">&#39;estimator__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__max_leaf_nodes&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">40</span><span class="p">)}</span>

<span class="n">search_methods_grid</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;optuna&#39;</span><span class="p">]</span>

<span class="n">hgb_global_search_</span> <span class="o">=</span> <span class="n">global_search</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">HistGradientBoostingRegressor</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;squared_error&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
                                   <span class="n">preprocessing_grid</span><span class="o">=</span><span class="n">preprocessing_grid</span><span class="p">,</span> 
                                   <span class="n">model_param_grid_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_random_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_halving_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                   <span class="n">model_param_optuna</span> <span class="o">=</span> <span class="n">model_param_optuna</span><span class="p">,</span>
                                   <span class="n">search_methods_grid</span><span class="o">=</span><span class="n">search_methods_grid</span><span class="p">,</span>
                                   <span class="n">cv_method</span><span class="o">=</span><span class="s1">&#39;years_based&#39;</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span>
                                   <span class="n">n_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                                   <span class="n">X_years</span><span class="o">=</span><span class="n">X_train_years</span><span class="p">,</span> <span class="n">years_training</span><span class="o">=</span><span class="p">[</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2007</span><span class="p">],</span> <span class="n">years_testing</span><span class="o">=</span><span class="p">[</span><span class="mi">2005</span><span class="p">])</span>

<span class="n">hgb_global_search_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="c1"># Time: 20  mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hgb_global_search_</span><span class="o">.</span><span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 11)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__max_depth</th><th>estimator__l2_regularization</th><th>estimator__max_iter</th><th>estimator__max_leaf_nodes</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>f64</td><td>i64</td><td>i64</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>6</td><td>0.0</td><td>117</td><td>15</td><td>278.656682</td><td>&quot;optuna&quot;</td><td>1195.173427</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hgb_global_search_</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="s1">&#39;results_hgb_pipeline_2.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_hgb_pipeline_2</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;results/results_hgb_pipeline_2.csv&#39;</span><span class="p">)</span>
<span class="n">results_hgb_pipeline_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 11)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__max_depth</th><th>estimator__l2_regularization</th><th>estimator__max_iter</th><th>estimator__max_leaf_nodes</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>f64</td><td>i64</td><td>i64</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>6</td><td>0.0</td><td>117</td><td>15</td><td>278.656682</td><td>&quot;optuna&quot;</td><td>1195.173427</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="reduced-test-trees">
<h3><strong>Reduced test: Trees</strong><a class="headerlink" href="#reduced-test-trees" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;imputation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;iterative_median&#39;</span><span class="p">],</span> 
                      <span class="s1">&#39;feature_engineering&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">],</span> 
                      <span class="s1">&#39;only_sotavento&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">],</span> 
                      <span class="s1">&#39;only_wind&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">model_param_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;estimator__min_samples_split&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__min_samples_split&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> 
            <span class="s1">&#39;estimator__min_samples_leaf&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
            <span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
            <span class="s1">&#39;estimator__ccp_alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__ccp_alpha&#39;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s1">&#39;estimator__splitter&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;estimator__splitter&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">,</span><span class="s1">&#39;random&#39;</span><span class="p">])}</span>

<span class="n">search_methods_grid</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;optuna&#39;</span><span class="p">]</span>

<span class="n">tree_global_search_</span> <span class="o">=</span> <span class="n">global_search</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;squared_error&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
                                   <span class="n">preprocessing_grid</span><span class="o">=</span><span class="n">preprocessing_grid</span><span class="p">,</span> 
                                   <span class="n">model_param_grid_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_random_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_halving_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                   <span class="n">model_param_optuna</span> <span class="o">=</span> <span class="n">model_param_optuna</span><span class="p">,</span>
                                   <span class="n">search_methods_grid</span><span class="o">=</span><span class="n">search_methods_grid</span><span class="p">,</span>
                                   <span class="n">cv_method</span><span class="o">=</span><span class="s1">&#39;years_based&#39;</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span>
                                   <span class="n">n_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                                   <span class="n">X_years</span><span class="o">=</span><span class="n">X_train_years</span><span class="p">,</span> <span class="n">years_training</span><span class="o">=</span><span class="p">[</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2007</span><span class="p">],</span> <span class="n">years_testing</span><span class="o">=</span><span class="p">[</span><span class="mi">2005</span><span class="p">])</span>

<span class="n">tree_global_search_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="c1"># Time: 15 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_global_search_</span><span class="o">.</span><span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 12)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__min_samples_split</th><th>estimator__min_samples_leaf</th><th>estimator__max_depth</th><th>estimator__ccp_alpha</th><th>estimator__splitter</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>str</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>2</td><td>13</td><td>7</td><td>1.341984</td><td>&quot;random&quot;</td><td>302.122604</td><td>&quot;optuna&quot;</td><td>935.397144</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_global_search_</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="s1">&#39;results_trees_pipeline.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_trees_pipeline</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;results/results_trees_pipeline.csv&#39;</span><span class="p">)</span>
<span class="n">results_trees_pipeline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 12)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__min_samples_split</th><th>estimator__min_samples_leaf</th><th>estimator__max_depth</th><th>estimator__ccp_alpha</th><th>estimator__splitter</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>str</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>2</td><td>13</td><td>7</td><td>1.341984</td><td>&quot;random&quot;</td><td>302.122604</td><td>&quot;optuna&quot;</td><td>935.397144</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="reduced-test-knn">
<h3><strong>Reduced test: KNN</strong><a class="headerlink" href="#reduced-test-knn" title="Link to this heading">#</a></h3>
<p>Based in previous test: we will set feature_engineering = True, only_sotavento = False, only_wind = False, only use iterative_median as imputation methods, and modify (reduce) some model hyperparameters grids.</p>
<p>An to make the tests much faster we will only use optuna and random search.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;imputation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;iterative_median&#39;</span><span class="p">],</span> 
                      <span class="s1">&#39;feature_engineering&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">],</span> <span class="s1">&#39;only_sotavento&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">],</span> <span class="s1">&#39;only_wind&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]}</span>


<span class="k">def</span> <span class="nf">model_param_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;estimator__n_neighbors&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__n_neighbors&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> 
            <span class="s1">&#39;estimator__metric&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;estimator__metric&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span><span class="s1">&#39;cityblock&#39;</span><span class="p">,</span><span class="s1">&#39;manhattan&#39;</span><span class="p">])}</span>

<span class="n">search_methods_grid</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;optuna&#39;</span><span class="p">]</span>

<span class="n">knn_global_search_</span> <span class="o">=</span> <span class="n">global_search</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">KNeighborsRegressor</span><span class="p">(),</span>
                                   <span class="n">preprocessing_grid</span><span class="o">=</span><span class="n">preprocessing_grid</span><span class="p">,</span> 
                                   <span class="n">model_param_grid_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_random_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_halving_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                   <span class="n">model_param_optuna</span> <span class="o">=</span> <span class="n">model_param_optuna</span><span class="p">,</span>
                                   <span class="n">search_methods_grid</span><span class="o">=</span><span class="n">search_methods_grid</span><span class="p">,</span>
                                   <span class="n">cv_method</span><span class="o">=</span><span class="s1">&#39;years_based&#39;</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span>
                                   <span class="n">n_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                                   <span class="n">X_years</span><span class="o">=</span><span class="n">X_train_years</span><span class="p">,</span> <span class="n">years_training</span><span class="o">=</span><span class="p">[</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2007</span><span class="p">],</span> <span class="n">years_testing</span><span class="o">=</span><span class="p">[</span><span class="mi">2005</span><span class="p">])</span>

<span class="n">knn_global_search_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="c1"># Time:  15.38 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn_global_search_</span><span class="o">.</span><span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 9)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__n_neighbors</th><th>estimator__metric</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>str</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>30</td><td>&quot;manhattan&quot;</td><td>481.232157</td><td>&quot;optuna&quot;</td><td>938.841097</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn_global_search_</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="s1">&#39;results_knn_pipeline.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_knn_pipeline</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;results/results_knn_pipeline.csv&#39;</span><span class="p">)</span>
<span class="n">results_knn_pipeline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 9)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__n_neighbors</th><th>estimator__metric</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>str</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>30</td><td>&quot;manhattan&quot;</td><td>481.232157</td><td>&quot;optuna&quot;</td><td>938.841097</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="reduced-test-xgboost">
<h3><strong>Reduced test: XGboost</strong><a class="headerlink" href="#reduced-test-xgboost" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;imputation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;iterative_median&#39;</span><span class="p">],</span> 
                      <span class="s1">&#39;feature_engineering&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">],</span> 
                      <span class="s1">&#39;only_sotavento&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">],</span> 
                      <span class="s1">&#39;only_wind&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">model_param_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;estimator__n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__n_estimators&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
            <span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="s1">&#39;estimator__eta&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__eta&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__alpha&#39;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__lambda&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__lambda&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__subsample&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__subsample&#39;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__reg_gamma&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator_gamma&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__colsample_bytree&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__colsample_bytree&#39;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)}</span>


<span class="n">search_methods_grid</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;optuna&#39;</span><span class="p">]</span>

<span class="n">xgb_global_search_</span> <span class="o">=</span> <span class="n">global_search</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;reg:squarederror&#39;</span><span class="p">,</span> <span class="n">booster</span><span class="o">=</span><span class="s1">&#39;gbtree&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span> <span class="p">,</span>
                                   <span class="n">preprocessing_grid</span><span class="o">=</span><span class="n">preprocessing_grid</span><span class="p">,</span> 
                                   <span class="n">model_param_grid_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_random_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_halving_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                   <span class="n">model_param_optuna</span> <span class="o">=</span> <span class="n">model_param_optuna</span><span class="p">,</span>
                                   <span class="n">search_methods_grid</span><span class="o">=</span><span class="n">search_methods_grid</span><span class="p">,</span>
                                   <span class="n">cv_method</span><span class="o">=</span><span class="s1">&#39;years_based&#39;</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span>
                                   <span class="n">n_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                                   <span class="n">X_years</span><span class="o">=</span><span class="n">X_train_years</span><span class="p">,</span> <span class="n">years_training</span><span class="o">=</span><span class="p">[</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2007</span><span class="p">],</span> <span class="n">years_testing</span><span class="o">=</span><span class="p">[</span><span class="mi">2005</span><span class="p">])</span>

<span class="n">xgb_global_search_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="c1"># Time: 34 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xgb_global_search_</span><span class="o">.</span><span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 15)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__n_estimators</th><th>estimator__max_depth</th><th>estimator__eta</th><th>estimator__alpha</th><th>estimator__lambda</th><th>estimator__subsample</th><th>estimator__gamma</th><th>estimator__colsample_bytree</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>140</td><td>4</td><td>0.06</td><td>0.95</td><td>5.0</td><td>0.68</td><td>1.4</td><td>0.44</td><td>274.576527</td><td>&quot;optuna&quot;</td><td>2049.435454</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xgb_global_search_</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="s1">&#39;results_xgb_pipeline.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_xgb_pipeline</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;results/results_xgb_pipeline.csv&#39;</span><span class="p">)</span>
<span class="n">results_xgb_pipeline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 15)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__n_estimators</th><th>estimator__max_depth</th><th>estimator__eta</th><th>estimator__alpha</th><th>estimator__lambda</th><th>estimator__subsample</th><th>estimator__gamma</th><th>estimator__colsample_bytree</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>140</td><td>4</td><td>0.06</td><td>0.95</td><td>5.0</td><td>0.68</td><td>1.4</td><td>0.44</td><td>274.576527</td><td>&quot;optuna&quot;</td><td>2049.435454</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="reduced-test-random-forest">
<h3><strong>Reduced test: Random Forest</strong><a class="headerlink" href="#reduced-test-random-forest" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;imputation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;iterative_median&#39;</span><span class="p">],</span> 
                      <span class="s1">&#39;feature_engineering&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">],</span> <span class="s1">&#39;only_sotavento&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">],</span> 
                      <span class="s1">&#39;only_wind&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]}</span>


<span class="k">def</span> <span class="nf">model_param_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;estimator__n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__n_estimators&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span>
            <span class="s1">&#39;estimator__min_samples_split&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__min_samples_split&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> 
            <span class="s1">&#39;estimator__min_samples_leaf&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span>
            <span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
            <span class="s1">&#39;estimator__ccp_alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__ccp_alpha&#39;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)}</span>

<span class="n">search_methods_grid</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;optuna&#39;</span><span class="p">]</span>

<span class="n">RF_global_search_</span> <span class="o">=</span> <span class="n">global_search</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;squared_error&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
                                   <span class="n">preprocessing_grid</span><span class="o">=</span><span class="n">preprocessing_grid</span><span class="p">,</span> 
                                   <span class="n">model_param_grid_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_random_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_halving_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                   <span class="n">model_param_optuna</span> <span class="o">=</span> <span class="n">model_param_optuna</span><span class="p">,</span>
                                   <span class="n">search_methods_grid</span><span class="o">=</span><span class="n">search_methods_grid</span><span class="p">,</span>
                                   <span class="n">cv_method</span><span class="o">=</span><span class="s1">&#39;years_based&#39;</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span>
                                   <span class="n">n_iter</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                                   <span class="n">X_years</span><span class="o">=</span><span class="n">X_train_years</span><span class="p">,</span> <span class="n">years_training</span><span class="o">=</span><span class="p">[</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2007</span><span class="p">],</span> <span class="n">years_testing</span><span class="o">=</span><span class="p">[</span><span class="mi">2005</span><span class="p">])</span>

<span class="n">RF_global_search_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="c1"># Time: 30 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RF_global_search_</span><span class="o">.</span><span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 12)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__n_estimators</th><th>estimator__min_samples_split</th><th>estimator__min_samples_leaf</th><th>estimator__max_depth</th><th>estimator__ccp_alpha</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>108</td><td>14</td><td>8</td><td>12</td><td>0.495898</td><td>285.643254</td><td>&quot;optuna&quot;</td><td>1858.587577</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RF_global_search_</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="s1">&#39;results_RF_pipeline.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_RF_pipeline</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;results/results_RF_pipeline.csv&#39;</span><span class="p">)</span>
<span class="n">results_RF_pipeline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 12)</small><table border="1" class="dataframe"><thead><tr><th>imputation</th><th>feature_engineering</th><th>only_sotavento</th><th>only_wind</th><th>estimator__n_estimators</th><th>estimator__min_samples_split</th><th>estimator__min_samples_leaf</th><th>estimator__max_depth</th><th>estimator__ccp_alpha</th><th>score</th><th>search_method</th><th>time</th></tr><tr><td>str</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;iterative_medi…</td><td>true</td><td>false</td><td>false</td><td>108</td><td>14</td><td>8</td><td>12</td><td>0.495898</td><td>285.643254</td><td>&quot;optuna&quot;</td><td>1858.587577</td></tr></tbody></table></div></div></div>
</div>
</section>
</section>
<section id="estimation-future-performance-for-the-final-model">
<h2><strong>Estimation Future Performance for the Final Model</strong><a class="headerlink" href="#estimation-future-performance-for-the-final-model" title="Link to this heading">#</a></h2>
<p>The best model obtained after our tests is XGBoost with an score (MAE) of 274.58, and the following combination of hyperparameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params_final_model</span> <span class="o">=</span> <span class="n">xgb_global_search_</span><span class="o">.</span><span class="n">best_params_</span>
<span class="n">params_final_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;imputation&#39;: &#39;iterative_median&#39;,
 &#39;feature_engineering&#39;: True,
 &#39;only_sotavento&#39;: False,
 &#39;only_wind&#39;: False,
 &#39;estimator__n_estimators&#39;: 140,
 &#39;estimator__max_depth&#39;: 4,
 &#39;estimator__eta&#39;: 0.06,
 &#39;estimator__alpha&#39;: 0.95,
 &#39;estimator__lambda&#39;: 5.0,
 &#39;estimator__subsample&#39;: 0.6799999999999999,
 &#39;estimator__gamma&#39;: 1.4000000000000001,
 &#39;estimator__colsample_bytree&#39;: 0.44}
</pre></div>
</div>
</div>
</div>
<p>Now we are going to make an estimation of the future performance of this model, namely, the performance of the model for training “new” data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;reg:squarederror&#39;</span><span class="p">,</span> <span class="n">booster</span><span class="o">=</span><span class="s1">&#39;gbtree&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span>
                     <span class="n">n_estimators</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__n_estimators&#39;</span><span class="p">],</span>
                     <span class="n">max_depth</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">],</span>
                     <span class="n">eta</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__eta&#39;</span><span class="p">],</span> 
                     <span class="n">alpha</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__alpha&#39;</span><span class="p">],</span> 
                     <span class="n">reg_lambda</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__lambda&#39;</span><span class="p">],</span>
                     <span class="n">subsample</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__subsample&#39;</span><span class="p">]</span> <span class="p">,</span>
                     <span class="n">gamma</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__gamma&#39;</span><span class="p">]</span> <span class="p">,</span>
                     <span class="n">colsample_bytree</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__colsample_bytree&#39;</span><span class="p">])</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;imputation&#39;</span><span class="p">,</span> <span class="n">imputation</span><span class="p">()),</span>
                     <span class="p">(</span><span class="s1">&#39;feature_engineering&#39;</span><span class="p">,</span> <span class="n">feature_engineering</span><span class="p">()),</span>
                     <span class="p">(</span><span class="s1">&#39;only_wind&#39;</span><span class="p">,</span> <span class="n">only_wind</span><span class="p">()),</span>
                     <span class="p">(</span><span class="s1">&#39;only_sotavento&#39;</span><span class="p">,</span> <span class="n">only_sotavento</span><span class="p">()),</span> 
                     <span class="p">(</span><span class="s1">&#39;estimator&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> 
                    <span class="p">])</span>
            
<span class="n">pipeline</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">imputation__method</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;imputation&#39;</span><span class="p">],</span> 
                    <span class="n">feature_engineering__apply</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;feature_engineering&#39;</span><span class="p">],</span>
                    <span class="n">only_wind__apply</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;only_wind&#39;</span><span class="p">],</span> 
                    <span class="n">only_sotavento__apply</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;only_wind&#39;</span><span class="p">])</span>

<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">MAE_future_performance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Y_test_hat</span> <span class="o">-</span> <span class="n">Y_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<p>The estimation of future performance of the model in terms of MAE is 282.78.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MAE_future_performance</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>282.7787378512826
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">analyze_predictions</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to analyze the quality of predictions.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    - y_true: Array of true values.</span>
<span class="sd">    - y_pred: Array of predicted values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate residuals and percentage deviation</span>
    <span class="n">residuals</span> <span class="o">=</span>  <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>
    <span class="n">percentage_deviation</span> <span class="o">=</span> <span class="p">(</span><span class="n">residuals</span> <span class="o">/</span> <span class="n">y_true</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="c1"># Create an array of x-axis values</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="c1"># Plot 1: Residuals vs. Predicted values</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted Values&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Residuals vs. Predicted Values - </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># Plot 2: True values vs. Predicted values</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted vs. True&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;gray&#39;</span><span class="p">},</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Perfect Fit&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;orange&#39;</span><span class="p">},</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Best Fit</span><span class="se">\n</span><span class="s1">R-squared: </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True Values&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted Values&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;True vs. Predicted Values - </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># Plot 3: Percentage Deviation of Prediction</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">percentage_deviation</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  <span class="c1"># Set y-axis limits</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted Values&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Percentage Deviation (%)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Percentage Deviation of Prediction - </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># Create a new figure for the fourth plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="c1"># Plot 4: Line plot of True vs. Predicted values</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data Points&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Line Plot of True vs. Predicted Values - </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analyze_predictions</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">Y_test_hat</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;XGBoost&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/91596db4fa26e6fdc5cb5ca4062e74f6c8ab174ff479996d64bdaef31bf735a7.png" src="_images/91596db4fa26e6fdc5cb5ca4062e74f6c8ab174ff479996d64bdaef31bf735a7.png" />
<img alt="_images/0e807a1281ec7ff942159a377f482c8760bb741c344b13e3c5f8b9c3172dde64.png" src="_images/0e807a1281ec7ff942159a377f482c8760bb741c344b13e3c5f8b9c3172dde64.png" />
</div>
</div>
</section>
<section id="final-model-hpo">
<h2><strong>Final Model HPO</strong><a class="headerlink" href="#final-model-hpo" title="Link to this heading">#</a></h2>
<p>In this section we are going to carry out an HPO of the final model using all the available data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;imputation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;imputation&#39;</span><span class="p">]],</span> 
                      <span class="s1">&#39;feature_engineering&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;feature_engineering&#39;</span><span class="p">]],</span> 
                      <span class="s1">&#39;only_sotavento&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;only_sotavento&#39;</span><span class="p">]],</span> 
                      <span class="s1">&#39;only_wind&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;only_wind&#39;</span><span class="p">]]}</span>

<span class="k">def</span> <span class="nf">model_param_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;estimator__n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__n_estimators&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
            <span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="s1">&#39;estimator__eta&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__eta&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__alpha&#39;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__lambda&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__lambda&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__subsample&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__subsample&#39;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__gamma&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__gamma&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;estimator__colsample_bytree&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;estimator__colsample_bytree&#39;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)}</span>


<span class="n">search_methods_grid</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;optuna&#39;</span><span class="p">]</span>

<span class="n">xgb_global_search_</span> <span class="o">=</span> <span class="n">global_search</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;reg:squarederror&#39;</span><span class="p">,</span> <span class="n">booster</span><span class="o">=</span><span class="s1">&#39;gbtree&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
                                   <span class="n">preprocessing_grid</span><span class="o">=</span><span class="n">preprocessing_grid</span><span class="p">,</span> 
                                   <span class="n">model_param_grid_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_random_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">model_param_halving_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                   <span class="n">model_param_optuna</span> <span class="o">=</span> <span class="n">model_param_optuna</span><span class="p">,</span>
                                   <span class="n">search_methods_grid</span><span class="o">=</span><span class="n">search_methods_grid</span><span class="p">,</span>
                                   <span class="n">cv_method</span><span class="o">=</span><span class="s1">&#39;years_based&#39;</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span>
                                   <span class="n">n_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                                   <span class="n">X_years</span><span class="o">=</span><span class="n">X_years</span><span class="p">,</span> <span class="n">years_training</span><span class="o">=</span><span class="p">[</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">2006</span><span class="p">,</span> <span class="mi">2007</span><span class="p">],</span> <span class="n">years_testing</span><span class="o">=</span><span class="p">[</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">2009</span><span class="p">])</span>

<span class="n">xgb_global_search_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 90 mins</span>
</pre></div>
</div>
</div>
</div>
<p>The obtained MAE is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xgb_global_search_</span><span class="o">.</span><span class="n">best_score_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>274.78670631721087
</pre></div>
</div>
</div>
</div>
<p>The winner combination of hyperparameters is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params_final_model</span> <span class="o">=</span> <span class="n">xgb_global_search_</span><span class="o">.</span><span class="n">best_params_</span>
<span class="n">params_final_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;imputation&#39;: &#39;iterative_median&#39;,
 &#39;feature_engineering&#39;: True,
 &#39;only_sotavento&#39;: False,
 &#39;only_wind&#39;: False,
 &#39;estimator__n_estimators&#39;: 142,
 &#39;estimator__max_depth&#39;: 7,
 &#39;estimator__eta&#39;: 0.04,
 &#39;estimator__alpha&#39;: 0.5,
 &#39;estimator_lambda&#39;: 2.56,
 &#39;estimator__subsample&#39;: 0.5,
 &#39;estimator__gamma&#39;: 3.0500000000000003,
 &#39;estimator__colsample_bytree&#39;: 0.8200000000000001}
</pre></div>
</div>
</div>
</div>
</section>
<section id="saving-the-competition-model">
<h2><strong>Saving the competition model</strong><a class="headerlink" href="#saving-the-competition-model" title="Link to this heading">#</a></h2>
<p>The final model with the last hyperparameter combination is our model for the competition. Now we are going to save it as a pre-trained model, ready to make prediction on new data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;reg:squarederror&#39;</span><span class="p">,</span> <span class="n">booster</span><span class="o">=</span><span class="s1">&#39;gbtree&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span>
                     <span class="n">n_estimators</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__n_estimators&#39;</span><span class="p">],</span>
                     <span class="n">max_depth</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__max_depth&#39;</span><span class="p">],</span>
                     <span class="n">eta</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__eta&#39;</span><span class="p">],</span> 
                     <span class="n">alpha</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__alpha&#39;</span><span class="p">],</span> 
                     <span class="n">reg_lambda</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator_lambda&#39;</span><span class="p">],</span>
                     <span class="n">subsample</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__subsample&#39;</span><span class="p">]</span> <span class="p">,</span>
                     <span class="n">gamma</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__gamma&#39;</span><span class="p">]</span> <span class="p">,</span>
                     <span class="n">colsample_bytree</span><span class="o">=</span><span class="n">params_final_model</span><span class="p">[</span><span class="s1">&#39;estimator__colsample_bytree&#39;</span><span class="p">])</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;imputation&#39;</span><span class="p">,</span> <span class="n">imputation</span><span class="p">()),</span>
                     <span class="p">(</span><span class="s1">&#39;feature_engineering&#39;</span><span class="p">,</span> <span class="n">feature_engineering</span><span class="p">()),</span>
                     <span class="p">(</span><span class="s1">&#39;only_wind&#39;</span><span class="p">,</span> <span class="n">only_wind</span><span class="p">()),</span>
                     <span class="p">(</span><span class="s1">&#39;only_sotavento&#39;</span><span class="p">,</span> <span class="n">only_sotavento</span><span class="p">()),</span> 
                     <span class="p">(</span><span class="s1">&#39;estimator&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> 
                    <span class="p">])</span>

<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-7 {color: black;}#sk-container-id-7 pre{padding: 0;}#sk-container-id-7 div.sk-toggleable {background-color: white;}#sk-container-id-7 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-7 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-7 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-7 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-7 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-7 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-7 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-7 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-7 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-7 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-7 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-7 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-7 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-7 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-7 div.sk-item {position: relative;z-index: 1;}#sk-container-id-7 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-7 div.sk-item::before, #sk-container-id-7 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-7 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-7 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-7 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-7 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-7 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-7 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-7 div.sk-label-container {text-align: center;}#sk-container-id-7 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-7 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-7" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;imputation&#x27;, imputation()),
                (&#x27;feature_engineering&#x27;, feature_engineering()),
                (&#x27;only_wind&#x27;, only_wind()),
                (&#x27;only_sotavento&#x27;, only_sotavento()),
                (&#x27;estimator&#x27;,
                 XGBRegressor(alpha=0.5, base_score=None, booster=&#x27;gbtree&#x27;,
                              callbacks=None, colsample_bylevel=None,
                              colsample_bynode=None,
                              colsample_bytree=0.8200000000000001, device=None,
                              early_stopping_rounds...
                              eval_metric=None, feature_types=None,
                              gamma=3.0500000000000003, grow_policy=None,
                              importance_type=None,
                              interaction_constraints=None, learning_rate=None,
                              max_bin=None, max_cat_threshold=None,
                              max_cat_to_onehot=None, max_delta_step=None,
                              max_depth=7, max_leaves=None,
                              min_child_weight=None, missing=nan,
                              monotone_constraints=None, multi_strategy=None,
                              n_estimators=142, n_jobs=None, ...))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-38" type="checkbox" ><label for="sk-estimator-id-38" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;imputation&#x27;, imputation()),
                (&#x27;feature_engineering&#x27;, feature_engineering()),
                (&#x27;only_wind&#x27;, only_wind()),
                (&#x27;only_sotavento&#x27;, only_sotavento()),
                (&#x27;estimator&#x27;,
                 XGBRegressor(alpha=0.5, base_score=None, booster=&#x27;gbtree&#x27;,
                              callbacks=None, colsample_bylevel=None,
                              colsample_bynode=None,
                              colsample_bytree=0.8200000000000001, device=None,
                              early_stopping_rounds...
                              eval_metric=None, feature_types=None,
                              gamma=3.0500000000000003, grow_policy=None,
                              importance_type=None,
                              interaction_constraints=None, learning_rate=None,
                              max_bin=None, max_cat_threshold=None,
                              max_cat_to_onehot=None, max_delta_step=None,
                              max_depth=7, max_leaves=None,
                              min_child_weight=None, missing=nan,
                              monotone_constraints=None, multi_strategy=None,
                              n_estimators=142, n_jobs=None, ...))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-39" type="checkbox" ><label for="sk-estimator-id-39" class="sk-toggleable__label sk-toggleable__label-arrow">imputation</label><div class="sk-toggleable__content"><pre>imputation()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-40" type="checkbox" ><label for="sk-estimator-id-40" class="sk-toggleable__label sk-toggleable__label-arrow">feature_engineering</label><div class="sk-toggleable__content"><pre>feature_engineering()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-41" type="checkbox" ><label for="sk-estimator-id-41" class="sk-toggleable__label sk-toggleable__label-arrow">only_wind</label><div class="sk-toggleable__content"><pre>only_wind()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-42" type="checkbox" ><label for="sk-estimator-id-42" class="sk-toggleable__label sk-toggleable__label-arrow">only_sotavento</label><div class="sk-toggleable__content"><pre>only_sotavento()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-43" type="checkbox" ><label for="sk-estimator-id-43" class="sk-toggleable__label sk-toggleable__label-arrow">XGBRegressor</label><div class="sk-toggleable__content"><pre>XGBRegressor(alpha=0.5, base_score=None, booster=&#x27;gbtree&#x27;, callbacks=None,
             colsample_bylevel=None, colsample_bynode=None,
             colsample_bytree=0.8200000000000001, device=None,
             early_stopping_rounds=None, enable_categorical=False, eta=0.04,
             eval_metric=None, feature_types=None, gamma=3.0500000000000003,
             grow_policy=None, importance_type=None,
             interaction_constraints=None, learning_rate=None, max_bin=None,
             max_cat_threshold=None, max_cat_to_onehot=None,
             max_delta_step=None, max_depth=7, max_leaves=None,
             min_child_weight=None, missing=nan, monotone_constraints=None,
             multi_strategy=None, n_estimators=142, n_jobs=None, ...)</pre></div></div></div></div></div></div></div></div></div>
</div>
<p><strong>Saving the pre-trained model:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;competition_model.joblib&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;competition_model.joblib&#39;]
</pre></div>
</div>
</div>
</div>
<p><strong>Loading the pre-trained model:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">competition_model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;results/competition_model.joblib&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="making-prediction-for-compatition-data">
<h2><strong>Making prediction for compatition data</strong><a class="headerlink" href="#making-prediction-for-compatition-data" title="Link to this heading">#</a></h2>
<p>Now we will use our pre-trained model to make predictions for the competition data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/wind_competition.csv.gzip&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">wind_comp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    
<span class="n">wind_comp_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">wind_comp_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">competition_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">wind_comp_df</span><span class="p">[</span><span class="n">predictors</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([695.9338  , 155.75926 , 851.264   , ..., 224.28133 ,  54.96442 ,
        53.400623], dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">competition_predictions</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">competition_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">wind_comp_df</span><span class="p">[</span><span class="n">predictors</span><span class="p">]))</span>
<span class="n">competition_predictions</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">]</span>
<span class="n">competition_predictions</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1_189, 1)</small><table border="1" class="dataframe"><thead><tr><th>Y_hat</th></tr><tr><td>f32</td></tr></thead><tbody><tr><td>695.933777</td></tr><tr><td>155.759262</td></tr><tr><td>851.263977</td></tr><tr><td>500.337463</td></tr><tr><td>413.18222</td></tr><tr><td>422.073273</td></tr><tr><td>968.531677</td></tr><tr><td>1267.982178</td></tr><tr><td>1589.704834</td></tr><tr><td>937.444397</td></tr><tr><td>795.087891</td></tr><tr><td>182.776688</td></tr><tr><td>&hellip;</td></tr><tr><td>745.710205</td></tr><tr><td>787.985901</td></tr><tr><td>445.136902</td></tr><tr><td>707.376648</td></tr><tr><td>542.378479</td></tr><tr><td>932.583801</td></tr><tr><td>680.397339</td></tr><tr><td>346.150909</td></tr><tr><td>397.008118</td></tr><tr><td>224.281326</td></tr><tr><td>54.96442</td></tr><tr><td>53.400623</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">competition_predictions</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="s1">&#39;competition_predictions.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Wind Energy Prediction</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem"><strong>The problem</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptual-description-of-the-data"><strong>Conceptual description of the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data"><strong>Reading the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda"><strong>EDA</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variable-types"><strong>Variable types</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values-analysis"><strong>Missing values analysis</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-the-response"><strong>Analysis of the Response</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-summary"><strong>Descriptive summary</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram"><strong>Histogram</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#frequencies"><strong>Frequencies</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot"><strong>Boxplot</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ecdf-plot"><strong>ECDF-plot</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers"><strong>Outliers</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series-analysis"><strong>Time series analysis</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelation"><strong>Autocorrelation</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#statistics-by-year"><strong>Statistics by year</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-relationship-between-response-and-predictors"><strong>Analysis of relationship between Response and Predictors</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda-conclusions-and-things-to-take-care-of"><strong>EDA conclusions and things to take care of</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split"><strong>Train-Test Split</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pipeline-definition"><strong>Pipeline definition</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-the-pipeline"><strong>Testing the pipeline</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metric-and-inner-outer-evaluation-decision"><strong>Metric and Inner-Outer evaluation decision</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-outer-evaluation"><strong>Inner-Outer evaluation</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metric"><strong>Metric</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#type-of-problem"><strong>Type of problem</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#predicting-energy-production"><strong>Predicting energy production</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-search-model-hpo"><strong>Model search (Model HPO)</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-search-global-hpo"><strong>Global search (Global HPO)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#strategical-test-histogram-gradient-boosting"><strong>Strategical test: Histogram Gradient Boosting</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-test-histogram-gradient-boosting"><strong>Reduced test: Histogram Gradient Boosting</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-test-trees"><strong>Reduced test: Trees</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-test-knn"><strong>Reduced test: KNN</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-test-xgboost"><strong>Reduced test: XGboost</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-test-random-forest"><strong>Reduced test: Random Forest</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-future-performance-for-the-final-model"><strong>Estimation Future Performance for the Final Model</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-model-hpo"><strong>Final Model HPO</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-the-competition-model"><strong>Saving the competition model</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-prediction-for-compatition-data"><strong>Making prediction for compatition data</strong></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Fabio Scielzo Ortiz
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>